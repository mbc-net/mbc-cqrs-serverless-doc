"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[6464],{6212:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"architecture/cqrs-flow","title":"CQRS Pattern Flow","description":"This document explains how the CQRS (Command Query Responsibility Segregation) pattern is implemented in MBC CQRS Serverless.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/architecture/cqrs-flow.md","sourceDirName":"architecture","slug":"/architecture/cqrs-flow","permalink":"/docs/architecture/cqrs-flow","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"System Architecture Overview","permalink":"/docs/architecture/system-overview"},"next":{"title":"Event Sourcing Pattern","permalink":"/docs/architecture/event-sourcing"}}');var s=r(4848),i=r(8453);const a={sidebar_position:2},l="CQRS Pattern Flow",o={},d=[{value:"CQRS Overview",id:"cqrs-overview",level:2},{value:"Command Flow - Write Path",id:"command-flow---write-path",level:2},{value:"Command Flow Steps",id:"command-flow-steps",level:3},{value:"Query Flow - Read Path",id:"query-flow---read-path",level:2},{value:"Query Flow Steps",id:"query-flow-steps",level:3},{value:"Key Components",id:"key-components",level:2},{value:"Command Handler",id:"command-handler",level:3},{value:"Query Handler",id:"query-handler",level:3},{value:"Benefits of CQRS",id:"benefits-of-cqrs",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"cqrs-pattern-flow",children:"CQRS Pattern Flow"})}),"\n",(0,s.jsx)(n.p,{children:"This document explains how the CQRS (Command Query Responsibility Segregation) pattern is implemented in MBC CQRS Serverless."}),"\n",(0,s.jsx)(n.h2,{id:"cqrs-overview",children:"CQRS Overview"}),"\n",(0,s.jsx)(n.mermaid,{value:"flowchart TB\n    Client[Client Application]\n\n    subgraph Write\n        CommandAPI[Command API]\n        CommandHandler[Command Handler]\n        CommandService[Command Service]\n        EventStore[(Event Store)]\n        EventPublisher[Event Publisher]\n    end\n\n    subgraph Read\n        QueryAPI[Query API]\n        QueryHandler[Query Handler]\n        DataService[Data Service]\n        ReadStore[(Read Store)]\n    end\n\n    subgraph Events\n        EventHandler[Event Handler]\n        Projector[Projector]\n    end\n\n    Client --\x3e CommandAPI\n    Client --\x3e QueryAPI\n\n    CommandAPI --\x3e CommandHandler\n    CommandHandler --\x3e CommandService\n    CommandService --\x3e EventStore\n    CommandService --\x3e EventPublisher\n\n    QueryAPI --\x3e QueryHandler\n    QueryHandler --\x3e DataService\n    DataService --\x3e ReadStore\n\n    EventPublisher --\x3e EventHandler\n    EventHandler --\x3e Projector\n    Projector --\x3e ReadStore"}),"\n",(0,s.jsx)(n.h2,{id:"command-flow---write-path",children:"Command Flow - Write Path"}),"\n",(0,s.jsx)(n.p,{children:"The flow of write operations."}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    Client->>Gateway: POST request\n    Gateway->>Controller: DTO\n    Controller->>Handler: Command\n    Handler->>Handler: Validate\n    Handler->>Service: publish\n    Service->>DynamoDB: PutItem\n    DynamoDB--\x3e>Service: OK\n    Service->>SNS: Event\n    SNS--\x3e>Service: OK\n    Service--\x3e>Handler: Entity\n    Handler--\x3e>Controller: Result\n    Controller--\x3e>Gateway: 201\n    Gateway--\x3e>Client: Response"}),"\n",(0,s.jsx)(n.h3,{id:"command-flow-steps",children:"Command Flow Steps"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Request Received"}),": Client sends POST/PUT/DELETE request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DTO Validation"}),": Controller validates input using class-validator"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Command Dispatch"}),": Controller creates and dispatches command"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Business Logic"}),": Command handler executes business rules"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Persistence"}),": Command service persists to DynamoDB with optimistic locking"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Event Publishing"}),": Domain events are published to SNS"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Response"}),": Success response returned to client"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"query-flow---read-path",children:"Query Flow - Read Path"}),"\n",(0,s.jsx)(n.p,{children:"The flow of read operations."}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    Client->>Gateway: GET request\n    Gateway->>Controller: Request\n    Controller->>Handler: Query\n    Handler->>DataService: getItem\n    DataService->>Database: Query\n    Database--\x3e>DataService: Item\n    DataService--\x3e>Handler: Entity\n    Handler--\x3e>Controller: Result\n    Controller--\x3e>Gateway: 200\n    Gateway--\x3e>Client: Response"}),"\n",(0,s.jsx)(n.h3,{id:"query-flow-steps",children:"Query Flow Steps"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Request Received"}),": Client sends GET request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Query Dispatch"}),": Controller creates and dispatches query"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Retrieval"}),": Query handler calls data service"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database Query"}),": Data service queries DynamoDB or RDS"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Response"}),": Data returned to client"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"key-components",children:"Key Components"}),"\n",(0,s.jsx)(n.h3,{id:"command-handler",children:"Command Handler"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@CommandHandler(CreateResourceCommand)\nexport class CreateResourceHandler\n  implements ICommandHandler<CreateResourceCommand> {\n\n  constructor(private readonly commandService: CommandService) {}\n\n  async execute(command: CreateResourceCommand): Promise<DataEntity> {\n    // 1. Validate business rules\n    // 2. Create entity\n    // 3. Persist and publish event\n    return this.commandService.publishAsync(entity, { invokeContext });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"query-handler",children:"Query Handler"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@QueryHandler(GetResourceQuery)\nexport class GetResourceHandler\n  implements IQueryHandler<GetResourceQuery> {\n\n  constructor(private readonly dataService: DataService) {}\n\n  async execute(query: GetResourceQuery): Promise<DataEntity> {\n    return this.dataService.getItem({\n      pk: query.pk,\n      sk: query.sk,\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"benefits-of-cqrs",children:"Benefits of CQRS"}),"\n",(0,s.jsx)(n.p,{children:"Adopting the CQRS pattern provides these benefits:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scalability"}),": Read and write can be scaled independently"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Optimization"}),": Optimize each side for its specific purpose"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Flexibility"}),": Use different data models for reads and writes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Performance"}),": Denormalize read models for fast queries"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Auditability"}),": Complete event history for audit trails"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>l});var t=r(6540);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);