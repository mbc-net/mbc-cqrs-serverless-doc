"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[5880],{4466:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"codepipeline-cicd","title":"CI/CD with CodePipeline","description":"Set up continuous integration and deployment with AWS CodePipeline.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/codepipeline-cicd.md","sourceDirName":".","slug":"/codepipeline-cicd","permalink":"/docs/codepipeline-cicd","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"description":"Set up continuous integration and deployment with AWS CodePipeline."},"sidebar":"tutorialSidebar","previous":{"title":"Deployment Guide","permalink":"/docs/deployment-guide"},"next":{"title":"Monitoring and Logging","permalink":"/docs/monitoring-logging"}}');var o=i(4848),s=i(8453);const c={description:"Set up continuous integration and deployment with AWS CodePipeline."},r="CI/CD with CodePipeline",l={},a=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Pipeline Stack with CDK",id:"pipeline-stack-with-cdk",level:2},{value:"Create Pipeline Stack",id:"create-pipeline-stack",level:3},{value:"BuildSpec Configuration",id:"buildspec-configuration",level:2},{value:"Basic buildspec.yml",id:"basic-buildspecyml",level:3},{value:"BuildSpec with Environment Variables",id:"buildspec-with-environment-variables",level:3},{value:"Multi-Environment Pipeline",id:"multi-environment-pipeline",level:2},{value:"Development and Production Stages",id:"development-and-production-stages",level:3},{value:"GitHub Connection",id:"github-connection",level:2},{value:"Create CodeStar Connection",id:"create-codestar-connection",level:3},{value:"Use Connection in CDK",id:"use-connection-in-cdk",level:3},{value:"Branch-Based Pipelines",id:"branch-based-pipelines",level:2},{value:"Feature Branch Strategy",id:"feature-branch-strategy",level:3},{value:"CDK Pipeline with Branches",id:"cdk-pipeline-with-branches",level:3},{value:"Notifications",id:"notifications",level:2},{value:"SNS Notifications",id:"sns-notifications",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Security",id:"security",level:3},{value:"Performance",id:"performance",level:3},{value:"Reliability",id:"reliability",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Viewing Logs",id:"viewing-logs",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"cicd-with-codepipeline",children:"CI/CD with CodePipeline"})}),"\n",(0,o.jsx)(n.p,{children:"This guide explains how to set up a CI/CD pipeline using AWS CodePipeline for your MBC CQRS Serverless application."}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"AWS CodePipeline automates your build, test, and deployment workflow. A typical pipeline consists of:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Source Stage"}),": Pulls code from your repository"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Build Stage"}),": Runs tests and builds the application"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Deploy Stage"}),": Deploys to AWS using CDK/CloudFormation"]}),"\n"]}),"\n",(0,o.jsx)(n.mermaid,{value:"graph LR\n    A[Source] --\x3e B[Build]\n    B --\x3e C[Test]\n    C --\x3e D[Deploy Dev]\n    D --\x3e E[Approval]\n    E --\x3e F[Deploy Prod]"}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"AWS account with CodePipeline, CodeBuild permissions"}),"\n",(0,o.jsx)(n.li,{children:"Source repository (GitHub, CodeCommit, or Bitbucket)"}),"\n",(0,o.jsx)(n.li,{children:"AWS CDK project configured"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"pipeline-stack-with-cdk",children:"Pipeline Stack with CDK"}),"\n",(0,o.jsx)(n.h3,{id:"create-pipeline-stack",children:"Create Pipeline Stack"}),"\n",(0,o.jsxs)(n.p,{children:["Create a CDK stack for your pipeline in ",(0,o.jsx)(n.code,{children:"infra/libs/pipeline-stack.ts"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import * as cdk from 'aws-cdk-lib';\nimport * as codepipeline from 'aws-cdk-lib/aws-codepipeline';\nimport * as codepipeline_actions from 'aws-cdk-lib/aws-codepipeline-actions';\nimport * as codebuild from 'aws-cdk-lib/aws-codebuild';\nimport { Construct } from 'constructs';\n\nexport interface PipelineStackProps extends cdk.StackProps {\n  repositoryName: string;\n  branchName: string;\n  connectionArn: string;\n}\n\nexport class PipelineStack extends cdk.Stack {\n  constructor(scope: Construct, id: string, props: PipelineStackProps) {\n    super(scope, id, props);\n\n    // Source artifact\n    const sourceOutput = new codepipeline.Artifact();\n\n    // Build artifact\n    const buildOutput = new codepipeline.Artifact();\n\n    // CodeBuild project\n    const buildProject = new codebuild.PipelineProject(this, 'BuildProject', {\n      environment: {\n        buildImage: codebuild.LinuxBuildImage.STANDARD_7_0,\n        computeType: codebuild.ComputeType.MEDIUM,\n      },\n      buildSpec: codebuild.BuildSpec.fromSourceFilename('buildspec.yml'),\n    });\n\n    // Pipeline\n    const pipeline = new codepipeline.Pipeline(this, 'Pipeline', {\n      pipelineName: `${props.repositoryName}-pipeline`,\n      stages: [\n        {\n          stageName: 'Source',\n          actions: [\n            new codepipeline_actions.CodeStarConnectionsSourceAction({\n              actionName: 'GitHub_Source',\n              owner: 'your-org',\n              repo: props.repositoryName,\n              branch: props.branchName,\n              connectionArn: props.connectionArn,\n              output: sourceOutput,\n            }),\n          ],\n        },\n        {\n          stageName: 'Build',\n          actions: [\n            new codepipeline_actions.CodeBuildAction({\n              actionName: 'Build',\n              project: buildProject,\n              input: sourceOutput,\n              outputs: [buildOutput],\n            }),\n          ],\n        },\n        {\n          stageName: 'Deploy',\n          actions: [\n            new codepipeline_actions.CloudFormationCreateUpdateStackAction({\n              actionName: 'Deploy',\n              stackName: `${props.repositoryName}-app`,\n              templatePath: buildOutput.atPath('cdk.out/AppStack.template.json'),\n              adminPermissions: true,\n            }),\n          ],\n        },\n      ],\n    });\n  }\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"buildspec-configuration",children:"BuildSpec Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"basic-buildspecyml",children:"Basic buildspec.yml"}),"\n",(0,o.jsxs)(n.p,{children:["Create a ",(0,o.jsx)(n.code,{children:"buildspec.yml"})," file in your project root:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'version: 0.2\n\nphases:\n  install:\n    runtime-versions:\n      nodejs: 18\n    commands:\n      - npm ci\n\n  pre_build:\n    commands:\n      - echo "Running tests..."\n      - npm run test\n      - npm run lint\n\n  build:\n    commands:\n      - echo "Building application..."\n      - npm run build\n      - echo "Synthesizing CDK..."\n      - cd infra && npm ci && npx cdk synth\n\n  post_build:\n    commands:\n      - echo "Build completed on $(date)"\n\nartifacts:\n  files:\n    - \'**/*\'\n  base-directory: infra\n\ncache:\n  paths:\n    - node_modules/**/*\n    - infra/node_modules/**/*\n'})}),"\n",(0,o.jsx)(n.h3,{id:"buildspec-with-environment-variables",children:"BuildSpec with Environment Variables"}),"\n",(0,o.jsx)(n.p,{children:"For builds that require environment-specific configuration:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"version: 0.2\n\nenv:\n  variables:\n    NODE_ENV: production\n  parameter-store:\n    DATABASE_URL: /your-app/database-url\n  secrets-manager:\n    API_KEY: your-app-secrets:api-key\n\nphases:\n  install:\n    runtime-versions:\n      nodejs: 18\n    commands:\n      - npm ci\n\n  build:\n    commands:\n      - npm run build\n      - cd infra && npx cdk synth --context env=$ENVIRONMENT\n\nartifacts:\n  files:\n    - 'infra/cdk.out/**/*'\n"})}),"\n",(0,o.jsx)(n.h2,{id:"multi-environment-pipeline",children:"Multi-Environment Pipeline"}),"\n",(0,o.jsx)(n.h3,{id:"development-and-production-stages",children:"Development and Production Stages"}),"\n",(0,o.jsx)(n.p,{children:"Create a pipeline with separate stages for each environment:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const pipeline = new codepipeline.Pipeline(this, 'Pipeline', {\n  stages: [\n    // Source stage\n    { stageName: 'Source', actions: [sourceAction] },\n\n    // Build stage\n    { stageName: 'Build', actions: [buildAction] },\n\n    // Deploy to Development\n    {\n      stageName: 'Deploy_Dev',\n      actions: [\n        new codepipeline_actions.CloudFormationCreateUpdateStackAction({\n          actionName: 'Deploy_Dev',\n          stackName: 'myapp-dev',\n          templatePath: buildOutput.atPath('cdk.out/DevStack.template.json'),\n          adminPermissions: true,\n        }),\n      ],\n    },\n\n    // Manual Approval for Production\n    {\n      stageName: 'Approval',\n      actions: [\n        new codepipeline_actions.ManualApprovalAction({\n          actionName: 'Approve_Production',\n          notifyEmails: ['team@your-company.com'],\n        }),\n      ],\n    },\n\n    // Deploy to Production\n    {\n      stageName: 'Deploy_Prod',\n      actions: [\n        new codepipeline_actions.CloudFormationCreateUpdateStackAction({\n          actionName: 'Deploy_Prod',\n          stackName: 'myapp-prod',\n          templatePath: buildOutput.atPath('cdk.out/ProdStack.template.json'),\n          adminPermissions: true,\n        }),\n      ],\n    },\n  ],\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"github-connection",children:"GitHub Connection"}),"\n",(0,o.jsx)(n.h3,{id:"create-codestar-connection",children:"Create CodeStar Connection"}),"\n",(0,o.jsx)(n.p,{children:"To connect GitHub to CodePipeline:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Go to AWS Console \u2192 Developer Tools \u2192 Settings \u2192 Connections"}),"\n",(0,o.jsx)(n.li,{children:'Click "Create connection"'}),"\n",(0,o.jsx)(n.li,{children:'Select "GitHub" as provider'}),"\n",(0,o.jsx)(n.li,{children:"Authorize AWS Connector for GitHub"}),"\n",(0,o.jsx)(n.li,{children:"Copy the Connection ARN"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"use-connection-in-cdk",children:"Use Connection in CDK"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const connectionArn = 'arn:aws:codestar-connections:REGION:ACCOUNT:connection/CONNECTION_ID';\n\nnew codepipeline_actions.CodeStarConnectionsSourceAction({\n  actionName: 'GitHub_Source',\n  owner: 'your-org',\n  repo: 'your-repo',\n  branch: 'main',\n  connectionArn: connectionArn,\n  output: sourceOutput,\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"branch-based-pipelines",children:"Branch-Based Pipelines"}),"\n",(0,o.jsx)(n.h3,{id:"feature-branch-strategy",children:"Feature Branch Strategy"}),"\n",(0,o.jsx)(n.p,{children:"Create separate pipelines for different branches:"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Branch"}),(0,o.jsx)(n.th,{children:"Environment"}),(0,o.jsx)(n.th,{children:"Auto Deploy"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"main"})}),(0,o.jsx)(n.td,{children:"Production"}),(0,o.jsx)(n.td,{children:"No (approval required)"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"develop"})}),(0,o.jsx)(n.td,{children:"Staging"}),(0,o.jsx)(n.td,{children:"Yes"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"feature/*"})}),(0,o.jsx)(n.td,{children:"Development"}),(0,o.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"cdk-pipeline-with-branches",children:"CDK Pipeline with Branches"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// Development pipeline (auto-deploy)\nnew PipelineStack(app, 'DevPipeline', {\n  repositoryName: 'your-app',\n  branchName: 'develop',\n  connectionArn: connectionArn,\n  autoApprove: true,\n});\n\n// Production pipeline (manual approval)\nnew PipelineStack(app, 'ProdPipeline', {\n  repositoryName: 'your-app',\n  branchName: 'main',\n  connectionArn: connectionArn,\n  autoApprove: false,\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"notifications",children:"Notifications"}),"\n",(0,o.jsx)(n.h3,{id:"sns-notifications",children:"SNS Notifications"}),"\n",(0,o.jsx)(n.p,{children:"Add pipeline notifications:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import * as sns from 'aws-cdk-lib/aws-sns';\nimport * as notifications from 'aws-cdk-lib/aws-codestarnotifications';\n\nconst topic = new sns.Topic(this, 'PipelineNotifications');\n\nnew notifications.NotificationRule(this, 'PipelineNotificationRule', {\n  source: pipeline,\n  events: [\n    'codepipeline-pipeline-pipeline-execution-failed',\n    'codepipeline-pipeline-pipeline-execution-succeeded',\n  ],\n  targets: [topic],\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsx)(n.h3,{id:"security",children:"Security"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Use IAM roles with least privilege"}),"\n",(0,o.jsx)(n.li,{children:"Store secrets in Secrets Manager or Parameter Store"}),"\n",(0,o.jsx)(n.li,{children:"Enable encryption for artifacts"}),"\n",(0,o.jsx)(n.li,{children:"Use VPC for CodeBuild if accessing private resources"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"performance",children:"Performance"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Cache dependencies in CodeBuild"}),"\n",(0,o.jsx)(n.li,{children:"Use appropriate compute types"}),"\n",(0,o.jsx)(n.li,{children:"Parallelize independent actions"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"reliability",children:"Reliability"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Add health checks after deployment"}),"\n",(0,o.jsx)(n.li,{children:"Implement rollback strategies"}),"\n",(0,o.jsx)(n.li,{children:"Use blue-green or canary deployments for production"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Issue"}),(0,o.jsx)(n.th,{children:"Solution"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Source connection failed"}),(0,o.jsx)(n.td,{children:'Verify CodeStar connection is in "Available" status'})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Build timeout"}),(0,o.jsx)(n.td,{children:"Increase timeout in CodeBuild project settings"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Permission denied"}),(0,o.jsx)(n.td,{children:"Check IAM roles have required permissions"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Artifact not found"}),(0,o.jsx)(n.td,{children:"Verify buildspec artifacts configuration"})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"viewing-logs",children:"Viewing Logs"}),"\n",(0,o.jsx)(n.p,{children:"CodeBuild logs are available in CloudWatch Logs:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"aws logs tail /aws/codebuild/your-build-project --follow\n"})}),"\n",(0,o.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"./monitoring-logging",children:"Monitoring and Logging"})," - Set up observability"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"./deployment-guide",children:"Deployment Guide"})," - Manual deployment options"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"./common-issues",children:"Troubleshooting"})," - Common deployment issues"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>r});var t=i(6540);const o={},s=t.createContext(o);function c(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);