"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[1821],{1891:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"tasks","title":"Task","description":"Learn how to create and process long-running task","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/tasks.md","sourceDirName":".","slug":"/tasks","permalink":"/docs/tasks","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"description":"Learn how to create and process long-running task"},"sidebar":"tutorialSidebar","previous":{"title":"Sequence","permalink":"/docs/sequence"},"next":{"title":"Tenant","permalink":"/docs/tenant"}}');var a=t(4848),r=t(8453);const i={description:"Learn how to create and process long-running task"},o="Task",c={},l=[{value:"Architecture",id:"architecture",level:2},{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Single task processing",id:"single-task-processing",level:3},{value:"Task processing with Step function",id:"task-processing-with-step-function",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"TaskService Methods",id:"taskservice-methods",level:3},{value:"<code>createTask(dto: CreateTaskDto, options: { invokeContext: IInvoke }): Promise&lt;TaskEntity&gt;</code>",id:"createtaskdto-createtaskdto-options--invokecontext-iinvoke--promisetaskentity",level:4},{value:"<code>createStepFunctionTask(dto: CreateTaskDto, options: { invokeContext: IInvoke }): Promise&lt;TaskEntity&gt;</code>",id:"createstepfunctiontaskdto-createtaskdto-options--invokecontext-iinvoke--promisetaskentity",level:4},{value:"<code>getTask(key: DetailKey): Promise&lt;TaskEntity&gt;</code>",id:"gettaskkey-detailkey-promisetaskentity",level:4},{value:"<code>listItemsByPk(tenantCode: string, type?: string, options?: ListTaskOptions): Promise&lt;TaskListEntity&gt;</code>",id:"listitemsbypktenantcode-string-type-string-options-listtaskoptions-promisetasklistentity",level:4},{value:"<code>createSubTask(event: TaskQueueEvent): Promise&lt;TaskEntity[]&gt;</code>",id:"createsubtaskevent-taskqueueevent-promisetaskentity",level:4},{value:"<code>getAllSubTask(subTask: DetailKey): Promise&lt;TaskEntity[]&gt;</code>",id:"getallsubtasksubtask-detailkey-promisetaskentity",level:4},{value:"<code>updateStatus(key: DetailKey, status: string, attributes?: { result?: any; error?: any }, notifyId?: string): Promise&lt;void&gt;</code>",id:"updatestatuskey-detailkey-status-string-attributes--result-any-error-any--notifyid-string-promisevoid",level:4},{value:"<code>updateSubTaskStatus(key: DetailKey, status: string, attributes?: { result?: any; error?: any }, notifyId?: string): Promise&lt;void&gt;</code>",id:"updatesubtaskstatuskey-detailkey-status-string-attributes--result-any-error-any--notifyid-string-promisevoid",level:4},{value:"<code>updateStepFunctionTask(key: DetailKey, attributes?: Record&lt;string, any&gt;, status?: string, notifyId?: string): Promise&lt;void&gt;</code>",id:"updatestepfunctiontaskkey-detailkey-attributes-recordstring-any-status-string-notifyid-string-promisevoid",level:4},{value:"<code>publishAlarm(event: TaskQueueEvent | StepFunctionTaskEvent, errorDetails: any): Promise&lt;void&gt;</code>",id:"publishalarmevent-taskqueueevent--stepfunctiontaskevent-errordetails-any-promisevoid",level:4},{value:"<code>formatTaskStatus(tasks: TaskEntity[]): Promise&lt;object&gt;</code>",id:"formattaskstatustasks-taskentity-promiseobject",level:4},{value:"Task Status Values",id:"task-status-values",level:3},{value:"CreateTaskDto",id:"createtaskdto",level:3},{value:"ITaskQueueEventFactory Interface",id:"itaskqueueeventfactory-interface",level:3}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"task",children:"Task"})}),"\n",(0,a.jsx)(n.p,{children:"The Task package provides comprehensive task management functionality in the MBC CQRS Serverless framework. It enables:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Asynchronous task execution"}),"\n",(0,a.jsx)(n.li,{children:"Task status tracking"}),"\n",(0,a.jsx)(n.li,{children:"Progress monitoring"}),"\n",(0,a.jsx)(n.li,{children:"Error handling and retries"}),"\n",(0,a.jsx)(n.li,{children:"Task queue management"}),"\n",(0,a.jsx)(n.li,{children:"Task history and logging"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant TaskService\n    participant DynamoDB\n    participant StepFunctions\n    participant Lambda\n\n    Client->>TaskService: createTask() / createStepFunctionTask()\n    TaskService->>DynamoDB: Save task (CREATED)\n    TaskService->>StepFunctions: Start execution\n    StepFunctions--\x3e>TaskService: Execution ARN\n    TaskService--\x3e>Client: TaskEntity\n\n    loop For each sub-task\n        StepFunctions->>Lambda: Execute sub-task\n        Lambda->>DynamoDB: Update status (PROCESSING)\n        Lambda->>Lambda: Process\n        Lambda->>DynamoDB: Update status (COMPLETED/FAILED)\n    end\n\n    StepFunctions->>DynamoDB: Update parent task status"}),"\n",(0,a.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npm install @mbc-cqrs-serverless/task\n"})}),"\n",(0,a.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,a.jsx)(n.p,{children:"There are 2 type task processing:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Single task processing"}),"\n",(0,a.jsx)(n.li,{children:"Task processing with Step function"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"single-task-processing",children:"Single task processing"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Define task event"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { TaskQueueEvent } from "@mbc-cqrs-serverless/task";\n\nexport class TaskEvent extends TaskQueueEvent {}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Define task event handler"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { EventHandler, IEventHandler } from "@mbc-cqrs-serverless/core";\nimport { Logger } from "@nestjs/common";\n\nimport { TaskEvent } from "./task.event";\n\n@EventHandler(TaskEvent)\nexport class TaskEventHandler implements IEventHandler<TaskEvent> {\n  private readonly logger = new Logger(TaskEventHandler.name);\n\n  constructor() {}\n\n  async execute(event: TaskEvent): Promise<any> {\n    this.logger.debug("executing task event::", event);\n\n    //\n\n    this.logger.debug(`Process task completed: ${event.taskEvent.eventID}`);\n    return "Result after process";\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsxs)(n.li,{children:["Implement ",(0,a.jsx)(n.code,{children:"ITaskQueueEventFactory"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import {\n  ITaskQueueEventFactory,\n  TaskQueueEvent,\n} from "@mbc-cqrs-serverless/task";\nimport { TaskEvent } from "src/sample/handler/task.event";\n\nexport class TaskQueueEventFactory implements ITaskQueueEventFactory {\n  async transformTask(event: TaskQueueEvent): Promise<any[]> {\n    return [new TaskEvent().fromSqsRecord(event)];\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsxs)(n.li,{children:["Custom ",(0,a.jsx)(n.code,{children:"TaskModule"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { TaskModule } from "@mbc-cqrs-serverless/task";\nimport { Module } from "@nestjs/common";\nimport { TaskEventHandler } from "src/sample/handler/task.handler";\n\nimport { TaskQueueEventFactory } from "./task-queue-event-factory";\n\n@Module({\n  imports: [\n    TaskModule.register({\n      taskQueueEventFactory: TaskQueueEventFactory,\n      enableController: true, // Optional: enable REST endpoints for task management\n    }),\n  ],\n  providers: [TaskEventHandler],\n  exports: [TaskModule],\n})\nexport class CustomTaskModule {}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"5",children:["\n",(0,a.jsxs)(n.li,{children:["Custom ",(0,a.jsx)(n.code,{children:"EventFactoryAddedTask"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { EventFactory, IEvent } from "@mbc-cqrs-serverless/core";\nimport { EventFactoryAddedTask, TaskEvent } from "@mbc-cqrs-serverless/task";\nimport { Logger } from "@nestjs/common";\nimport { DynamoDBStreamEvent } from "aws-lambda";\n\n@EventFactory()\nexport class CustomEventFactory extends EventFactoryAddedTask {\n  private readonly logger = new Logger(CustomEventFactory.name);\n  async transformDynamodbStream(event: DynamoDBStreamEvent): Promise<IEvent[]> {\n    const curEvents = await super.transformDynamodbStream(event);\n    const taskEvents = event.Records.map((record) => {\n      if (\n        record.eventSourceARN.endsWith("tasks") ||\n        record.eventSourceARN.includes("tasks" + "/stream/")\n      ) {\n        if (record.eventName === "INSERT") {\n          return new TaskEvent().fromDynamoDBRecord(record);\n        }\n      }\n      return undefined;\n    })\n      .filter((event) => !!event)\n      .filter((event) => event.taskEntity.sk.split("#").length < 3);\n\n    return [...curEvents, ...taskEvents];\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"6",children:["\n",(0,a.jsx)(n.li,{children:"Create a Task"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"task-processing-with-step-function",children:"Task processing with Step function"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Define step function task event"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { StepFunctionTaskEvent } from "@mbc-cqrs-serverless/task";\n\nexport class SfnTaskEvent extends StepFunctionTaskEvent {}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Define step function task event handler"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import {\n  EventHandler,\n  IEventHandler,\n  StepFunctionService,\n} from "@mbc-cqrs-serverless/core";\nimport { TaskService } from "@mbc-cqrs-serverless/task";\nimport { Logger } from "@nestjs/common";\nimport { ConfigService } from "@nestjs/config";\n\nimport { SfnTaskEvent } from "./sfn-task.event";\n\n@EventHandler(SfnTaskEvent)\nexport class SfnTaskEventHandler implements IEventHandler<SfnTaskEvent> {\n  private readonly logger = new Logger(SfnTaskEventHandler.name);\n\n  constructor() {}\n\n  async execute(event: SfnTaskEvent): Promise<any> {\n    this.logger.debug("executing task event::", event);\n\n    //\n\n    return "Result after process";\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsxs)(n.li,{children:["Implement ",(0,a.jsx)(n.code,{children:"ITaskQueueEventFactory"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import {\n  ITaskQueueEventFactory,\n  StepFunctionTaskEvent,\n} from "@mbc-cqrs-serverless/task";\nimport { SfnTaskEvent } from "src/sample/handler/sfn-task.event";\n\nexport class TaskQueueEventFactory implements ITaskQueueEventFactory {\n  async transformStepFunctionTask(event: StepFunctionTaskEvent): Promise<any[]> {\n    return [new SfnTaskEvent(event)];\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsxs)(n.li,{children:["Custom ",(0,a.jsx)(n.code,{children:"TaskModule"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { TaskModule } from "@mbc-cqrs-serverless/task";\nimport { Module } from "@nestjs/common";\nimport { TaskEventHandler } from "src/sample/handler/task.handler";\n\nimport { TaskQueueEventFactory } from "./task-queue-event-factory";\n\n@Module({\n  imports: [\n    TaskModule.register({\n      taskQueueEventFactory: TaskQueueEventFactory,\n      enableController: true, // Optional: enable REST endpoints for task management\n    }),\n  ],\n  providers: [TaskEventHandler],\n  exports: [TaskModule],\n})\nexport class CustomTaskModule {}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"5",children:["\n",(0,a.jsxs)(n.li,{children:["Custom ",(0,a.jsx)(n.code,{children:"EventFactoryAddedTask"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { EventFactory, IEvent } from "@mbc-cqrs-serverless/core";\nimport { EventFactoryAddedTask, TaskEvent } from "@mbc-cqrs-serverless/task";\nimport { Logger } from "@nestjs/common";\nimport { DynamoDBStreamEvent } from "aws-lambda";\n\n@EventFactory()\nexport class CustomEventFactory extends EventFactoryAddedTask {\n  private readonly logger = new Logger(CustomEventFactory.name);\n  async transformDynamodbStream(event: DynamoDBStreamEvent): Promise<IEvent[]> {\n    const curEvents = await super.transformDynamodbStream(event);\n    const taskEvents = event.Records.map((record) => {\n      if (\n        record.eventSourceARN.endsWith("tasks") ||\n        record.eventSourceARN.includes("tasks" + "/stream/")\n      ) {\n        if (record.eventName === "INSERT") {\n          return new TaskEvent().fromDynamoDBRecord(record);\n        }\n      }\n      return undefined;\n    })\n      .filter((event) => !!event)\n      .filter((event) => event.taskEntity.sk.split("#").length < 3);\n\n    return [...curEvents, ...taskEvents];\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"6",children:["\n",(0,a.jsx)(n.li,{children:"Create a step function task"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'const item = [\n  { key: "value1" },\n  { key: "value2" },\n  { key: "value3" },\n  { key: "value4" },\n  { key: "value5" },\n  { key: "value6" },\n];\n\nawait this.taskService.createStepFunctionTask(\n  {\n    input: item,\n    taskType: "cat",\n    tenantCode: "mbc",\n  },\n  { invokeContext }\n);\n'})}),"\n",(0,a.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,a.jsx)(n.h3,{id:"taskservice-methods",children:"TaskService Methods"}),"\n",(0,a.jsx)(n.h4,{id:"createtaskdto-createtaskdto-options--invokecontext-iinvoke--promisetaskentity",children:(0,a.jsx)(n.code,{children:"createTask(dto: CreateTaskDto, options: { invokeContext: IInvoke }): Promise<TaskEntity>"})}),"\n",(0,a.jsx)(n.p,{children:"Creates a new task for single task processing."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'const task = await this.taskService.createTask(\n  {\n    taskType: "data-export",\n    tenantCode: "mbc",\n    name: "Export user data",\n    input: { userId: "123", format: "csv" },\n  },\n  { invokeContext }\n);\n'})}),"\n",(0,a.jsx)(n.h4,{id:"createstepfunctiontaskdto-createtaskdto-options--invokecontext-iinvoke--promisetaskentity",children:(0,a.jsx)(n.code,{children:"createStepFunctionTask(dto: CreateTaskDto, options: { invokeContext: IInvoke }): Promise<TaskEntity>"})}),"\n",(0,a.jsx)(n.p,{children:"Creates a new task for Step Functions processing. The input array will be processed as subtasks."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'const task = await this.taskService.createStepFunctionTask(\n  {\n    taskType: "batch-process",\n    tenantCode: "mbc",\n    name: "Process batch items",\n    input: [{ id: 1 }, { id: 2 }, { id: 3 }],\n  },\n  { invokeContext }\n);\n'})}),"\n",(0,a.jsx)(n.h4,{id:"gettaskkey-detailkey-promisetaskentity",children:(0,a.jsx)(n.code,{children:"getTask(key: DetailKey): Promise<TaskEntity>"})}),"\n",(0,a.jsx)(n.p,{children:"Retrieves a task by its primary key."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'const task = await this.taskService.getTask({\n  pk: "TASK#mbc",\n  sk: "data-export#01HXYZ123",\n});\n'})}),"\n",(0,a.jsx)(n.h4,{id:"listitemsbypktenantcode-string-type-string-options-listtaskoptions-promisetasklistentity",children:(0,a.jsx)(n.code,{children:"listItemsByPk(tenantCode: string, type?: string, options?: ListTaskOptions): Promise<TaskListEntity>"})}),"\n",(0,a.jsx)(n.p,{children:"Lists tasks by tenant code and type."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"ListTaskOptions:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"interface ListTaskOptions {\n  sk?: {\n    skExpession: string;\n    skAttributeValues: Record<string, string>;\n    skAttributeNames?: Record<string, string>;\n  };\n  startFromSk?: string;  // For pagination\n  limit?: number;\n  order?: 'asc' | 'desc';\n}\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'// List all tasks for a tenant\nconst tasks = await this.taskService.listItemsByPk("mbc", "TASK", {\n  limit: 10,\n  order: "desc",\n});\n\n// List Step Function tasks\nconst sfnTasks = await this.taskService.listItemsByPk("mbc", "SFN_TASK");\n\n// Paginate through results\nconst nextPage = await this.taskService.listItemsByPk("mbc", "TASK", {\n  startFromSk: tasks.lastSk,\n  limit: 10,\n});\n'})}),"\n",(0,a.jsx)(n.h4,{id:"createsubtaskevent-taskqueueevent-promisetaskentity",children:(0,a.jsx)(n.code,{children:"createSubTask(event: TaskQueueEvent): Promise<TaskEntity[]>"})}),"\n",(0,a.jsx)(n.p,{children:"Creates subtasks from a parent task's input array. Each item in the input array becomes a separate subtask."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// Typically called within a TaskQueueEvent handler\nconst subTasks = await this.taskService.createSubTask(event);\n// Returns array of TaskEntity for each input item\n"})}),"\n",(0,a.jsx)(n.h4,{id:"getallsubtasksubtask-detailkey-promisetaskentity",children:(0,a.jsx)(n.code,{children:"getAllSubTask(subTask: DetailKey): Promise<TaskEntity[]>"})}),"\n",(0,a.jsx)(n.p,{children:"Retrieves all subtasks for a parent task."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'const subTasks = await this.taskService.getAllSubTask({\n  pk: "SFN_TASK#mbc",\n  sk: "batch-process#01HXYZ123#0", // Any subtask key\n});\n// Returns all subtasks under the parent task\n'})}),"\n",(0,a.jsx)(n.h4,{id:"updatestatuskey-detailkey-status-string-attributes--result-any-error-any--notifyid-string-promisevoid",children:(0,a.jsx)(n.code,{children:"updateStatus(key: DetailKey, status: string, attributes?: { result?: any; error?: any }, notifyId?: string): Promise<void>"})}),"\n",(0,a.jsx)(n.p,{children:"Updates the status of a task and sends an SNS notification."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'// Mark task as completed\nawait this.taskService.updateStatus(\n  { pk: "TASK#mbc", sk: "data-export#01HXYZ123" },\n  "COMPLETED",\n  { result: { exportedRows: 100 } }\n);\n\n// Mark task as failed\nawait this.taskService.updateStatus(\n  { pk: "TASK#mbc", sk: "data-export#01HXYZ123" },\n  "FAILED",\n  { error: { message: "Export failed", code: "EXPORT_ERROR" } }\n);\n'})}),"\n",(0,a.jsx)(n.h4,{id:"updatesubtaskstatuskey-detailkey-status-string-attributes--result-any-error-any--notifyid-string-promisevoid",children:(0,a.jsx)(n.code,{children:"updateSubTaskStatus(key: DetailKey, status: string, attributes?: { result?: any; error?: any }, notifyId?: string): Promise<void>"})}),"\n",(0,a.jsxs)(n.p,{children:["Updates the status of a subtask and sends an SNS notification with action ",(0,a.jsx)(n.code,{children:'"sub-task-status"'}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'await this.taskService.updateSubTaskStatus(\n  { pk: "SFN_TASK#mbc", sk: "batch-process#01HXYZ123#0" },\n  "COMPLETED",\n  { result: { processedItem: { id: 1 } } }\n);\n'})}),"\n",(0,a.jsx)(n.h4,{id:"updatestepfunctiontaskkey-detailkey-attributes-recordstring-any-status-string-notifyid-string-promisevoid",children:(0,a.jsx)(n.code,{children:"updateStepFunctionTask(key: DetailKey, attributes?: Record<string, any>, status?: string, notifyId?: string): Promise<void>"})}),"\n",(0,a.jsx)(n.p,{children:"Updates a Step Function task with attributes and status, then sends an SNS notification."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'await this.taskService.updateStepFunctionTask(\n  { pk: "SFN_TASK#mbc", sk: "batch-process#01HXYZ123" },\n  { executionArn: "arn:aws:states:..." },\n  "PROCESSING"\n);\n'})}),"\n",(0,a.jsx)(n.h4,{id:"publishalarmevent-taskqueueevent--stepfunctiontaskevent-errordetails-any-promisevoid",children:(0,a.jsx)(n.code,{children:"publishAlarm(event: TaskQueueEvent | StepFunctionTaskEvent, errorDetails: any): Promise<void>"})}),"\n",(0,a.jsx)(n.p,{children:"Publishes an alarm notification via SNS when an error occurs during task processing. This method is typically called from error handlers in task processing workflows."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"try {\n  // Process task\n  await this.processTask(event);\n} catch (error) {\n  // Send alarm notification\n  await this.taskService.publishAlarm(event, {\n    message: error.message,\n    stack: error.stack,\n  });\n  throw error;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"The alarm notification includes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Task key (",(0,a.jsx)(n.code,{children:"pk"}),", ",(0,a.jsx)(n.code,{children:"sk"}),")"]}),"\n",(0,a.jsx)(n.li,{children:"Tenant code"}),"\n",(0,a.jsx)(n.li,{children:"Error details"}),"\n",(0,a.jsxs)(n.li,{children:["Action type: ",(0,a.jsx)(n.code,{children:'"sfn-alarm"'})]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"formattaskstatustasks-taskentity-promiseobject",children:(0,a.jsx)(n.code,{children:"formatTaskStatus(tasks: TaskEntity[]): Promise<object>"})}),"\n",(0,a.jsx)(n.p,{children:"Formats the task status by calculating subtask counts and aggregating status information. Useful for displaying task progress in UI."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'// Get all subtasks for a parent task\nconst subTasks = await this.taskService.getAllSubTask({\n  pk: "SFN_TASK#mbc",\n  sk: "batch-process#01HXYZ123#0"\n});\n\nconst formattedStatus = await this.taskService.formatTaskStatus(subTasks);\n// Returns:\n// {\n//   subTaskCount: 10,           // Total number of subtasks\n//   subTaskSucceedCount: 7,     // Number of completed subtasks\n//   subTaskFailedCount: 1,      // Number of failed subtasks\n//   subTaskRunningCount: 2,     // Number of in-progress subtasks\n//   subTasks: [                 // Array of subtask summaries\n//     { pk: "...", sk: "...", status: "COMPLETED" },\n//     ...\n//   ]\n// }\n'})}),"\n",(0,a.jsx)(n.p,{children:"The return object structure:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"{\n  subTaskCount: number;        // Total subtask count\n  subTaskSucceedCount: number; // COMPLETED subtasks\n  subTaskFailedCount: number;  // FAILED subtasks\n  subTaskRunningCount: number; // PROCESSING subtasks\n  subTasks: Array<{            // Subtask summary array\n    pk: string;\n    sk: string;\n    status: string;\n  }>;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"task-status-values",children:"Task Status Values"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Status"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"CREATED"})}),(0,a.jsx)(n.td,{children:"Task has been created but not yet started"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"QUEUED"})}),(0,a.jsx)(n.td,{children:"Task has been queued for processing"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"STARTED"})}),(0,a.jsx)(n.td,{children:"Task execution has started"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"PROCESSING"})}),(0,a.jsx)(n.td,{children:"Task is currently being processed"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"FINISHED"})}),(0,a.jsx)(n.td,{children:"Task execution has finished"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"COMPLETED"})}),(0,a.jsx)(n.td,{children:"Task finished successfully"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"ERRORED"})}),(0,a.jsx)(n.td,{children:"Task encountered an error during execution"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"FAILED"})}),(0,a.jsx)(n.td,{children:"Task failed with an error"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"createtaskdto",children:"CreateTaskDto"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"CreateTaskDto"})," class defines the structure for creating a new task:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"interface CreateTaskDto {\n  tenantCode: string;  // Required: Tenant identifier\n  taskType: string;    // Required: Type/category of the task\n  name?: string;       // Optional: Display name (defaults to taskType)\n  input: Record<string, any> | any[];  // Required: Task input data\n}\n"})}),"\n",(0,a.jsx)(n.admonition,{title:"Input Format for Step Functions",type:"info",children:(0,a.jsxs)(n.p,{children:["When using ",(0,a.jsx)(n.code,{children:"createStepFunctionTask()"}),", the ",(0,a.jsx)(n.code,{children:"input"})," field must be an ",(0,a.jsx)(n.strong,{children:"array"}),". Each item in the array becomes a separate subtask that will be processed by the Step Functions Map state. For single task processing with ",(0,a.jsx)(n.code,{children:"createTask()"}),", the input can be any object."]})}),"\n",(0,a.jsx)(n.h3,{id:"itaskqueueeventfactory-interface",children:"ITaskQueueEventFactory Interface"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"ITaskQueueEventFactory"})," interface defines optional methods for transforming task events. You only need to implement the method(s) relevant to your use case:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"interface ITaskQueueEventFactory<TEvent extends IEvent = any> {\n  transformTask?(event: TaskQueueEvent): Promise<TEvent[]>;           // Optional: For single task processing\n  transformStepFunctionTask?(event: StepFunctionTaskEvent): Promise<TEvent[]>;  // Optional: For Step Function task processing\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Note: Both methods are optional. Implement ",(0,a.jsx)(n.code,{children:"transformTask"})," for single task processing, or ",(0,a.jsx)(n.code,{children:"transformStepFunctionTask"})," for Step Function task processing, or both if your application uses both types."]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(6540);const a={},r=s.createContext(a);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);