"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[9761],{8570:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"directory","title":"Directory","description":"Directory management functionality with S3 integration for the MBC CQRS Serverless framework.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/directory.md","sourceDirName":".","slug":"/directory","permalink":"/docs/directory","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Master","permalink":"/docs/master"},"next":{"title":"Import","permalink":"/docs/import"}}');var n=t(4848),o=t(8453);const s={sidebar_position:7},d="Directory",a={},l=[{value:"Installation",id:"installation",level:2},{value:"Overview",id:"overview",level:2},{value:"Features",id:"features",level:2},{value:"Basic Setup",id:"basic-setup",level:2},{value:"Module Configuration",id:"module-configuration",level:3},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"Creating Folders",id:"creating-folders",level:2},{value:"Uploading Files",id:"uploading-files",level:2},{value:"Listing Contents",id:"listing-contents",level:2},{value:"File Operations",id:"file-operations",level:2},{value:"Updating Items",id:"updating-items",level:2},{value:"Renaming Items",id:"renaming-items",level:2},{value:"Managing Permissions",id:"managing-permissions",level:2},{value:"Permission Types",id:"permission-types",level:3},{value:"Directory Attributes",id:"directory-attributes",level:3},{value:"Updating Permissions",id:"updating-permissions",level:3},{value:"Checking Permissions",id:"checking-permissions",level:3},{value:"Moving and Copying",id:"moving-and-copying",level:2},{value:"Move Item",id:"move-item",level:3},{value:"Copy Item",id:"copy-item",level:3},{value:"Version History",id:"version-history",level:2},{value:"Restore Previous Version",id:"restore-previous-version",level:3},{value:"Restore Temporarily Deleted Item",id:"restore-temporarily-deleted-item",level:3},{value:"Directory DTOs",id:"directory-dtos",level:2},{value:"DirectoryCreateDto",id:"directorycreatedto",level:3},{value:"DirectoryUpdateDto",id:"directoryupdatedto",level:3},{value:"DirectoryRenameDto",id:"directoryrenamedto",level:3},{value:"DirectoryMoveDto",id:"directorymovedto",level:3},{value:"DirectoryCopyDto",id:"directorycopydto",level:3},{value:"DirectoryDetailDto",id:"directorydetaildto",level:3},{value:"DirectoryUpdatePermissionDto",id:"directoryupdatepermissiondto",level:3},{value:"Directory Structure",id:"directory-structure",level:2},{value:"Multi-tenant Isolation",id:"multi-tenant-isolation",level:2},{value:"Event Handling",id:"event-handling",level:2},{value:"Best Practices",id:"best-practices",level:2}];function c(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"directory",children:"Directory"})}),"\n",(0,n.jsx)(r.p,{children:"Directory management functionality with S3 integration for the MBC CQRS Serverless framework."}),"\n",(0,n.jsx)(r.h2,{id:"installation",children:"Installation"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"npm install @mbc-cqrs-serverless/directory\n"})}),"\n",(0,n.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsx)(r.p,{children:"The Directory package provides comprehensive file and folder management in a multi-tenant CQRS architecture. It integrates with Amazon S3 for file storage and supports granular access permissions."}),"\n",(0,n.jsx)(r.h2,{id:"features",children:"Features"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Directory CRUD Operations"}),": Create, read, update, and delete folders and files"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"S3 Integration"}),": Full file management with Amazon S3"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Access Permissions"}),": Granular permissions for specific folders and files"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Multi-tenant Support"}),": Tenant-isolated directory management"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Event-Driven Architecture"}),": Built on CQRS pattern with command/event handling"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"RESTful API"}),": Complete REST API for directory operations"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Version History"}),": Track and restore previous versions of files and folders"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,n.jsx)(r.h3,{id:"module-configuration",children:"Module Configuration"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"import { DirectoryStorageModule } from '@mbc-cqrs-serverless/directory';\nimport { Module } from '@nestjs/common';\nimport { PrismaService } from './prisma.service';\n\n@Module({\n  imports: [\n    DirectoryStorageModule.register({\n      enableController: true,  // Enable REST API endpoints\n      prismaService: PrismaService,  // Required when enableController is true\n      dataSyncHandlers: [],  // Optional data sync handlers\n    }),\n  ],\n})\nexport class AppModule {}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Method"}),(0,n.jsx)(r.th,{children:"Endpoint"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"POST"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/"})}),(0,n.jsx)(r.td,{children:"Create a new file or folder"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"GET"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/summary"})}),(0,n.jsx)(r.td,{children:"Get tenant file size summary"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"GET"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id"})}),(0,n.jsx)(r.td,{children:"Get details for a specific file or folder"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"GET"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id/history"})}),(0,n.jsx)(r.td,{children:"Get version history of a file or folder"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"POST"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id/history/:version/restore"})}),(0,n.jsx)(r.td,{children:"Restore a specific version"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"PUT"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id/restore"})}),(0,n.jsx)(r.td,{children:"Restore a temporarily deleted item"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"PATCH"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id"})}),(0,n.jsx)(r.td,{children:"Update a specific file or folder"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"PATCH"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id/permission"})}),(0,n.jsx)(r.td,{children:"Update permissions for a file or folder"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"PATCH"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id/rename"})}),(0,n.jsx)(r.td,{children:"Rename a file or folder"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"PATCH"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id/copy"})}),(0,n.jsx)(r.td,{children:"Copy a file or folder"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"PATCH"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id/move"})}),(0,n.jsx)(r.td,{children:"Move a file or folder"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"DELETE"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id"})}),(0,n.jsx)(r.td,{children:"Soft delete a file or folder"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"DELETE"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/:id/bin"})}),(0,n.jsx)(r.td,{children:"Permanently delete a file and remove from S3"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"POST"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/file/view"})}),(0,n.jsx)(r.td,{children:"Generate a presigned URL for viewing a file"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"POST"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/api/directory/file"})}),(0,n.jsx)(r.td,{children:"Generate a presigned URL for uploading a file"})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"creating-folders",children:"Creating Folders"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"import { DirectoryService, DirectoryCreateDto, DirectoryDataEntity } from '@mbc-cqrs-serverless/directory';\nimport { IInvoke } from '@mbc-cqrs-serverless/core';\nimport { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class FolderService {\n  constructor(private readonly directoryService: DirectoryService) {}\n\n  async createFolder(\n    createDto: DirectoryCreateDto,\n    invokeContext: IInvoke,\n  ): Promise<DirectoryDataEntity> {\n    return this.directoryService.create(createDto, { invokeContext });\n  }\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"uploading-files",children:"Uploading Files"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"async uploadFile(\n  createDto: DirectoryCreateDto,\n  invokeContext: IInvoke,\n): Promise<DirectoryDataEntity> {\n  // File upload is handled through the create method with file content\n  return this.directoryService.create(createDto, { invokeContext });\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"listing-contents",children:"Listing Contents"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"async getDirectory(\n  detailDto: DetailDto,\n  invokeContext: IInvoke,\n  queryDto: DirectoryDetailDto,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.findOne(detailDto, { invokeContext }, queryDto);\n}\n\nasync getDirectoryHistory(\n  detailDto: DetailDto,\n  invokeContext: IInvoke,\n  queryDto: DirectoryDetailDto,\n): Promise<DirectoryDataListEntity> {\n  return this.directoryService.findHistory(detailDto, { invokeContext }, queryDto);\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"file-operations",children:"File Operations"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"// Get file attributes\nasync getFileAttributes(detailDto: DetailDto): Promise<DirectoryAttributes> {\n  return this.directoryService.getItemAttributes(detailDto);\n}\n\n// Get file item\nasync getFile(detailDto: DetailDto): Promise<DirectoryDataEntity> {\n  return this.directoryService.getItem(detailDto);\n}\n\n// Soft delete (marks as deleted)\nasync removeItem(\n  detailDto: DetailDto,\n  invokeContext: IInvoke,\n  queryDto: DirectoryDetailDto,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.remove(detailDto, { invokeContext }, queryDto);\n}\n\n// Permanently remove file and delete from S3\nasync removeFile(\n  detailDto: DetailDto,\n  invokeContext: IInvoke,\n  queryDto: DirectoryDetailDto,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.removeFile(detailDto, { invokeContext }, queryDto);\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"updating-items",children:"Updating Items"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"import { DirectoryUpdateDto } from '@mbc-cqrs-serverless/directory';\n\nasync updateItem(\n  detailDto: DetailDto,\n  updateDto: DirectoryUpdateDto,\n  invokeContext: IInvoke,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.update(detailDto, updateDto, { invokeContext });\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"renaming-items",children:"Renaming Items"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"import { DirectoryRenameDto } from '@mbc-cqrs-serverless/directory';\n\nasync renameItem(\n  detailDto: DetailDto,\n  renameDto: DirectoryRenameDto,\n  invokeContext: IInvoke,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.rename(detailDto, renameDto, { invokeContext });\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"managing-permissions",children:"Managing Permissions"}),"\n",(0,n.jsx)(r.h3,{id:"permission-types",children:"Permission Types"}),"\n",(0,n.jsx)(r.p,{children:"The directory package supports different permission types:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"enum FilePermission {\n  GENERAL = 'GENERAL',      // General access for everyone\n  RESTRICTED = 'RESTRICTED', // Restricted to specific users\n  DOMAIN = 'DOMAIN',        // Restricted to specific email domain\n  TENANT = 'TENANT',        // Restricted to tenant members\n}\n\nenum FileRole {\n  READ = 'READ',\n  WRITE = 'WRITE',\n  DELETE = 'DELETE',\n  CHANGE_PERMISSION = 'CHANGE_PERMISSION',\n  TAKE_OWNERSHIP = 'TAKE_OWNERSHIP',\n}\n\nenum EmailType {\n  EMAIL = 'EMAIL',           // Individual email address\n  EMAIL_GROUP = 'EMAIL_GROUP', // Email group or distribution list\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"directory-attributes",children:"Directory Attributes"}),"\n",(0,n.jsx)(r.p,{children:"The DirectoryAttributes interface defines the metadata for files and folders:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"interface DirectoryAttributes {\n  expirationTime?: string;   // Expiration time for the item\n  fileSize?: number;         // File size in bytes\n  fileType?: string;         // MIME type of the file\n  parentId?: string;         // Parent folder ID\n  owner: OwnerDto;           // Owner information\n  s3Key?: string;            // S3 object key\n  ancestors?: string[];      // Array of ancestor folder IDs\n  inheritance?: boolean;     // Whether to inherit parent permissions\n  tags?: string[];           // Tags for categorization\n  permission?: PermissionDto; // Permission settings\n}\n\ninterface OwnerDto {\n  email: string;   // Owner's email address\n  ownerId: string; // Owner's user ID\n}\n\ninterface PermissionDto {\n  type: FilePermission;        // Permission type\n  role: FileRole;              // Default role for this permission\n  domain?: DomainDto;          // Domain restriction (for DOMAIN type)\n  users?: UserPermissionDto[]; // User-specific permissions (for RESTRICTED type)\n}\n\ninterface DomainDto {\n  email: string; // Email domain (e.g., \"example.com\")\n}\n\ninterface UserPermissionDto {\n  email: string;    // User's email address\n  role: FileRole;   // Role assigned to this user\n  id: string;       // User ID\n  type: EmailType;  // Email type (EMAIL or EMAIL_GROUP)\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"updating-permissions",children:"Updating Permissions"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"import { DirectoryUpdatePermissionDto } from '@mbc-cqrs-serverless/directory';\n\nasync updatePermission(\n  detailDto: DetailDto,\n  updateDto: DirectoryUpdatePermissionDto,\n  invokeContext: IInvoke,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.updatePermission(detailDto, updateDto, { invokeContext });\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"checking-permissions",children:"Checking Permissions"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"async hasPermission(\n  itemId: DetailDto,\n  requiredRole: FileRole[],\n  user?: { email?: string; tenant?: string },\n): Promise<boolean> {\n  return this.directoryService.hasPermission(itemId, requiredRole, user);\n}\n\nasync getEffectiveRole(\n  itemId: DetailDto,\n  user?: { email?: string; tenant?: string },\n): Promise<FileRole | null> {\n  return this.directoryService.getEffectiveRole(itemId, user);\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"moving-and-copying",children:"Moving and Copying"}),"\n",(0,n.jsx)(r.h3,{id:"move-item",children:"Move Item"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"import { DirectoryMoveDto } from '@mbc-cqrs-serverless/directory';\n\nasync moveItem(\n  detailDto: DetailDto,\n  moveDto: DirectoryMoveDto,\n  invokeContext: IInvoke,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.move(detailDto, moveDto, { invokeContext });\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"copy-item",children:"Copy Item"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"import { DirectoryCopyDto } from '@mbc-cqrs-serverless/directory';\n\nasync copyItem(\n  detailDto: DetailDto,\n  copyDto: DirectoryCopyDto,\n  invokeContext: IInvoke,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.copy(detailDto, copyDto, { invokeContext });\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"version-history",children:"Version History"}),"\n",(0,n.jsx)(r.h3,{id:"restore-previous-version",children:"Restore Previous Version"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"async restoreVersion(\n  detailDto: DetailDto,\n  version: string,\n  queryDto: DirectoryDetailDto,\n  invokeContext: IInvoke,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.restoreHistoryItem(detailDto, version, queryDto, { invokeContext });\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"restore-temporarily-deleted-item",children:"Restore Temporarily Deleted Item"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"async restoreTemporary(\n  detailDto: DetailDto,\n  queryDto: DirectoryDetailDto,\n  invokeContext: IInvoke,\n): Promise<DirectoryDataEntity> {\n  return this.directoryService.restoreTemporary(detailDto, queryDto, { invokeContext });\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"directory-dtos",children:"Directory DTOs"}),"\n",(0,n.jsx)(r.p,{children:"The directory package provides several DTOs for different operations:"}),"\n",(0,n.jsx)(r.h3,{id:"directorycreatedto",children:"DirectoryCreateDto"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"interface DirectoryCreateDto {\n  name: string;              // Item name\n  type: string;              // Item type (e.g., 'folder', 'file')\n  attributes?: DirectoryAttributes; // Optional attributes\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"directoryupdatedto",children:"DirectoryUpdateDto"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"interface DirectoryUpdateDto {\n  email: string;                    // Requester's email for permission check\n  name?: string;                    // New name (optional)\n  isDeleted?: boolean;              // Deletion flag\n  attributes?: DirectoryAttributes; // Updated attributes\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"directoryrenamedto",children:"DirectoryRenameDto"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"interface DirectoryRenameDto {\n  name: string;  // New name\n  email: string; // Requester's email for permission check\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"directorymovedto",children:"DirectoryMoveDto"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"interface DirectoryMoveDto {\n  parentId?: string; // Target parent folder ID\n  email: string;     // Requester's email for permission check\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"directorycopydto",children:"DirectoryCopyDto"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"interface DirectoryCopyDto {\n  path: string;       // S3 path for the copied file\n  parentId?: string;  // Target parent folder ID\n  email: string;      // Requester's email for permission check\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"directorydetaildto",children:"DirectoryDetailDto"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"interface DirectoryDetailDto {\n  email: string; // Requester's email for permission check\n}\n"})}),"\n",(0,n.jsx)(r.h3,{id:"directoryupdatepermissiondto",children:"DirectoryUpdatePermissionDto"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"interface DirectoryUpdatePermissionDto {\n  email: string;     // Requester's email for permission check\n  attributes?: {\n    permission?: PermissionDto; // New permission settings\n    inheritance?: boolean;      // Whether to inherit parent permissions\n  };\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,n.jsx)(r.p,{children:"Example directory structure:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"/\n\u251c\u2500\u2500 documents/\n\u2502   \u251c\u2500\u2500 reports/\n\u2502   \u2502   \u251c\u2500\u2500 2024-Q1-report.pdf\n\u2502   \u2502   \u2514\u2500\u2500 2024-Q2-report.pdf\n\u2502   \u2514\u2500\u2500 contracts/\n\u2502       \u2514\u2500\u2500 contract-001.pdf\n\u251c\u2500\u2500 images/\n\u2502   \u251c\u2500\u2500 logo.png\n\u2502   \u2514\u2500\u2500 banner.jpg\n\u2514\u2500\u2500 templates/\n    \u2514\u2500\u2500 invoice-template.docx\n"})}),"\n",(0,n.jsx)(r.h2,{id:"multi-tenant-isolation",children:"Multi-tenant Isolation"}),"\n",(0,n.jsx)(r.p,{children:"Directories are automatically isolated by tenant through the invoke context:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"@Controller('api/directory')\nexport class DirectoryController {\n  constructor(private readonly directoryService: DirectoryService) {}\n\n  @Get(':id')\n  async findOne(\n    @INVOKE_CONTEXT() invokeContext: IInvoke,\n    @DetailKeys() detailDto: DetailDto,\n    @Query() queryDto: DirectoryDetailDto,\n  ): Promise<DirectoryDataEntity> {\n    // Tenant isolation is handled through the pk structure\n    return this.directoryService.findOne(detailDto, { invokeContext }, queryDto);\n  }\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"event-handling",children:"Event Handling"}),"\n",(0,n.jsx)(r.p,{children:"Handle directory data synchronization using data sync handlers:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"import { IDataSyncHandler, DataEntity } from '@mbc-cqrs-serverless/core';\n\nexport class DirectoryDataSyncHandler implements IDataSyncHandler {\n  async onCreated(data: DataEntity): Promise<void> {\n    console.log('Directory created:', data.name);\n    // Sync to RDS, notify users, update indexes, etc.\n  }\n\n  async onUpdated(data: DataEntity): Promise<void> {\n    console.log('Directory updated:', data.name);\n  }\n\n  async onDeleted(data: DataEntity): Promise<void> {\n    console.log('Directory deleted:', data.name);\n  }\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Use Folders for Organization"}),": Create a logical folder structure for easy navigation"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Set Permissions Early"}),": Configure permissions when creating directories"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Handle Large Files"}),": For large files, use presigned URLs for direct S3 upload"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Clean Up"}),": Implement retention policies for temporary files"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Audit Trail"}),": Use events to maintain an audit trail of all operations"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Use Soft Delete"}),": Prefer soft delete (remove) over permanent delete (removeFile) for data recovery"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>s,x:()=>d});var i=t(6540);const n={},o=i.createContext(n);function s(e){const r=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),i.createElement(o.Provider,{value:r},e.children)}}}]);