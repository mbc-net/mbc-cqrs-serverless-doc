"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[9941],{5039:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"database-selection-guide","title":"Database Selection Guide","description":"Learn how to choose between DynamoDB and RDS for different query scenarios in MBC CQRS Serverless.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/database-selection-guide.md","sourceDirName":".","slug":"/database-selection-guide","permalink":"/docs/database-selection-guide","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"description":"Learn how to choose between DynamoDB and RDS for different query scenarios in MBC CQRS Serverless."},"sidebar":"tutorialSidebar","previous":{"title":"DynamoDB","permalink":"/docs/dynamodb"},"next":{"title":"Prisma","permalink":"/docs/prisma"}}');var s=r(4848),i=r(8453);const a={description:"Learn how to choose between DynamoDB and RDS for different query scenarios in MBC CQRS Serverless."},d="Database Selection Guide",c={},o=[{value:"Overview of CQRS Data Flow",id:"overview-of-cqrs-data-flow",level:2},{value:"Data Flow Explanation",id:"data-flow-explanation",level:3},{value:"Database Characteristics",id:"database-characteristics",level:2},{value:"DynamoDB",id:"dynamodb",level:3},{value:"RDS (PostgreSQL/MySQL)",id:"rds-postgresqlmysql",level:3},{value:"Decision Matrix",id:"decision-matrix",level:2},{value:"Decision Flowchart",id:"decision-flowchart",level:2},{value:"Code Examples",id:"code-examples",level:2},{value:"Example 1: Single Item Lookup - Use DynamoDB",id:"example-1-single-item-lookup---use-dynamodb",level:3},{value:"Example 2: List by Partition Key - Use DynamoDB",id:"example-2-list-by-partition-key---use-dynamodb",level:3},{value:"Example 3: Complex Filtering - Use RDS",id:"example-3-complex-filtering---use-rds",level:3},{value:"Example 4: Full-Text Search - Use RDS",id:"example-4-full-text-search---use-rds",level:3},{value:"Example 5: JOIN Queries - Use RDS",id:"example-5-join-queries---use-rds",level:3},{value:"Example 6: Combining Both Databases",id:"example-6-combining-both-databases",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"DynamoDB Performance",id:"dynamodb-performance",level:3},{value:"RDS Performance",id:"rds-performance",level:3},{value:"Optimization Tips",id:"optimization-tips",level:3},{value:"Data Sync Handler Requirement",id:"data-sync-handler-requirement",level:2},{value:"Summary",id:"summary",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"database-selection-guide",children:"Database Selection Guide"})}),"\n",(0,s.jsx)(n.p,{children:"This guide helps you understand when to query DynamoDB directly versus RDS (via Prisma) in the MBC CQRS Serverless framework."}),"\n",(0,s.jsx)(n.h2,{id:"overview-of-cqrs-data-flow",children:"Overview of CQRS Data Flow"}),"\n",(0,s.jsx)(n.p,{children:"In the CQRS pattern, write operations (commands) and read operations (queries) are handled separately with different data stores optimized for each purpose."}),"\n",(0,s.jsx)(n.mermaid,{value:'flowchart TB\n    subgraph "Write Path (Commands)"\n        A["API Request"] --\x3e B["CommandService"]\n        B --\x3e C["DynamoDB Command Table"]\n        C --\x3e D["DynamoDB Streams"]\n        D --\x3e E["Data Sync Handler"]\n    end\n\n    subgraph "Read Path (Queries)"\n        E --\x3e F["DynamoDB Data Table"]\n        E --\x3e G["RDS (PostgreSQL/MySQL)"]\n        H["Query Request"] --\x3e I["DataService"]\n        H --\x3e J["PrismaService"]\n        I --\x3e F\n        J --\x3e G\n    end'}),"\n",(0,s.jsx)(n.h3,{id:"data-flow-explanation",children:"Data Flow Explanation"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Command Path"}),": Write operations go through ",(0,s.jsx)(n.code,{children:"CommandService"})," to DynamoDB Command Table"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Event Sync"}),": DynamoDB Streams trigger Data Sync Handlers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Dual Storage"}),": Data is synchronized to both DynamoDB Data Table and RDS"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Query Path"}),": Read operations choose between ",(0,s.jsx)(n.code,{children:"DataService"})," (DynamoDB) or ",(0,s.jsx)(n.code,{children:"PrismaService"})," (RDS)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"database-characteristics",children:"Database Characteristics"}),"\n",(0,s.jsx)(n.h3,{id:"dynamodb",children:"DynamoDB"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Characteristic"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Access Pattern"}),(0,s.jsx)(n.td,{children:"Key-based lookups (pk, sk)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Query Types"}),(0,s.jsx)(n.td,{children:"Get by key, Query by partition key with sort key conditions"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Strengths"}),(0,s.jsx)(n.td,{children:"Single-digit millisecond latency, automatic scaling, no connection management"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Limitations"}),(0,s.jsx)(n.td,{children:"No JOINs, limited filtering, no full-text search"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"rds-postgresqlmysql",children:"RDS (PostgreSQL/MySQL)"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Characteristic"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Access Pattern"}),(0,s.jsx)(n.td,{children:"SQL-based queries"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Query Types"}),(0,s.jsx)(n.td,{children:"Complex filters, JOINs, aggregations, full-text search"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Strengths"}),(0,s.jsx)(n.td,{children:"Flexible querying, relational integrity, powerful filtering"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Limitations"}),(0,s.jsx)(n.td,{children:"Connection management needed, requires Data Sync Handler setup"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"decision-matrix",children:"Decision Matrix"}),"\n",(0,s.jsx)(n.p,{children:"Use this matrix to quickly determine which database to query:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Query Scenario"}),(0,s.jsx)(n.th,{children:"Use DynamoDB"}),(0,s.jsx)(n.th,{children:"Use RDS"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Get single item by pk + sk"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Yes"})}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"List items by pk with sk prefix"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Yes"})}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Filter by multiple non-key attributes"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Yes"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Full-text search"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Yes"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"JOIN multiple entities"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Yes"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Aggregate (COUNT, SUM, AVG)"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Yes"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Sort by non-key attributes"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Yes"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pagination with total count"}),(0,s.jsx)(n.td,{children:"Limited"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Yes"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Complex WHERE conditions (OR, LIKE)"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Yes"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"decision-flowchart",children:"Decision Flowchart"}),"\n",(0,s.jsx)(n.mermaid,{value:'flowchart TD\n    A["Start: Need to query data"] --\x3e B{"Do you have pk and sk?"}\n    B --\x3e|"Yes"| C{"Single item lookup?"}\n    B --\x3e|"No"| G["Use RDS (Prisma)"]\n\n    C --\x3e|"Yes"| D["Use DataService.getItem()"]\n    C --\x3e|"No"| E{"Query by pk with sk condition only?"}\n\n    E --\x3e|"Yes"| F["Use DataService.listItemsByPk()"]\n    E --\x3e|"No"| G\n\n    G --\x3e H{"What query type?"}\n    H --\x3e|"Filter by attributes"| I["prisma.entity.findMany()"]\n    H --\x3e|"Full-text search"| I\n    H --\x3e|"JOIN tables"| I\n    H --\x3e|"Aggregation"| J["prisma.entity.count/aggregate()"]'}),"\n",(0,s.jsx)(n.h2,{id:"code-examples",children:"Code Examples"}),"\n",(0,s.jsx)(n.h3,{id:"example-1-single-item-lookup---use-dynamodb",children:"Example 1: Single Item Lookup - Use DynamoDB"}),"\n",(0,s.jsx)(n.p,{children:"When you have the exact pk and sk, use DataService for fast, direct access."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { DataService } from "@mbc-cqrs-serverless/core";\nimport { Injectable, NotFoundException } from "@nestjs/common";\n\n@Injectable()\nexport class ProductService {\n  constructor(private readonly dataService: DataService) {}\n\n  async findOne(pk: string, sk: string): Promise<ProductDataEntity> {\n    // Direct key lookup - DynamoDB is optimal\n    const item = await this.dataService.getItem({ pk, sk });\n\n    if (!item) {\n      throw new NotFoundException("Product not found");\n    }\n\n    return new ProductDataEntity(item);\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-2-list-by-partition-key---use-dynamodb",children:"Example 2: List by Partition Key - Use DynamoDB"}),"\n",(0,s.jsx)(n.p,{children:"When listing items that share the same pk with a sort key filter, use DataService."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { DataService, KEY_SEPARATOR } from "@mbc-cqrs-serverless/core";\nimport { Injectable } from "@nestjs/common";\n\n@Injectable()\nexport class OrderService {\n  constructor(private readonly dataService: DataService) {}\n\n  async listOrdersByTenant(tenantCode: string): Promise<OrderDataEntity[]> {\n    const pk = `ORDER${KEY_SEPARATOR}${tenantCode}`;\n\n    // List all orders for a tenant - efficient pk-based query\n    const result = await this.dataService.listItemsByPk(pk, {\n      sk: {\n        skExpression: "begins_with(sk, :prefix)",\n        skAttributeValues: {\n          ":prefix": "ORDER#",\n        },\n      },\n      limit: 100,\n    });\n\n    return result.items.map((item) => new OrderDataEntity(item));\n  }\n\n  async listOrderItemsForOrder(\n    tenantCode: string,\n    orderId: string,\n  ): Promise<OrderItemDataEntity[]> {\n    const pk = `ORDER${KEY_SEPARATOR}${tenantCode}`;\n\n    // List order items using sk prefix\n    const result = await this.dataService.listItemsByPk(pk, {\n      sk: {\n        skExpression: "begins_with(sk, :prefix)",\n        skAttributeValues: {\n          ":prefix": `ORDER_ITEM#${orderId}#`,\n        },\n      },\n    });\n\n    return result.items.map((item) => new OrderItemDataEntity(item));\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-3-complex-filtering---use-rds",children:"Example 3: Complex Filtering - Use RDS"}),"\n",(0,s.jsx)(n.p,{children:"When you need to filter by multiple attributes, use Prisma for SQL-powered queries."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { Injectable } from "@nestjs/common";\nimport { PrismaService } from "src/prisma";\n\n@Injectable()\nexport class ProductService {\n  constructor(private readonly prismaService: PrismaService) {}\n\n  async searchProducts(searchDto: {\n    tenantCode: string;\n    category?: string;\n    minPrice?: number;\n    maxPrice?: number;\n    inStock?: boolean;\n    page?: number;\n    limit?: number;\n  }): Promise<{ items: ProductDataEntity[]; total: number }> {\n    const page = searchDto.page ?? 1;\n    const limit = searchDto.limit ?? 20;\n    const skip = (page - 1) * limit;\n\n    // Build dynamic WHERE clause - RDS excels at this\n    const where: any = {\n      tenantCode: searchDto.tenantCode,\n      isDeleted: false,\n    };\n\n    if (searchDto.category) {\n      where.category = searchDto.category;\n    }\n\n    if (searchDto.minPrice !== undefined || searchDto.maxPrice !== undefined) {\n      where.price = {};\n      if (searchDto.minPrice !== undefined) {\n        where.price.gte = searchDto.minPrice;\n      }\n      if (searchDto.maxPrice !== undefined) {\n        where.price.lte = searchDto.maxPrice;\n      }\n    }\n\n    if (searchDto.inStock !== undefined) {\n      where.inStock = searchDto.inStock;\n    }\n\n    // Execute count and find in parallel\n    const [total, items] = await Promise.all([\n      this.prismaService.product.count({ where }),\n      this.prismaService.product.findMany({\n        where,\n        take: limit,\n        skip,\n        orderBy: { createdAt: "desc" },\n      }),\n    ]);\n\n    return {\n      total,\n      items: items.map((item) => new ProductDataEntity(item)),\n    };\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-4-full-text-search---use-rds",children:"Example 4: Full-Text Search - Use RDS"}),"\n",(0,s.jsx)(n.p,{children:"DynamoDB does not support full-text search. Use RDS for text search queries."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { Injectable } from "@nestjs/common";\nimport { PrismaService } from "src/prisma";\n\n@Injectable()\nexport class ProductService {\n  constructor(private readonly prismaService: PrismaService) {}\n\n  async searchByText(\n    tenantCode: string,\n    searchText: string,\n  ): Promise<ProductDataEntity[]> {\n    // Full-text search across multiple fields - only possible with RDS\n    const items = await this.prismaService.product.findMany({\n      where: {\n        tenantCode,\n        isDeleted: false,\n        OR: [\n          { name: { contains: searchText } },\n          { description: { contains: searchText } },\n          { code: { contains: searchText } },\n        ],\n      },\n      orderBy: { name: "asc" },\n    });\n\n    return items.map((item) => new ProductDataEntity(item));\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-5-join-queries---use-rds",children:"Example 5: JOIN Queries - Use RDS"}),"\n",(0,s.jsx)(n.p,{children:"When you need to combine data from multiple tables, use RDS with Prisma relations."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { Injectable } from "@nestjs/common";\nimport { PrismaService } from "src/prisma";\n\n@Injectable()\nexport class OrderService {\n  constructor(private readonly prismaService: PrismaService) {}\n\n  async getOrderWithItems(orderId: string): Promise<OrderWithItemsDto> {\n    // JOIN order with order items - requires RDS\n    const order = await this.prismaService.order.findUnique({\n      where: { id: orderId },\n      include: {\n        orderItems: {\n          include: {\n            product: true, // Also JOIN product details\n          },\n        },\n      },\n    });\n\n    return new OrderWithItemsDto(order);\n  }\n\n  async getOrderSummaryByCustomer(\n    tenantCode: string,\n    customerId: string,\n  ): Promise<CustomerOrderSummaryDto> {\n    // Aggregate with GROUP BY - only possible with RDS\n    const summary = await this.prismaService.order.groupBy({\n      by: ["status"],\n      where: {\n        tenantCode,\n        customerId,\n        isDeleted: false,\n      },\n      _count: { id: true },\n      _sum: { totalAmount: true },\n    });\n\n    return new CustomerOrderSummaryDto(summary);\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-6-combining-both-databases",children:"Example 6: Combining Both Databases"}),"\n",(0,s.jsx)(n.p,{children:"For optimal performance, use both databases based on the query type."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { DataService } from "@mbc-cqrs-serverless/core";\nimport { Injectable, NotFoundException } from "@nestjs/common";\nimport { PrismaService } from "src/prisma";\n\n@Injectable()\nexport class ProductService {\n  constructor(\n    private readonly dataService: DataService,\n    private readonly prismaService: PrismaService,\n  ) {}\n\n  // Use DynamoDB for single item by key\n  async findOne(pk: string, sk: string): Promise<ProductDataEntity> {\n    const item = await this.dataService.getItem({ pk, sk });\n    if (!item) {\n      throw new NotFoundException("Product not found");\n    }\n    return new ProductDataEntity(item);\n  }\n\n  // Use RDS for complex search\n  async search(searchDto: SearchProductDto): Promise<ProductListEntity> {\n    const [total, items] = await Promise.all([\n      this.prismaService.product.count({\n        where: this.buildWhereClause(searchDto),\n      }),\n      this.prismaService.product.findMany({\n        where: this.buildWhereClause(searchDto),\n        take: searchDto.limit ?? 20,\n        skip: ((searchDto.page ?? 1) - 1) * (searchDto.limit ?? 20),\n        orderBy: { [searchDto.sortBy ?? "createdAt"]: searchDto.sortOrder ?? "desc" },\n      }),\n    ]);\n\n    return new ProductListEntity({ total, items });\n  }\n\n  private buildWhereClause(searchDto: SearchProductDto): any {\n    const where: any = {\n      tenantCode: searchDto.tenantCode,\n      isDeleted: false,\n    };\n\n    if (searchDto.category) where.category = searchDto.category;\n    if (searchDto.search) {\n      where.OR = [\n        { name: { contains: searchDto.search } },\n        { description: { contains: searchDto.search } },\n      ];\n    }\n\n    return where;\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"dynamodb-performance",children:"DynamoDB Performance"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Scenario"}),(0,s.jsx)(n.th,{children:"Performance"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"GetItem by pk+sk"}),(0,s.jsx)(n.td,{children:"< 10ms"}),(0,s.jsx)(n.td,{children:"Optimal use case"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Query by pk"}),(0,s.jsx)(n.td,{children:"< 50ms"}),(0,s.jsx)(n.td,{children:"Efficient for bounded result sets"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Scan (avoid)"}),(0,s.jsx)(n.td,{children:"100ms - seconds"}),(0,s.jsx)(n.td,{children:"Avoid in production"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"rds-performance",children:"RDS Performance"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Scenario"}),(0,s.jsx)(n.th,{children:"Performance"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Indexed query"}),(0,s.jsx)(n.td,{children:"10-50ms"}),(0,s.jsx)(n.td,{children:"Ensure proper indexes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Full-text search"}),(0,s.jsx)(n.td,{children:"50-200ms"}),(0,s.jsx)(n.td,{children:"Consider search indexes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Complex JOIN"}),(0,s.jsx)(n.td,{children:"50-500ms"}),(0,s.jsx)(n.td,{children:"Depends on data volume"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Aggregation"}),(0,s.jsx)(n.td,{children:"100ms-1s"}),(0,s.jsx)(n.td,{children:"Consider caching for frequent queries"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Index RDS columns"}),": Add indexes on frequently queried columns"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prisma",children:'model Product {\n  id         String @id\n  tenantCode String @map("tenant_code")\n  category   String\n  name       String\n  price      Decimal\n\n  @@index([tenantCode, category])  // Index for filtering by category\n  @@index([tenantCode, name])      // Index for name search\n}\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use DynamoDB for hot paths"}),": Single-item lookups in user-facing APIs"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cache frequent RDS queries"}),": Consider caching aggregation results"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parallel queries"}),": Run independent queries in parallel"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const [total, items] = await Promise.all([\n  this.prismaService.product.count({ where }),\n  this.prismaService.product.findMany({ where, take, skip }),\n]);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"data-sync-handler-requirement",children:"Data Sync Handler Requirement"}),"\n",(0,s.jsx)(n.p,{children:"To query data from RDS, you must implement a Data Sync Handler that synchronizes data from DynamoDB to RDS."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import {\n  CommandModel,\n  IDataSyncHandler,\n  removeSortKeyVersion,\n} from "@mbc-cqrs-serverless/core";\nimport { Injectable } from "@nestjs/common";\nimport { PrismaService } from "src/prisma";\n\n@Injectable()\nexport class ProductDataSyncRdsHandler implements IDataSyncHandler {\n  constructor(private readonly prismaService: PrismaService) {}\n\n  async up(cmd: CommandModel): Promise<any> {\n    const sk = removeSortKeyVersion(cmd.sk);\n\n    await this.prismaService.product.upsert({\n      where: { id: cmd.id },\n      update: {\n        pk: cmd.pk,\n        sk: sk,\n        name: cmd.name,\n        // Map attributes to RDS columns\n        category: cmd.attributes?.category,\n        price: cmd.attributes?.price,\n        isDeleted: cmd.isDeleted ?? false,\n        updatedAt: cmd.updatedAt,\n      },\n      create: {\n        id: cmd.id,\n        pk: cmd.pk,\n        sk: sk,\n        cpk: cmd.pk,\n        csk: cmd.sk,\n        tenantCode: cmd.tenantCode,\n        code: cmd.code,\n        name: cmd.name,\n        category: cmd.attributes?.category,\n        price: cmd.attributes?.price,\n        isDeleted: cmd.isDeleted ?? false,\n        createdAt: cmd.createdAt,\n        updatedAt: cmd.updatedAt,\n      },\n    });\n  }\n\n  async down(cmd: CommandModel): Promise<any> {\n    // Handle rollback if needed\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"/docs/data-sync-handler-examples",children:"Data Sync Handler Examples"})," for more detailed examples."]}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Use Case"}),(0,s.jsx)(n.th,{children:"Database"}),(0,s.jsx)(n.th,{children:"Service"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Get item by pk + sk"}),(0,s.jsx)(n.td,{children:"DynamoDB"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DataService.getItem()"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"List by pk with sk filter"}),(0,s.jsx)(n.td,{children:"DynamoDB"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DataService.listItemsByPk()"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Multi-attribute filter"}),(0,s.jsx)(n.td,{children:"RDS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PrismaService.findMany()"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Full-text search"}),(0,s.jsx)(n.td,{children:"RDS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PrismaService.findMany()"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"JOIN queries"}),(0,s.jsx)(n.td,{children:"RDS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PrismaService.findMany({ include })"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Aggregations"}),(0,s.jsx)(n.td,{children:"RDS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PrismaService.count/groupBy()"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pagination with count"}),(0,s.jsx)(n.td,{children:"RDS"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PrismaService.count() + findMany()"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/dynamodb",children:"DynamoDB"}),": DynamoDB table design and management"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/prisma",children:"Prisma"}),": Prisma ORM setup and conventions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/data-service",children:"DataService"}),": DynamoDB query methods"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/data-sync-handler-examples",children:"Data Sync Handler Examples"}),": RDS synchronization patterns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/service-patterns",children:"Service Implementation Patterns"}),": Complete service layer examples"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>d});var t=r(6540);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);