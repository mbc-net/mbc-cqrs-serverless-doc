"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[9646],{4835:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"saas-example","title":"SaaS\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f8b","description":"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u7ba1\u7406\u3001\u4f7f\u7528\u91cf\u8ffd\u8de1\u3001\u8ab2\u91d1\u9023\u643a\u3092\u5099\u3048\u305f\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8SaaS\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f8b\u3002","source":"@site/i18n/ja/docusaurus-plugin-content-docs/current/saas-example.md","sourceDirName":".","slug":"/saas-example","permalink":"/ja/docs/saas-example","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"description":"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u7ba1\u7406\u3001\u4f7f\u7528\u91cf\u8ffd\u8de1\u3001\u8ab2\u91d1\u9023\u643a\u3092\u5099\u3048\u305f\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8SaaS\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f8b\u3002"},"sidebar":"tutorialSidebar","previous":{"title":"E\u30b3\u30de\u30fc\u30b9\u4f8b","permalink":"/ja/docs/ecommerce-example"},"next":{"title":"\u30a2\u30f3\u30b1\u30fc\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8","permalink":"/ja/docs/survey-template"}}');var a=t(4848),i=t(8453);const s={description:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u7ba1\u7406\u3001\u4f7f\u7528\u91cf\u8ffd\u8de1\u3001\u8ab2\u91d1\u9023\u643a\u3092\u5099\u3048\u305f\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8SaaS\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f8b\u3002"},c="SaaS\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f8b",o={},l=[{value:"\u6982\u8981",id:"\u6982\u8981",level:2},{value:"\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb",id:"\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb",level:2},{value:"\u30ad\u30fc\u69cb\u9020",id:"\u30ad\u30fc\u69cb\u9020",level:3},{value:"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u5b9a\u7fa9",id:"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u5b9a\u7fa9",level:3},{value:"\u30c6\u30ca\u30f3\u30c8\u7ba1\u7406",id:"\u30c6\u30ca\u30f3\u30c8\u7ba1\u7406",level:2},{value:"\u30c6\u30ca\u30f3\u30c8\u30b5\u30fc\u30d3\u30b9\u62e1\u5f35",id:"\u30c6\u30ca\u30f3\u30c8\u30b5\u30fc\u30d3\u30b9\u62e1\u5f35",level:3},{value:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u7ba1\u7406",id:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u7ba1\u7406",level:2},{value:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u30b5\u30fc\u30d3\u30b9",id:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u30b5\u30fc\u30d3\u30b9",level:3},{value:"\u4f7f\u7528\u91cf\u8a08\u6e2c",id:"\u4f7f\u7528\u91cf\u8a08\u6e2c",level:2},{value:"\u4f7f\u7528\u91cf\u30b5\u30fc\u30d3\u30b9",id:"\u4f7f\u7528\u91cf\u30b5\u30fc\u30d3\u30b9",level:3},{value:"\u30af\u30a9\u30fc\u30bf\u30ac\u30fc\u30c9",id:"\u30af\u30a9\u30fc\u30bf\u30ac\u30fc\u30c9",level:3},{value:"\u8ab2\u91d1\u9023\u643a",id:"\u8ab2\u91d1\u9023\u643a",level:2},{value:"\u8ab2\u91d1\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc",id:"\u8ab2\u91d1\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc",level:3},{value:"API\u30ad\u30fc\u7ba1\u7406",id:"api\u30ad\u30fc\u7ba1\u7406",level:2},{value:"API\u30ad\u30fc\u30b5\u30fc\u30d3\u30b9",id:"api\u30ad\u30fc\u30b5\u30fc\u30d3\u30b9",level:3},{value:"API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8",id:"api\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8",level:2},{value:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:2},{value:"1. \u30c6\u30ca\u30f3\u30c8\u5206\u96e2",id:"1-\u30c6\u30ca\u30f3\u30c8\u5206\u96e2",level:3},{value:"2. \u4f7f\u7528\u91cf\u8ffd\u8de1",id:"2-\u4f7f\u7528\u91cf\u8ffd\u8de1",level:3},{value:"3. \u8ab2\u91d1\u30a4\u30d9\u30f3\u30c8",id:"3-\u8ab2\u91d1\u30a4\u30d9\u30f3\u30c8",level:3},{value:"\u95a2\u9023\u9805\u76ee",id:"\u95a2\u9023\u9805\u76ee",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"saas\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f8b",children:"SaaS\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f8b"})}),"\n",(0,a.jsx)(e.p,{children:"\u3053\u306e\u4f8b\u3067\u306f\u3001MBC CQRS Serverless\u3092\u4f7f\u7528\u3057\u305f\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u7ba1\u7406\u3001\u4f7f\u7528\u91cf\u8ffd\u8de1\u3001\u8ab2\u91d1\u9023\u643a\u3092\u5099\u3048\u305f\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8SaaS\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u793a\u3057\u307e\u3059\u3002"}),"\n",(0,a.jsx)(e.h2,{id:"\u6982\u8981",children:"\u6982\u8981"}),"\n",(0,a.jsx)(e.p,{children:"SaaS\u306e\u4f8b\u3067\u306f\u4ee5\u4e0b\u3092\u30ab\u30d0\u30fc\u3057\u307e\u3059\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u30c6\u30ca\u30f3\u30c8\u968e\u5c64\u306b\u3088\u308b\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u5206\u96e2"}),"\n",(0,a.jsx)(e.li,{children:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3068\u30d7\u30e9\u30f3\u7ba1\u7406"}),"\n",(0,a.jsx)(e.li,{children:"\u4f7f\u7528\u91cf\u8a08\u6e2c\u3068\u30af\u30a9\u30fc\u30bf\u5f37\u5236"}),"\n",(0,a.jsx)(e.li,{children:"\u8ab2\u91d1\u30a4\u30d9\u30f3\u30c8\u751f\u6210"}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb",children:"\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb"}),"\n",(0,a.jsx)(e.h3,{id:"\u30ad\u30fc\u69cb\u9020",children:"\u30ad\u30fc\u69cb\u9020"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30ad\u30fc (pk)           \u30bd\u30fc\u30c8\u30ad\u30fc (sk)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTENANT#acme-corp                 SUBSCRIPTION#SUB-001\nTENANT#acme-corp                 USAGE#2024-01\nTENANT#acme-corp                 USER#usr-001\nTENANT#acme-corp                 APIKEY#key-001\nMASTER#COMMON                    PLAN#starter\nMASTER#COMMON                    PLAN#professional\nMASTER#COMMON                    PLAN#enterprise\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u5b9a\u7fa9",children:"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u5b9a\u7fa9"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"// Plan Entity (Master Data) (\u30d7\u30e9\u30f3\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\uff08\u30de\u30b9\u30bf\u30fc\u30c7\u30fc\u30bf\uff09)\nexport interface PlanAttributes {\n  displayName: string;\n  monthlyPrice: number;\n  yearlyPrice: number;\n  currency: string;\n  features: PlanFeature[];\n  limits: PlanLimits;\n  isActive: boolean;\n}\n\nexport interface PlanLimits {\n  maxUsers: number;\n  maxApiCalls: number;\n  maxStorageGb: number;\n  maxProjects: number;\n}\n\n// Subscription Entity (\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3)\nexport interface SubscriptionAttributes {\n  planCode: string;\n  billingCycle: 'monthly' | 'yearly';\n  status: SubscriptionStatus;\n  startDate: string;\n  endDate: string;\n  autoRenew: boolean;\n  paymentMethodId?: string;\n}\n\nexport type SubscriptionStatus =\n  | 'active'\n  | 'trial'\n  | 'past_due'\n  | 'cancelled'\n  | 'expired';\n\n// Usage Entity (\u4f7f\u7528\u91cf\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3)\nexport interface UsageAttributes {\n  period: string; // YYYY-MM\n  apiCalls: number;\n  storageUsedGb: number;\n  activeUsers: number;\n  projectCount: number;\n  lastUpdatedAt: string;\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u30c6\u30ca\u30f3\u30c8\u7ba1\u7406",children:"\u30c6\u30ca\u30f3\u30c8\u7ba1\u7406"}),"\n",(0,a.jsx)(e.h3,{id:"\u30c6\u30ca\u30f3\u30c8\u30b5\u30fc\u30d3\u30b9\u62e1\u5f35",children:"\u30c6\u30ca\u30f3\u30c8\u30b5\u30fc\u30d3\u30b9\u62e1\u5f35"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"// tenant-setup.service.ts\nimport { Injectable } from '@nestjs/common';\nimport { TenantService, IInvoke } from '@mbc-cqrs-serverless/core';\nimport { SubscriptionService } from './subscription.service';\n\n@Injectable()\nexport class TenantSetupService {\n  constructor(\n    private readonly tenantService: TenantService,\n    private readonly subscriptionService: SubscriptionService,\n  ) {}\n\n  // Create tenant with initial subscription (\u521d\u671f\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u4ed8\u304d\u3067\u30c6\u30ca\u30f3\u30c8\u3092\u4f5c\u6210)\n  async provisionTenant(dto: ProvisionTenantDto, context: IInvoke) {\n    // Step 1: Create tenant (\u30b9\u30c6\u30c3\u30d71: \u30c6\u30ca\u30f3\u30c8\u3092\u4f5c\u6210)\n    const tenant = await this.tenantService.createTenant(\n      {\n        code: dto.companySlug,\n        name: dto.companyName,\n        attributes: {\n          industry: dto.industry,\n          country: dto.country,\n          timezone: dto.timezone,\n        },\n      },\n      context,\n    );\n\n    // Step 2: Create trial subscription (\u30b9\u30c6\u30c3\u30d72: \u30c8\u30e9\u30a4\u30a2\u30eb\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u4f5c\u6210)\n    await this.subscriptionService.createTrialSubscription(\n      dto.companySlug,\n      dto.planCode,\n      context,\n    );\n\n    // Step 3: Initialize usage tracking (\u30b9\u30c6\u30c3\u30d73: \u4f7f\u7528\u91cf\u8ffd\u8de1\u3092\u521d\u671f\u5316)\n    await this.initializeUsageTracking(dto.companySlug, context);\n\n    return tenant;\n  }\n\n  private async initializeUsageTracking(\n    tenantCode: string,\n    context: IInvoke,\n  ) {\n    const currentPeriod = this.getCurrentPeriod();\n\n    await this.commandService.publishAsync(\n      {\n        pk: generatePk(tenantCode),\n        sk: `USAGE#${currentPeriod}`,\n        code: currentPeriod,\n        name: `Usage for ${currentPeriod}`,\n        tenantCode,\n        attributes: {\n          period: currentPeriod,\n          apiCalls: 0,\n          storageUsedGb: 0,\n          activeUsers: 0,\n          projectCount: 0,\n          lastUpdatedAt: new Date().toISOString(),\n        },\n      },\n      { invokeContext: context },\n    );\n  }\n\n  private getCurrentPeriod(): string {\n    const now = new Date();\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\n  }\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u7ba1\u7406",children:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u7ba1\u7406"}),"\n",(0,a.jsx)(e.h3,{id:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u30b5\u30fc\u30d3\u30b9",children:"\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u30b5\u30fc\u30d3\u30b9"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"// subscription.service.ts\nimport { Injectable, BadRequestException } from '@nestjs/common';\nimport {\n  CommandService,\n  DataService,\n  MasterService,\n  IInvoke,\n  getUserContext,\n  generatePk,\n} from '@mbc-cqrs-serverless/core';\n\n@Injectable()\nexport class SubscriptionService {\n  constructor(\n    private readonly commandService: CommandService,\n    private readonly dataService: DataService,\n    private readonly masterService: MasterService,\n  ) {}\n\n  // Create trial subscription (\u30c8\u30e9\u30a4\u30a2\u30eb\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u4f5c\u6210)\n  async createTrialSubscription(\n    tenantCode: string,\n    planCode: string,\n    context: IInvoke,\n  ) {\n    const plan = await this.masterService.getByCode('PLAN', planCode);\n    if (!plan) {\n      throw new BadRequestException(`Plan ${planCode} not found`);\n    }\n\n    const trialDays = 14;\n    const startDate = new Date();\n    const endDate = new Date(startDate);\n    endDate.setDate(endDate.getDate() + trialDays);\n\n    const command = {\n      pk: generatePk(tenantCode),\n      sk: `SUBSCRIPTION#SUB-${Date.now()}`,\n      code: `SUB-${Date.now()}`,\n      name: `${plan.name} Subscription`,\n      tenantCode,\n      attributes: {\n        planCode,\n        billingCycle: 'monthly',\n        status: 'trial' as SubscriptionStatus,\n        startDate: startDate.toISOString(),\n        endDate: endDate.toISOString(),\n        autoRenew: true,\n      },\n    };\n\n    return this.commandService.publishAsync(command, { invokeContext: context });\n  }\n\n  // Upgrade/Downgrade subscription (\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306e\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9/\u30c0\u30a6\u30f3\u30b0\u30ec\u30fc\u30c9)\n  async changePlan(\n    subscriptionCode: string,\n    newPlanCode: string,\n    context: IInvoke,\n  ) {\n    const { tenantCode } = getUserContext(context);\n    const pk = generatePk(tenantCode);\n    const sk = `SUBSCRIPTION#${subscriptionCode}`;\n\n    const current = await this.dataService.getItem({ pk, sk });\n    if (!current) {\n      throw new NotFoundException(`Subscription ${subscriptionCode} not found`);\n    }\n\n    // Validate plan exists (\u30d7\u30e9\u30f3\u306e\u5b58\u5728\u3092\u691c\u8a3c)\n    const newPlan = await this.masterService.getByCode('PLAN', newPlanCode);\n    if (!newPlan) {\n      throw new BadRequestException(`Plan ${newPlanCode} not found`);\n    }\n\n    // Validate upgrade/downgrade is allowed (\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9/\u30c0\u30a6\u30f3\u30b0\u30ec\u30fc\u30c9\u304c\u8a31\u53ef\u3055\u308c\u3066\u3044\u308b\u304b\u691c\u8a3c)\n    await this.validatePlanChange(tenantCode, current.attributes, newPlan);\n\n    const command = {\n      ...current,\n      version: current.version,\n      attributes: {\n        ...current.attributes,\n        planCode: newPlanCode,\n        planChangedAt: new Date().toISOString(),\n      },\n    };\n\n    return this.commandService.publishAsync(command, { invokeContext: context });\n  }\n\n  // Cancel subscription (\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u30ad\u30e3\u30f3\u30bb\u30eb)\n  async cancelSubscription(\n    subscriptionCode: string,\n    reason: string,\n    context: IInvoke,\n  ) {\n    const { tenantCode } = getUserContext(context);\n    const pk = generatePk(tenantCode);\n    const sk = `SUBSCRIPTION#${subscriptionCode}`;\n\n    const current = await this.dataService.getItem({ pk, sk });\n    if (!current) {\n      throw new NotFoundException(`Subscription ${subscriptionCode} not found`);\n    }\n\n    const command = {\n      ...current,\n      version: current.version,\n      attributes: {\n        ...current.attributes,\n        status: 'cancelled' as SubscriptionStatus,\n        autoRenew: false,\n        cancellationReason: reason,\n        cancelledAt: new Date().toISOString(),\n      },\n    };\n\n    return this.commandService.publishAsync(command, { invokeContext: context });\n  }\n\n  private async validatePlanChange(\n    tenantCode: string,\n    currentSub: SubscriptionAttributes,\n    newPlan: any,\n  ) {\n    // Check current usage against new plan limits (\u65b0\u30d7\u30e9\u30f3\u306e\u5236\u9650\u306b\u5bfe\u3057\u3066\u73fe\u5728\u306e\u4f7f\u7528\u91cf\u3092\u78ba\u8a8d)\n    const usage = await this.getCurrentUsage(tenantCode);\n\n    if (usage.activeUsers > newPlan.attributes.limits.maxUsers) {\n      throw new BadRequestException(\n        `Cannot downgrade: current users (${usage.activeUsers}) ` +\n        `exceeds new plan limit (${newPlan.attributes.limits.maxUsers})`\n      );\n    }\n\n    if (usage.storageUsedGb > newPlan.attributes.limits.maxStorageGb) {\n      throw new BadRequestException(\n        `Cannot downgrade: current storage (${usage.storageUsedGb}GB) ` +\n        `exceeds new plan limit (${newPlan.attributes.limits.maxStorageGb}GB)`\n      );\n    }\n  }\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u4f7f\u7528\u91cf\u8a08\u6e2c",children:"\u4f7f\u7528\u91cf\u8a08\u6e2c"}),"\n",(0,a.jsx)(e.h3,{id:"\u4f7f\u7528\u91cf\u30b5\u30fc\u30d3\u30b9",children:"\u4f7f\u7528\u91cf\u30b5\u30fc\u30d3\u30b9"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"// usage.service.ts\nimport { Injectable, Logger } from '@nestjs/common';\nimport {\n  CommandService,\n  DataService,\n  MasterService,\n  IInvoke,\n  getUserContext,\n  generatePk,\n} from '@mbc-cqrs-serverless/core';\n\n@Injectable()\nexport class UsageService {\n  private readonly logger = new Logger(UsageService.name);\n\n  constructor(\n    private readonly commandService: CommandService,\n    private readonly dataService: DataService,\n    private readonly masterService: MasterService,\n  ) {}\n\n  // Track API call (API\u30b3\u30fc\u30eb\u3092\u8ffd\u8de1)\n  async trackApiCall(context: IInvoke): Promise<void> {\n    await this.incrementUsage(context, 'apiCalls', 1);\n  }\n\n  // Track storage usage (\u30b9\u30c8\u30ec\u30fc\u30b8\u4f7f\u7528\u91cf\u3092\u8ffd\u8de1)\n  async trackStorageChange(\n    deltaGb: number,\n    context: IInvoke,\n  ): Promise<void> {\n    await this.incrementUsage(context, 'storageUsedGb', deltaGb);\n  }\n\n  // Check if quota is exceeded (\u30af\u30a9\u30fc\u30bf\u8d85\u904e\u3092\u78ba\u8a8d)\n  async checkQuota(\n    metric: keyof UsageAttributes,\n    context: IInvoke,\n  ): Promise<QuotaCheckResult> {\n    const { tenantCode } = getUserContext(context);\n\n    const [usage, subscription] = await Promise.all([\n      this.getCurrentUsage(tenantCode),\n      this.getActiveSubscription(tenantCode),\n    ]);\n\n    const plan = await this.masterService.getByCode(\n      'PLAN',\n      subscription.attributes.planCode\n    );\n\n    const limit = this.getLimit(plan, metric);\n    const current = usage.attributes[metric] as number;\n    const percentage = (current / limit) * 100;\n\n    return {\n      metric,\n      current,\n      limit,\n      percentage,\n      isExceeded: current >= limit,\n      isNearLimit: percentage >= 80,\n    };\n  }\n\n  // Get usage summary for billing (\u8ab2\u91d1\u7528\u306e\u4f7f\u7528\u91cf\u30b5\u30de\u30ea\u30fc\u3092\u53d6\u5f97)\n  async getUsageSummary(\n    tenantCode: string,\n    period: string,\n  ): Promise<UsageSummary> {\n    const pk = generatePk(tenantCode);\n    const sk = `USAGE#${period}`;\n\n    const usage = await this.dataService.getItem({ pk, sk });\n    if (!usage) {\n      return {\n        period,\n        apiCalls: 0,\n        storageUsedGb: 0,\n        activeUsers: 0,\n        projectCount: 0,\n      };\n    }\n\n    return usage.attributes;\n  }\n\n  private async incrementUsage(\n    context: IInvoke,\n    metric: string,\n    delta: number,\n  ): Promise<void> {\n    const { tenantCode } = getUserContext(context);\n    const period = this.getCurrentPeriod();\n    const pk = generatePk(tenantCode);\n    const sk = `USAGE#${period}`;\n\n    const current = await this.dataService.getItem({ pk, sk });\n\n    if (!current) {\n      // Create new usage record (\u65b0\u3057\u3044\u4f7f\u7528\u91cf\u30ec\u30b3\u30fc\u30c9\u3092\u4f5c\u6210)\n      const command = {\n        pk,\n        sk,\n        code: period,\n        name: `Usage for ${period}`,\n        tenantCode,\n        attributes: {\n          period,\n          apiCalls: 0,\n          storageUsedGb: 0,\n          activeUsers: 0,\n          projectCount: 0,\n          [metric]: delta,\n          lastUpdatedAt: new Date().toISOString(),\n        },\n      };\n      await this.commandService.publishAsync(command, { invokeContext: context });\n      return;\n    }\n\n    // Update existing record (\u65e2\u5b58\u30ec\u30b3\u30fc\u30c9\u3092\u66f4\u65b0)\n    const command = {\n      ...current,\n      version: current.version,\n      attributes: {\n        ...current.attributes,\n        [metric]: (current.attributes[metric] || 0) + delta,\n        lastUpdatedAt: new Date().toISOString(),\n      },\n    };\n\n    await this.commandService.publishAsync(command, { invokeContext: context });\n  }\n\n  private getLimit(plan: any, metric: string): number {\n    const limitMapping: Record<string, string> = {\n      apiCalls: 'maxApiCalls',\n      storageUsedGb: 'maxStorageGb',\n      activeUsers: 'maxUsers',\n      projectCount: 'maxProjects',\n    };\n\n    return plan.attributes.limits[limitMapping[metric]] || Infinity;\n  }\n\n  private getCurrentPeriod(): string {\n    const now = new Date();\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\n  }\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u30af\u30a9\u30fc\u30bf\u30ac\u30fc\u30c9",children:"\u30af\u30a9\u30fc\u30bf\u30ac\u30fc\u30c9"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"// quota.guard.ts\nimport { Injectable, CanActivate, ExecutionContext, ForbiddenException } from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\nimport { UsageService } from './usage.service';\nimport { getInvokeContext } from '@mbc-cqrs-serverless/core';\n\n@Injectable()\nexport class QuotaGuard implements CanActivate {\n  constructor(\n    private readonly reflector: Reflector,\n    private readonly usageService: UsageService,\n  ) {}\n\n  async canActivate(context: ExecutionContext): Promise<boolean> {\n    const metric = this.reflector.get<string>('quota_metric', context.getHandler());\n    if (!metric) {\n      return true;\n    }\n\n    const ctx = getInvokeContext(context);\n    const quota = await this.usageService.checkQuota(metric, ctx);\n\n    if (quota.isExceeded) {\n      throw new ForbiddenException(\n        `Quota exceeded for ${metric}: ${quota.current}/${quota.limit}. ` +\n        'Please upgrade your plan.'\n      );\n    }\n\n    return true;\n  }\n}\n\n// Usage in controller (\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3067\u306e\u4f7f\u7528)\n@Controller('projects')\nexport class ProjectController {\n  @Post()\n  @UseGuards(QuotaGuard)\n  @SetMetadata('quota_metric', 'projectCount')\n  async create(@Body() dto: CreateProjectDto, @Req() req: IInvoke) {\n    // ...\n  }\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u8ab2\u91d1\u9023\u643a",children:"\u8ab2\u91d1\u9023\u643a"}),"\n",(0,a.jsx)(e.h3,{id:"\u8ab2\u91d1\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc",children:"\u8ab2\u91d1\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"// billing-event.handler.ts\nimport { Injectable, Logger } from '@nestjs/common';\nimport { DataSyncHandler, IDataSyncHandler } from '@mbc-cqrs-serverless/core';\n\n@DataSyncHandler({ tableName: 'data-table' })\n@Injectable()\nexport class BillingEventHandler implements IDataSyncHandler {\n  private readonly logger = new Logger(BillingEventHandler.name);\n\n  constructor(private readonly billingService: BillingService) {}\n\n  async handleSync(event: DataSyncEvent): Promise<void> {\n    // Handle subscription changes (\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u5909\u66f4\u3092\u51e6\u7406)\n    if (event.sk.startsWith('SUBSCRIPTION#')) {\n      await this.handleSubscriptionChange(event);\n      return;\n    }\n\n    // Handle usage updates (\u4f7f\u7528\u91cf\u66f4\u65b0\u3092\u51e6\u7406)\n    if (event.sk.startsWith('USAGE#')) {\n      await this.handleUsageChange(event);\n      return;\n    }\n  }\n\n  private async handleSubscriptionChange(event: DataSyncEvent) {\n    const { old: prev, new: current } = event;\n\n    // New subscription (\u65b0\u898f\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3)\n    if (!prev && current) {\n      this.logger.log(`New subscription: ${current.code}`);\n\n      if (current.attributes.status === 'active') {\n        await this.billingService.createBillingCycle({\n          tenantCode: current.tenantCode,\n          subscriptionCode: current.code,\n          planCode: current.attributes.planCode,\n          billingCycle: current.attributes.billingCycle,\n          startDate: current.attributes.startDate,\n        });\n      }\n      return;\n    }\n\n    // Subscription cancelled (\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u30ad\u30e3\u30f3\u30bb\u30eb)\n    if (\n      prev?.attributes.status !== 'cancelled' &&\n      current?.attributes.status === 'cancelled'\n    ) {\n      this.logger.log(`Subscription cancelled: ${current.code}`);\n      await this.billingService.cancelBillingCycle(current.code);\n      return;\n    }\n\n    // Plan changed (\u30d7\u30e9\u30f3\u5909\u66f4)\n    if (prev?.attributes.planCode !== current?.attributes.planCode) {\n      this.logger.log(\n        `Plan changed: ${prev.attributes.planCode} -> ${current.attributes.planCode}`\n      );\n      await this.billingService.prorate({\n        subscriptionCode: current.code,\n        oldPlanCode: prev.attributes.planCode,\n        newPlanCode: current.attributes.planCode,\n        changeDate: current.attributes.planChangedAt,\n      });\n    }\n  }\n\n  private async handleUsageChange(event: DataSyncEvent) {\n    const usage = event.new;\n    if (!usage) return;\n\n    // Check for overage (\u8d85\u904e\u3092\u78ba\u8a8d)\n    const subscription = await this.getActiveSubscription(usage.tenantCode);\n    const plan = await this.masterService.getByCode(\n      'PLAN',\n      subscription.attributes.planCode\n    );\n\n    const overages = this.calculateOverages(usage.attributes, plan.attributes.limits);\n\n    if (overages.length > 0) {\n      this.logger.log(`Overage detected for ${usage.tenantCode}`, overages);\n      await this.billingService.recordOverage({\n        tenantCode: usage.tenantCode,\n        period: usage.attributes.period,\n        overages,\n      });\n    }\n  }\n\n  private calculateOverages(\n    usage: UsageAttributes,\n    limits: PlanLimits,\n  ): Overage[] {\n    const overages: Overage[] = [];\n\n    if (usage.apiCalls > limits.maxApiCalls) {\n      overages.push({\n        metric: 'apiCalls',\n        limit: limits.maxApiCalls,\n        actual: usage.apiCalls,\n        overage: usage.apiCalls - limits.maxApiCalls,\n      });\n    }\n\n    if (usage.storageUsedGb > limits.maxStorageGb) {\n      overages.push({\n        metric: 'storageUsedGb',\n        limit: limits.maxStorageGb,\n        actual: usage.storageUsedGb,\n        overage: usage.storageUsedGb - limits.maxStorageGb,\n      });\n    }\n\n    return overages;\n  }\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"api\u30ad\u30fc\u7ba1\u7406",children:"API\u30ad\u30fc\u7ba1\u7406"}),"\n",(0,a.jsx)(e.h3,{id:"api\u30ad\u30fc\u30b5\u30fc\u30d3\u30b9",children:"API\u30ad\u30fc\u30b5\u30fc\u30d3\u30b9"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"// api-key.service.ts\nimport { Injectable } from '@nestjs/common';\nimport { randomBytes, createHash } from 'crypto';\nimport {\n  CommandService,\n  DataService,\n  IInvoke,\n  getUserContext,\n  generatePk,\n} from '@mbc-cqrs-serverless/core';\n\n@Injectable()\nexport class ApiKeyService {\n  constructor(\n    private readonly commandService: CommandService,\n    private readonly dataService: DataService,\n  ) {}\n\n  // Generate new API key (\u65b0\u3057\u3044API\u30ad\u30fc\u3092\u751f\u6210)\n  async createApiKey(dto: CreateApiKeyDto, context: IInvoke) {\n    const { tenantCode, userId } = getUserContext(context);\n\n    // Generate secure API key (\u5b89\u5168\u306aAPI\u30ad\u30fc\u3092\u751f\u6210)\n    const rawKey = `mbc_${randomBytes(32).toString('hex')}`;\n    const keyHash = this.hashKey(rawKey);\n    const keyPrefix = rawKey.substring(0, 11); // Show first 11 chars (\u6700\u521d\u306e11\u6587\u5b57\u3092\u8868\u793a)\n\n    const command = {\n      pk: generatePk(tenantCode),\n      sk: `APIKEY#${keyHash}`,\n      code: keyHash,\n      name: dto.name,\n      tenantCode,\n      attributes: {\n        keyPrefix,\n        keyHash,\n        createdBy: userId,\n        scopes: dto.scopes || ['read'],\n        expiresAt: dto.expiresAt,\n        lastUsedAt: null,\n        isActive: true,\n      },\n    };\n\n    await this.commandService.publishAsync(command, { invokeContext: context });\n\n    // Return raw key only once (\u751f\u30ad\u30fc\u3092\u4e00\u5ea6\u3060\u3051\u8fd4\u3059)\n    return {\n      key: rawKey,\n      keyPrefix,\n      name: dto.name,\n      scopes: dto.scopes,\n    };\n  }\n\n  // Validate API key (API\u30ad\u30fc\u3092\u691c\u8a3c)\n  async validateApiKey(rawKey: string): Promise<ApiKeyValidation> {\n    const keyHash = this.hashKey(rawKey);\n\n    // Search across all tenants - use GSI in production (\u5168\u30c6\u30ca\u30f3\u30c8\u3092\u691c\u7d22 - \u672c\u756a\u3067\u306fGSI\u3092\u4f7f\u7528)\n    const result = await this.dataService.query({\n      indexName: 'GSI-APIKEY',\n      pk: keyHash,\n    });\n\n    if (!result.items.length) {\n      return { valid: false, reason: 'Key not found' };\n    }\n\n    const apiKey = result.items[0];\n\n    if (!apiKey.attributes.isActive) {\n      return { valid: false, reason: 'Key is inactive' };\n    }\n\n    if (\n      apiKey.attributes.expiresAt &&\n      new Date(apiKey.attributes.expiresAt) < new Date()\n    ) {\n      return { valid: false, reason: 'Key expired' };\n    }\n\n    // Update last used timestamp asynchronously (\u6700\u7d42\u4f7f\u7528\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u975e\u540c\u671f\u3067\u66f4\u65b0)\n    this.updateLastUsed(apiKey).catch(() => {});\n\n    return {\n      valid: true,\n      tenantCode: apiKey.tenantCode,\n      scopes: apiKey.attributes.scopes,\n    };\n  }\n\n  // Revoke API key (API\u30ad\u30fc\u3092\u5931\u52b9)\n  async revokeApiKey(keyPrefix: string, context: IInvoke) {\n    const { tenantCode } = getUserContext(context);\n    const pk = generatePk(tenantCode);\n\n    // Find key by prefix (\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3067\u30ad\u30fc\u3092\u691c\u7d22)\n    const keys = await this.dataService.listItemsByPk(pk, {\n      sk: { $beginsWith: 'APIKEY#' },\n    });\n\n    const apiKey = keys.items.find(\n      (k) => k.attributes.keyPrefix === keyPrefix\n    );\n\n    if (!apiKey) {\n      throw new NotFoundException('API key not found');\n    }\n\n    const command = {\n      ...apiKey,\n      version: apiKey.version,\n      attributes: {\n        ...apiKey.attributes,\n        isActive: false,\n        revokedAt: new Date().toISOString(),\n      },\n    };\n\n    return this.commandService.publishAsync(command, { invokeContext: context });\n  }\n\n  private hashKey(rawKey: string): string {\n    return createHash('sha256').update(rawKey).digest('hex');\n  }\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"api\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8",children:"API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"}),"\n",(0,a.jsxs)(e.table,{children:[(0,a.jsx)(e.thead,{children:(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.th,{children:"\u30e1\u30bd\u30c3\u30c9"}),(0,a.jsx)(e.th,{children:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8"}),(0,a.jsx)(e.th,{children:"\u8aac\u660e"})]})}),(0,a.jsxs)(e.tbody,{children:[(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"POST"}),(0,a.jsx)(e.td,{children:(0,a.jsx)(e.code,{children:"/tenants/provision"})}),(0,a.jsx)(e.td,{children:"\u65b0\u898f\u30c6\u30ca\u30f3\u30c8\u3092\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"GET"}),(0,a.jsx)(e.td,{children:(0,a.jsx)(e.code,{children:"/subscription"})}),(0,a.jsx)(e.td,{children:"\u73fe\u5728\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u53d6\u5f97"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"PATCH"}),(0,a.jsx)(e.td,{children:(0,a.jsx)(e.code,{children:"/subscription/plan"})}),(0,a.jsx)(e.td,{children:"\u30d7\u30e9\u30f3\u3092\u5909\u66f4"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"POST"}),(0,a.jsx)(e.td,{children:(0,a.jsx)(e.code,{children:"/subscription/cancel"})}),(0,a.jsx)(e.td,{children:"Cancel subscription (\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u30ad\u30e3\u30f3\u30bb\u30eb)"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"GET"}),(0,a.jsx)(e.td,{children:(0,a.jsx)(e.code,{children:"/usage"})}),(0,a.jsx)(e.td,{children:"\u73fe\u5728\u306e\u4f7f\u7528\u91cf\u3092\u53d6\u5f97"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"GET"}),(0,a.jsx)(e.td,{children:(0,a.jsx)(e.code,{children:"/usage/:period"})}),(0,a.jsx)(e.td,{children:"\u671f\u9593\u306e\u4f7f\u7528\u91cf\u3092\u53d6\u5f97"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"POST"}),(0,a.jsx)(e.td,{children:(0,a.jsx)(e.code,{children:"/api-keys"})}),(0,a.jsx)(e.td,{children:"API\u30ad\u30fc\u3092\u4f5c\u6210"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"DELETE"}),(0,a.jsx)(e.td,{children:(0,a.jsx)(e.code,{children:"/api-keys/:prefix"})}),(0,a.jsx)(e.td,{children:"Revoke API key (API\u30ad\u30fc\u3092\u5931\u52b9)"})]})]})]}),"\n",(0,a.jsx)(e.h2,{id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,a.jsx)(e.h3,{id:"1-\u30c6\u30ca\u30f3\u30c8\u5206\u96e2",children:"1. \u30c6\u30ca\u30f3\u30c8\u5206\u96e2"}),"\n",(0,a.jsx)(e.p,{children:"\u5e38\u306b\u30c6\u30ca\u30f3\u30c8\u3067\u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u3092\u30b9\u30b3\u30fc\u30d7\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"const { tenantCode } = getUserContext(context);\nconst pk = generatePk(tenantCode);\n"})}),"\n",(0,a.jsx)(e.h3,{id:"2-\u4f7f\u7528\u91cf\u8ffd\u8de1",children:"2. \u4f7f\u7528\u91cf\u8ffd\u8de1"}),"\n",(0,a.jsx)(e.p,{children:"\u30ea\u30af\u30a8\u30b9\u30c8\u3054\u3068\u3067\u306f\u306a\u304f\u3001\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30bf\u30eb\u306b\u4f7f\u7528\u91cf\u3092\u8ffd\u8de1\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"// Batch updates using a buffer (\u30d0\u30c3\u30d5\u30a1\u3092\u4f7f\u7528\u3057\u305f\u30d0\u30c3\u30c1\u66f4\u65b0)\nprivate usageBuffer = new Map<string, number>();\n\nasync trackApiCall(tenantCode: string) {\n  const current = this.usageBuffer.get(tenantCode) || 0;\n  this.usageBuffer.set(tenantCode, current + 1);\n\n  // Flush every 100 calls or 60 seconds (100\u30b3\u30fc\u30eb\u307e\u305f\u306f60\u79d2\u3054\u3068\u306b\u30d5\u30e9\u30c3\u30b7\u30e5)\n  if (current + 1 >= 100) {\n    await this.flushUsage(tenantCode);\n  }\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"3-\u8ab2\u91d1\u30a4\u30d9\u30f3\u30c8",children:"3. \u8ab2\u91d1\u30a4\u30d9\u30f3\u30c8"}),"\n",(0,a.jsx)(e.p,{children:"\u540c\u671f\u547c\u3073\u51fa\u3057\u3067\u306f\u306a\u304f\u3001\u8ab2\u91d1\u306b\u306f\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-typescript",children:"// Good: Event-driven billing (\u826f\u3044\u4f8b: \u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u306e\u8ab2\u91d1)\n@DataSyncHandler({ tableName: 'data-table' })\nexport class BillingEventHandler {\n  // Async, decoupled, reliable (\u975e\u540c\u671f\u3001\u758e\u7d50\u5408\u3001\u4fe1\u983c\u6027)\n}\n\n// Avoid: Synchronous billing calls (\u907f\u3051\u308b\u3079\u304d: \u540c\u671f\u8ab2\u91d1\u547c\u3073\u51fa\u3057)\nasync createSubscription() {\n  await this.createInStripe(); // Can fail, blocks user (\u5931\u6557\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u30e6\u30fc\u30b6\u30fc\u3092\u30d6\u30ed\u30c3\u30af)\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u95a2\u9023\u9805\u76ee",children:"\u95a2\u9023\u9805\u76ee"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"./tenant",children:"\u30c6\u30ca\u30f3\u30c8\u30e2\u30b8\u30e5\u30fc\u30eb"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"./master",children:"\u30de\u30b9\u30bf\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"./multi-tenant-patterns",children:"\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"./event-handling-patterns",children:"\u30a4\u30d9\u30f3\u30c8\u51e6\u7406\u30d1\u30bf\u30fc\u30f3"})}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>c});var r=t(6540);const a={},i=r.createContext(a);function s(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);