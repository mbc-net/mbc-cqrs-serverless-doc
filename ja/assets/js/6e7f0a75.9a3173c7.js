"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[7658],{2179:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"import-export-patterns","title":"\u30a4\u30f3\u30dd\u30fc\u30c8/\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3","description":"\u30d0\u30c3\u30c1\u51e6\u7406\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u305fCSV\u304a\u3088\u3073Excel\u5f62\u5f0f\u3067\u306e\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u30fb\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002","source":"@site/i18n/ja/docusaurus-plugin-content-docs/current/import-export-patterns.md","sourceDirName":".","slug":"/import-export-patterns","permalink":"/ja/docs/import-export-patterns","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":16,"frontMatter":{"sidebar_position":16,"description":"\u30d0\u30c3\u30c1\u51e6\u7406\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u305fCSV\u304a\u3088\u3073Excel\u5f62\u5f0f\u3067\u306e\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u30fb\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002"},"sidebar":"tutorialSidebar","previous":{"title":"\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3","permalink":"/ja/docs/multi-tenant-patterns"},"next":{"title":"API\u7d71\u5408\u30ac\u30a4\u30c9","permalink":"/ja/docs/api-integration-guide"}}');var s=t(4848),o=t(8453);const i={sidebar_position:16,description:"\u30d0\u30c3\u30c1\u51e6\u7406\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u305fCSV\u304a\u3088\u3073Excel\u5f62\u5f0f\u3067\u306e\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u30fb\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002"},c="\u30a4\u30f3\u30dd\u30fc\u30c8/\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",a={},d=[{value:"\u3053\u306e\u30ac\u30a4\u30c9\u3092\u4f7f\u7528\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0",id:"\u3053\u306e\u30ac\u30a4\u30c9\u3092\u4f7f\u7528\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0",level:2},{value:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u6982\u8981",id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u6982\u8981",level:2},{value:"\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d1\u30bf\u30fc\u30f3",id:"\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d1\u30bf\u30fc\u30f3",level:2},{value:"\u30b9\u30c8\u30ec\u30fc\u30b8\u30b5\u30fc\u30d3\u30b9",id:"\u30b9\u30c8\u30ec\u30fc\u30b8\u30b5\u30fc\u30d3\u30b9",level:3},{value:"\u30b9\u30c8\u30ec\u30fc\u30b8\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc",id:"\u30b9\u30c8\u30ec\u30fc\u30b8\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc",level:3},{value:"CSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",id:"csv\u30a4\u30f3\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",level:2},{value:"CSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc",id:"csv\u30a4\u30f3\u30dd\u30fc\u30c8\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc",level:3},{value:"CSV\u30d1\u30fc\u30b5\u30fc\u30b5\u30fc\u30d3\u30b9",id:"csv\u30d1\u30fc\u30b5\u30fc\u30b5\u30fc\u30d3\u30b9",level:3},{value:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc",id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc",level:3},{value:"Excel\u30a4\u30f3\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",id:"excel\u30a4\u30f3\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",level:2},{value:"Excel\u30d8\u30eb\u30d1\u30fc\u95a2\u6570",id:"excel\u30d8\u30eb\u30d1\u30fc\u95a2\u6570",level:3},{value:"Excel\u30a4\u30f3\u30dd\u30fc\u30c8\u30b5\u30fc\u30d3\u30b9",id:"excel\u30a4\u30f3\u30dd\u30fc\u30c8\u30b5\u30fc\u30d3\u30b9",level:3},{value:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u30d1\u30bf\u30fc\u30f3",id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u30d1\u30bf\u30fc\u30f3",level:3},{value:"\u5177\u8c61\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc",id:"\u5177\u8c61\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc",level:3},{value:"\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",id:"\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",level:2},{value:"\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30b5\u30fc\u30d3\u30b9",id:"\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30b5\u30fc\u30d3\u30b9",level:3},{value:"Step Functions\u7d71\u5408",id:"step-functions\u7d71\u5408",level:2},{value:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3",id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3",level:3},{value:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",level:2},{value:"1. \u30d0\u30c3\u30c1\u51e6\u7406",id:"1-\u30d0\u30c3\u30c1\u51e6\u7406",level:3},{value:"2. \u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0",id:"2-\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0",level:3},{value:"3. \u51e6\u7406\u524d\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3",id:"3-\u51e6\u7406\u524d\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3",level:3},{value:"4. \u9032\u6357\u5831\u544a",id:"4-\u9032\u6357\u5831\u544a",level:3},{value:"ImportModule API\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9",id:"importmodule-api\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9",level:2},{value:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",id:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",level:3},{value:"ProcessingMode\u5217\u6319\u578b",id:"processingmode-enum",level:3},{value:"CreateCsvImportDto",id:"createcsvimportdto",level:3},{value:"CreateZipImportDto",id:"createzipimportdto",level:3},{value:"\u30b3\u30a2\u30b3\u30f3\u30bb\u30d7\u30c8",id:"\u30b3\u30a2\u30b3\u30f3\u30bb\u30d7\u30c8",level:3},{value:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u5b9f\u88c5",id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u5b9f\u88c5",level:3},{value:"ComparisonStatus\u5217\u6319\u578b",id:"comparisonstatus-enum",level:3},{value:"ComparisonResult\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",id:"comparisonresult-interface",level:3},{value:"IProcessStrategy\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9",id:"iprocessstrategy-interface",level:3},{value:"BaseProcessStrategy\u62bd\u8c61\u30af\u30e9\u30b9",id:"baseprocessstrategy-class",level:3},{value:"\u30d7\u30ed\u30bb\u30b9\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u5b9f\u88c5",id:"\u30d7\u30ed\u30bb\u30b9\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u5b9f\u88c5",level:3},{value:"\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a",id:"\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a",level:3},{value:"\u30a4\u30f3\u30dd\u30fc\u30c8\u7528\u30ab\u30b9\u30bf\u30e0\u30a4\u30d9\u30f3\u30c8\u30d5\u30a1\u30af\u30c8\u30ea\u30fc",id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u7528\u30ab\u30b9\u30bf\u30e0\u30a4\u30d9\u30f3\u30c8\u30d5\u30a1\u30af\u30c8\u30ea\u30fc",level:3},{value:"ImportStatusHandler API",id:"importstatushandler-api",level:3},{value:"\u52d5\u4f5c",id:"\u52d5\u4f5c",level:4},{value:"\u30e1\u30bd\u30c3\u30c9",id:"\u30e1\u30bd\u30c3\u30c9",level:4},{value:"Step Functions\u7d71\u5408",id:"step-functions\u7d71\u5408-1",level:4},{value:"ImportQueueEventHandler\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0",id:"import-error-handling",level:3},{value:"\u30a8\u30e9\u30fc\u30d5\u30ed\u30fc\uff08v1.0.19\u4ee5\u964d\uff09",id:"\u30a8\u30e9\u30fc\u30d5\u30ed\u30fcv1019\u4ee5\u964d",level:4},{value:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9",id:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9",level:4},{value:"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306e\u52d5\u4f5c",id:"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306e\u52d5\u4f5c",level:4},{value:"CsvImportSfnEventHandler",id:"csvimportsfneventhandler",level:3},{value:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9",id:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9-1",level:4},{value:"\u30b9\u30c6\u30fc\u30bf\u30b9\u5224\u5b9a\uff08v1.0.20\u4ee5\u964d\uff09",id:"\u30b9\u30c6\u30fc\u30bf\u30b9\u5224\u5b9av1020\u4ee5\u964d",level:4},{value:"ZipImportSfnEventHandler",id:"zipimportsfneventhandler",level:3},{value:"\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u30b9\u30c6\u30fc\u30c8",id:"\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u30b9\u30c6\u30fc\u30c8",level:4},{value:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9",id:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9-2",level:4},{value:"\u30d5\u30a1\u30a4\u30eb\u547d\u540d\u898f\u5247",id:"\u30d5\u30a1\u30a4\u30eb\u547d\u540d\u898f\u5247",level:4},{value:"\u51e6\u7406\u30d5\u30ed\u30fc",id:"\u51e6\u7406\u30d5\u30ed\u30fc",level:4},{value:"ZipImportSfnEvent\u69cb\u9020",id:"zipimportsfnevent\u69cb\u9020",level:4},{value:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",children:"\u30a4\u30f3\u30dd\u30fc\u30c8/\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3"})}),"\n",(0,s.jsx)(n.p,{children:"\u3053\u306e\u30ac\u30a4\u30c9\u3067\u306f\u3001CSV\u306e\u51e6\u7406\u3001Excel\u30d5\u30a1\u30a4\u30eb\u306e\u51e6\u7406\u3001Step Functions\u3092\u4f7f\u7528\u3057\u305f\u30d0\u30c3\u30c1\u30c7\u30fc\u30bf\u64cd\u4f5c\u306a\u3069\u3001\u30c7\u30fc\u30bf\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u304a\u3088\u3073\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u64cd\u4f5c\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u3053\u306e\u30ac\u30a4\u30c9\u3092\u4f7f\u7528\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0",children:"\u3053\u306e\u30ac\u30a4\u30c9\u3092\u4f7f\u7528\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0"}),"\n",(0,s.jsx)(n.p,{children:"\u4ee5\u4e0b\u306e\u5834\u5408\u306b\u3053\u306e\u30ac\u30a4\u30c9\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"CSV\u307e\u305f\u306fExcel\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u4e00\u62ec\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b"}),"\n",(0,s.jsx)(n.li,{children:"\u69d8\u3005\u306a\u5f62\u5f0f\u306b\u30c7\u30fc\u30bf\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3059\u308b"}),"\n",(0,s.jsx)(n.li,{children:"Step Functions\u3067\u5927\u898f\u6a21\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u51e6\u7406\u3059\u308b"}),"\n",(0,s.jsx)(n.li,{children:"S3\u7f72\u540d\u4ed8\u304dURL\u3067\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u5b9f\u88c5\u3059\u308b"}),"\n",(0,s.jsx)(n.li,{children:"\u5916\u90e8\u5f62\u5f0f\u3068\u5185\u90e8\u5f62\u5f0f\u306e\u9593\u3067\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u6982\u8981",children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u6982\u8981"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Client    \u2502\u2500\u2500\u2500\u2500>\u2502     S3      \u2502\u2500\u2500\u2500\u2500>\u2502Step Function\u2502\u2500\u2500\u2500\u2500>\u2502   Lambda    \u2502\n\u2502  (Upload)   \u2502     \u2502  (Storage)  \u2502     \u2502(Orchestrate)\u2502     \u2502 (Process)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                                    \u2502\n                                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                        \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502  DynamoDB   \u2502<\u2500\u2500\u2500\u2500\u2502   Import    \u2502\n                    \u2502  (Command)  \u2502     \u2502   Handler   \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d1\u30bf\u30fc\u30f3",children:"\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,s.jsx)(n.h3,{id:"\u30b9\u30c8\u30ec\u30fc\u30b8\u30b5\u30fc\u30d3\u30b9",children:"\u30b9\u30c8\u30ec\u30fc\u30b8\u30b5\u30fc\u30d3\u30b9"}),"\n",(0,s.jsx)(n.p,{children:"\u5b89\u5168\u306a\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u305f\u3081\u306e\u7f72\u540d\u4ed8\u304dURL\u3092\u751f\u6210\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// storage/storage.service.ts\nimport { Injectable } from '@nestjs/common';\nimport { S3Service } from '@mbc-cqrs-serverless/core';\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\nimport { PutObjectCommand, GetObjectCommand } from '@aws-sdk/client-s3';\n\n@Injectable()\nexport class StorageService {\n  constructor(private readonly s3Service: S3Service) {}\n\n  /**\n   * Generate upload URL for file import (\u30d5\u30a1\u30a4\u30eb\u30a4\u30f3\u30dd\u30fc\u30c8\u7528\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9URL\u3092\u751f\u6210)\n   */\n  async genUploadUrl(\n    filename: string,\n    contentType = 'text/csv',\n  ): Promise<{ bucket: string; key: string; url: string }> {\n    const bucket = this.s3Service.privateBucket;\n    const timestamp = Date.now();\n    const key = `imports/${timestamp}/${filename}`;\n\n    const command = new PutObjectCommand({\n      Bucket: bucket,\n      Key: key,\n      ContentType: contentType,\n      ACL: 'private',\n    });\n\n    const url = await getSignedUrl(this.s3Service.client, command, {\n      expiresIn: 3600, // 1 hour (1\u6642\u9593)\n    });\n\n    return { bucket, key, url };\n  }\n\n  /**\n   * Generate download URL for file export (\u30d5\u30a1\u30a4\u30eb\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u7528\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9URL\u3092\u751f\u6210)\n   */\n  async genDownloadUrl(\n    key: string,\n    filename?: string,\n  ): Promise<{ url: string }> {\n    const command = new GetObjectCommand({\n      Bucket: this.s3Service.privateBucket,\n      Key: key,\n      ResponseContentDisposition: filename\n        ? `attachment; filename=\"${filename}\"`\n        : undefined,\n    });\n\n    const url = await getSignedUrl(this.s3Service.client, command, {\n      expiresIn: 3600,\n    });\n\n    return { url };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u30b9\u30c8\u30ec\u30fc\u30b8\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc",children:"\u30b9\u30c8\u30ec\u30fc\u30b8\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// storage/storage.controller.ts\nimport { Controller, Post, Get, Body, Query } from '@nestjs/common';\nimport { StorageService } from './storage.service';\n\n@Controller('api/storage')\nexport class StorageController {\n  constructor(private readonly storageService: StorageService) {}\n\n  /**\n   * Get presigned URL for upload (\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u7528\u306e\u7f72\u540d\u4ed8\u304dURL\u3092\u53d6\u5f97)\n   */\n  @Post('upload-url')\n  async getUploadUrl(\n    @Body() dto: { filename: string; contentType?: string },\n  ) {\n    return this.storageService.genUploadUrl(dto.filename, dto.contentType);\n  }\n\n  /**\n   * Get presigned URL for download (\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u7528\u306e\u7f72\u540d\u4ed8\u304dURL\u3092\u53d6\u5f97)\n   */\n  @Get('download-url')\n  async getDownloadUrl(\n    @Query('key') key: string,\n    @Query('filename') filename?: string,\n  ) {\n    return this.storageService.genDownloadUrl(key, filename);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"csv\u30a4\u30f3\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",children:"CSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,s.jsx)(n.h3,{id:"csv\u30a4\u30f3\u30dd\u30fc\u30c8\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc",children:"CSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// csv-import/csv-import.controller.ts\nimport { Controller, Post, Body } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { StepFunctionService, INVOKE_CONTEXT, IInvoke } from '@mbc-cqrs-serverless/core';\n\nexport class CsvImportDto {\n  bucket: string;\n  key: string;\n  type: string;  // Import type identifier (\u30a4\u30f3\u30dd\u30fc\u30c8\u30bf\u30a4\u30d7\u8b58\u5225\u5b50)\n}\n\n@Controller('api/csv-import')\nexport class CsvImportController {\n  private readonly importArn: string;\n\n  constructor(\n    private readonly configService: ConfigService,\n    private readonly sfnService: StepFunctionService,\n  ) {\n    this.importArn = this.configService.get<string>('SFN_CSV_IMPORT_ARN');\n  }\n\n  /**\n   * Start CSV import via Step Functions (Step Functions\u3067CSV\u30a4\u30f3\u30dd\u30fc\u30c8\u3092\u958b\u59cb)\n   */\n  @Post('/')\n  async startImport(\n    @INVOKE_CONTEXT() invokeContext: IInvoke,\n    @Body() dto: CsvImportDto,\n  ) {\n    const executionName = `${dto.type}-${Date.now()}`;\n\n    return this.sfnService.startExecution(\n      this.importArn,\n      {\n        ...dto,\n        invokeContext,\n      },\n      executionName,\n    );\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"csv\u30d1\u30fc\u30b5\u30fc\u30b5\u30fc\u30d3\u30b9",children:"CSV\u30d1\u30fc\u30b5\u30fc\u30b5\u30fc\u30d3\u30b9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// csv-import/csv-parser.service.ts\nimport { Injectable, Logger } from '@nestjs/common';\nimport { S3Service } from '@mbc-cqrs-serverless/core';\nimport { GetObjectCommand } from '@aws-sdk/client-s3';\nimport * as csvParser from 'csv-parser';\nimport { Readable } from 'stream';\n\nexport interface ParsedRow {\n  rowNumber: number;\n  data: Record<string, string>;\n  errors: string[];\n}\n\n@Injectable()\nexport class CsvParserService {\n  private readonly logger = new Logger(CsvParserService.name);\n\n  constructor(private readonly s3Service: S3Service) {}\n\n  /**\n   * Parse CSV file from S3 (S3\u304b\u3089CSV\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u6790)\n   */\n  async parseFromS3(\n    bucket: string,\n    key: string,\n    options?: { encoding?: string; delimiter?: string },\n  ): Promise<ParsedRow[]> {\n    const command = new GetObjectCommand({ Bucket: bucket, Key: key });\n    const response = await this.s3Service.client.send(command);\n\n    const stream = response.Body as Readable;\n    const results: ParsedRow[] = [];\n    let rowNumber = 0;\n\n    return new Promise((resolve, reject) => {\n      stream\n        .pipe(csvParser({\n          separator: options?.delimiter || ',',\n          skipLines: 0,\n        }))\n        .on('data', (data) => {\n          rowNumber++;\n          results.push({\n            rowNumber,\n            data,\n            errors: [],\n          });\n        })\n        .on('end', () => {\n          this.logger.log(`Parsed ${results.length} rows from ${key}`);\n          resolve(results);\n        })\n        .on('error', (error) => {\n          this.logger.error(`Failed to parse CSV: ${error.message}`);\n          reject(error);\n        });\n    });\n  }\n\n  /**\n   * Validate parsed rows (\u89e3\u6790\u3055\u308c\u305f\u884c\u3092\u30d0\u30ea\u30c7\u30fc\u30c8)\n   */\n  validateRows(\n    rows: ParsedRow[],\n    requiredFields: string[],\n  ): ParsedRow[] {\n    return rows.map(row => {\n      const errors: string[] = [];\n\n      for (const field of requiredFields) {\n        if (!row.data[field] || row.data[field].trim() === '') {\n          errors.push(`Missing required field: ${field}`);\n        }\n      }\n\n      return { ...row, errors };\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc",children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// csv-import/event/csv-import.event.handler.ts\nimport { Injectable, Logger } from '@nestjs/common';\nimport { EventHandler, IEventHandler, SNSService } from '@mbc-cqrs-serverless/core';\nimport { ConfigService } from '@nestjs/config';\nimport { CsvParserService } from '../csv-parser.service';\nimport { ProductService } from '../../product/product.service';\n\nexport class CsvImportEvent {\n  bucket: string;\n  key: string;\n  type: string;\n  invokeContext: any;\n}\n\n@EventHandler(CsvImportEvent)\n@Injectable()\nexport class CsvImportEventHandler implements IEventHandler<CsvImportEvent> {\n  private readonly logger = new Logger(CsvImportEventHandler.name);\n  private readonly alarmTopicArn: string;\n\n  constructor(\n    private readonly csvParser: CsvParserService,\n    private readonly productService: ProductService,\n    private readonly snsService: SNSService,\n    private readonly configService: ConfigService,\n  ) {\n    this.alarmTopicArn = this.configService.get<string>('SNS_ALARM_TOPIC_ARN');\n  }\n\n  /**\n   * Process CSV import event (CSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30a4\u30d9\u30f3\u30c8\u3092\u51e6\u7406)\n   */\n  async execute(event: CsvImportEvent): Promise<any> {\n    this.logger.log(`Processing import: ${event.key}`);\n\n    try {\n      // Parse CSV (CSV\u3092\u89e3\u6790)\n      const rows = await this.csvParser.parseFromS3(event.bucket, event.key);\n\n      // Validate (\u30d0\u30ea\u30c7\u30fc\u30c8)\n      const validatedRows = this.csvParser.validateRows(rows, [\n        'code', 'name', 'price',\n      ]);\n\n      // Filter valid rows (\u6709\u52b9\u306a\u884c\u3092\u30d5\u30a3\u30eb\u30bf)\n      const validRows = validatedRows.filter(r => r.errors.length === 0);\n      const invalidRows = validatedRows.filter(r => r.errors.length > 0);\n\n      if (invalidRows.length > 0) {\n        this.logger.warn(`${invalidRows.length} rows have validation errors`);\n      }\n\n      // Process in batches (\u30d0\u30c3\u30c1\u3067\u51e6\u7406)\n      const batchSize = 30;\n      let processedCount = 0;\n\n      for (let i = 0; i < validRows.length; i += batchSize) {\n        const batch = validRows.slice(i, i + batchSize);\n\n        await Promise.all(\n          batch.map(row => this.processRow(row.data, event.invokeContext)),\n        );\n\n        processedCount += batch.length;\n        this.logger.log(`Processed ${processedCount}/${validRows.length} rows`);\n      }\n\n      return {\n        success: true,\n        totalRows: rows.length,\n        processedRows: processedCount,\n        errorRows: invalidRows.length,\n      };\n    } catch (error) {\n      await this.sendAlarm(event, error);\n      throw error;\n    }\n  }\n\n  private async processRow(data: Record<string, string>, invokeContext: any) {\n    await this.productService.publishCommand({\n      code: data.code,\n      name: data.name,\n      attributes: {\n        price: parseFloat(data.price),\n        category: data.category,\n        description: data.description,\n      },\n    }, invokeContext);\n  }\n\n  private async sendAlarm(event: CsvImportEvent, error: Error) {\n    await this.snsService.publish({\n      topicArn: this.alarmTopicArn,\n      subject: 'CSV Import Error',\n      message: JSON.stringify({\n        key: event.key,\n        error: error.message,\n        timestamp: new Date().toISOString(),\n      }),\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"excel\u30a4\u30f3\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",children:"Excel\u30a4\u30f3\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,s.jsx)(n.h3,{id:"excel\u30d8\u30eb\u30d1\u30fc\u95a2\u6570",children:"Excel\u30d8\u30eb\u30d1\u30fc\u95a2\u6570"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// helpers/excel.ts\nimport { Workbook, Worksheet, Cell } from 'exceljs';\n\n/**\n * Get cell value handling formulas and rich text (\u6570\u5f0f\u3084\u30ea\u30c3\u30c1\u30c6\u30ad\u30b9\u30c8\u3092\u51e6\u7406\u3057\u3066\u30bb\u30eb\u5024\u3092\u53d6\u5f97)\n */\nexport function getCellValue(row: any, column: string): string | undefined {\n  const cell = row.getCell(column);\n\n  if (!cell || cell.value === null || cell.value === undefined) {\n    return undefined;\n  }\n\n  // Handle formula result (\u6570\u5f0f\u306e\u7d50\u679c\u3092\u51e6\u7406)\n  if (typeof cell.value === 'object' && 'result' in cell.value) {\n    return String(cell.value.result);\n  }\n\n  // Handle rich text (\u30ea\u30c3\u30c1\u30c6\u30ad\u30b9\u30c8\u3092\u51e6\u7406)\n  if (typeof cell.value === 'object' && 'richText' in cell.value) {\n    return cell.value.richText.map((r: any) => r.text).join('');\n  }\n\n  return String(cell.value);\n}\n\n/**\n * Get numeric cell value (\u6570\u5024\u306e\u30bb\u30eb\u5024\u3092\u53d6\u5f97)\n */\nexport function getCellNumber(row: any, column: string): number | undefined {\n  const value = getCellValue(row, column);\n  if (!value) return undefined;\n\n  const num = parseFloat(value.replace(/,/g, ''));\n  return isNaN(num) ? undefined : num;\n}\n\n/**\n * Get date cell value (\u65e5\u4ed8\u306e\u30bb\u30eb\u5024\u3092\u53d6\u5f97)\n */\nexport function getCellDate(row: any, column: string): Date | undefined {\n  const cell = row.getCell(column);\n\n  if (cell.value instanceof Date) {\n    return cell.value;\n  }\n\n  const value = getCellValue(row, column);\n  if (!value) return undefined;\n\n  const date = new Date(value);\n  return isNaN(date.getTime()) ? undefined : date;\n}\n\n/**\n * Find header row by matching column headers (\u5217\u30d8\u30c3\u30c0\u30fc\u3092\u30de\u30c3\u30c1\u30f3\u30b0\u3057\u3066\u30d8\u30c3\u30c0\u30fc\u884c\u3092\u691c\u7d22)\n */\nexport function findHeaderRow(\n  worksheet: Worksheet,\n  expectedHeaders: string[],\n  maxRows = 20,\n): number {\n  for (let rowNum = 1; rowNum <= maxRows; rowNum++) {\n    const row = worksheet.getRow(rowNum);\n    const values = row.values as any[];\n\n    const matches = expectedHeaders.filter(header =>\n      values.some(v => v && String(v).includes(header)),\n    );\n\n    if (matches.length >= expectedHeaders.length * 0.8) {\n      return rowNum;\n    }\n  }\n\n  throw new Error('Header row not found');\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"excel\u30a4\u30f3\u30dd\u30fc\u30c8\u30b5\u30fc\u30d3\u30b9",children:"Excel\u30a4\u30f3\u30dd\u30fc\u30c8\u30b5\u30fc\u30d3\u30b9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// excel-import/excel-import.service.ts\nimport { Injectable, Logger } from '@nestjs/common';\nimport { S3Service } from '@mbc-cqrs-serverless/core';\nimport { GetObjectCommand } from '@aws-sdk/client-s3';\nimport { Workbook } from 'exceljs';\nimport { getCellValue, getCellNumber, findHeaderRow } from '../helpers/excel';\n\nexport interface ExcelImportResult {\n  success: boolean;\n  sheetName: string;\n  totalRows: number;\n  processedRows: number;\n  errors: Array<{ row: number; message: string }>;\n}\n\n@Injectable()\nexport class ExcelImportService {\n  private readonly logger = new Logger(ExcelImportService.name);\n\n  constructor(private readonly s3Service: S3Service) {}\n\n  /**\n   * Load workbook from S3 (S3\u304b\u3089\u30ef\u30fc\u30af\u30d6\u30c3\u30af\u3092\u8aad\u307f\u8fbc\u3080)\n   */\n  async loadWorkbook(bucket: string, key: string): Promise<Workbook> {\n    const command = new GetObjectCommand({ Bucket: bucket, Key: key });\n    const response = await this.s3Service.client.send(command);\n\n    const chunks: Buffer[] = [];\n    for await (const chunk of response.Body as any) {\n      chunks.push(chunk);\n    }\n    const buffer = Buffer.concat(chunks);\n\n    const workbook = new Workbook();\n\n    if (key.endsWith('.xlsx') || key.endsWith('.xlsm')) {\n      await workbook.xlsx.load(buffer);\n    } else if (key.endsWith('.xls')) {\n      // For .xls files, use different parser (.xls\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u5225\u306e\u30d1\u30fc\u30b5\u30fc\u3092\u4f7f\u7528)\n      throw new Error('XLS format not supported. Please use XLSX.');\n    }\n\n    return workbook;\n  }\n\n  /**\n   * Process worksheet with row processor (\u884c\u30d7\u30ed\u30bb\u30c3\u30b5\u3067\u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u3092\u51e6\u7406)\n   */\n  async processWorksheet<T>(\n    worksheet: any,\n    config: {\n      headerRow?: number;\n      expectedHeaders?: string[];\n      startRow?: number;\n      processor: (row: any, rowNumber: number) => Promise<T | null>;\n    },\n  ): Promise<ExcelImportResult & { data: T[] }> {\n    const errors: Array<{ row: number; message: string }> = [];\n    const data: T[] = [];\n\n    // Find or use specified header row (\u30d8\u30c3\u30c0\u30fc\u884c\u3092\u691c\u7d22\u307e\u305f\u306f\u6307\u5b9a\u3055\u308c\u305f\u3082\u306e\u3092\u4f7f\u7528)\n    const headerRow = config.headerRow || (\n      config.expectedHeaders\n        ? findHeaderRow(worksheet, config.expectedHeaders)\n        : 1\n    );\n\n    const startRow = config.startRow || headerRow + 1;\n    let processedRows = 0;\n    let totalRows = 0;\n\n    worksheet.eachRow((row: any, rowNumber: number) => {\n      if (rowNumber < startRow) return;\n      totalRows++;\n    });\n\n    for (let rowNum = startRow; rowNum <= worksheet.rowCount; rowNum++) {\n      const row = worksheet.getRow(rowNum);\n\n      // Skip empty rows (\u7a7a\u884c\u3092\u30b9\u30ad\u30c3\u30d7)\n      if (this.isEmptyRow(row)) continue;\n\n      try {\n        const result = await config.processor(row, rowNum);\n        if (result !== null) {\n          data.push(result);\n          processedRows++;\n        }\n      } catch (error) {\n        errors.push({\n          row: rowNum,\n          message: error.message,\n        });\n      }\n    }\n\n    return {\n      success: errors.length === 0,\n      sheetName: worksheet.name,\n      totalRows,\n      processedRows,\n      errors,\n      data,\n    };\n  }\n\n  private isEmptyRow(row: any): boolean {\n    const values = row.values as any[];\n    return !values || values.every(v => v === null || v === undefined || v === '');\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u30d1\u30bf\u30fc\u30f3",children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// import/base-import.strategy.ts\nimport { IInvoke } from '@mbc-cqrs-serverless/core';\n\n/**\n * Base interface for import strategies (\u30a4\u30f3\u30dd\u30fc\u30c8\u6226\u7565\u306e\u57fa\u672c\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9)\n * @typeParam TInput - The input type, must be an object (\u5165\u529b\u578b\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059)\n * @typeParam TAttributesDto - The output DTO type, must be an object (\u51fa\u529bDTO\u578b\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059)\n */\nexport interface IImportStrategy<TInput extends object, TAttributesDto extends object> {\n  /**\n   * Transform raw input to command DTO (\u751f\u306e\u5165\u529b\u3092\u30b3\u30de\u30f3\u30c9DTO\u306b\u5909\u63db)\n   */\n  transform(input: TInput): Promise<TAttributesDto>;\n\n  /**\n   * Validate transformed DTO (\u5909\u63db\u5f8c\u306eDTO\u3092\u30d0\u30ea\u30c7\u30fc\u30c8)\n   */\n  validate(data: TAttributesDto): Promise<void>;\n}\n\n/**\n * Base import strategy with common functionality (\u5171\u901a\u6a5f\u80fd\u3092\u6301\u3064\u57fa\u672c\u30a4\u30f3\u30dd\u30fc\u30c8\u6226\u7565)\n * @typeParam TInput - The input type, must be an object (\u5165\u529b\u578b\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059)\n * @typeParam TAttributesDto - The output DTO type, must be an object (\u51fa\u529bDTO\u578b\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059)\n */\nexport abstract class BaseImportStrategy<TInput extends object, TAttributesDto extends object>\n  implements IImportStrategy<TInput, TAttributesDto>\n{\n  /**\n   * Transform raw input to command DTO (default: return as-is) (\u751f\u306e\u5165\u529b\u3092\u30b3\u30de\u30f3\u30c9DTO\u306b\u5909\u63db\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\uff1a\u305d\u306e\u307e\u307e\u8fd4\u3059)\n   */\n  async transform(input: TInput): Promise<TAttributesDto> {\n    return input as unknown as TAttributesDto;\n  }\n\n  /**\n   * Validate transformed DTO using class-validator (class-validator\u3092\u4f7f\u7528\u3057\u3066\u5909\u63db\u5f8c\u306eDTO\u3092\u30d0\u30ea\u30c7\u30fc\u30c8)\n   */\n  async validate(data: TAttributesDto): Promise<void> {\n    // Uses class-validator for validation (class-validator\u3067\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c)\n    const errors = await validate(data as object);\n    if (errors.length > 0) {\n      throw new BadRequestException({\n        statusCode: 400,\n        message: this.flattenValidationErrors(errors),\n        error: 'Bad Request',\n      });\n    }\n  }\n\n  /**\n   * Flatten validation errors to a simple format (\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u3092\u30b7\u30f3\u30d7\u30eb\u306a\u5f62\u5f0f\u306b\u30d5\u30e9\u30c3\u30c8\u5316)\n   */\n  private flattenValidationErrors(\n    errors: ValidationError[],\n    parentPath = '',\n  ): string[] {\n    const messages: string[] = [];\n    for (const error of errors) {\n      const currentPath = parentPath\n        ? `${parentPath}.${error.property}`\n        : error.property;\n\n      if (error.children && error.children.length > 0) {\n        messages.push(\n          ...this.flattenValidationErrors(error.children, currentPath),\n        );\n      } else if (error.constraints) {\n        const firstConstraint = Object.values(error.constraints)[0];\n        const message = firstConstraint.replace(error.property, currentPath);\n        messages.push(message);\n      }\n    }\n    return messages;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5177\u8c61\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc",children:"\u5177\u8c61\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// product/import/product-import.strategy.ts\nimport { Injectable } from '@nestjs/common';\nimport { KEY_SEPARATOR, generateId } from '@mbc-cqrs-serverless/core';\nimport { BaseImportStrategy } from '@mbc-cqrs-serverless/import';\nimport { ulid } from 'ulid';\nimport { ProductCommandDto } from '../dto/product-command.dto';\n\nconst PRODUCT_PK_PREFIX = 'PRODUCT';\n\nexport interface ProductImportInput {\n  code: string;\n  name: string;\n  category?: string;\n  price?: string;\n  description?: string;\n  tenantCode: string; // Passed from import context\n}\n\n@Injectable()\nexport class ProductImportStrategy\n  extends BaseImportStrategy<ProductImportInput, ProductCommandDto>\n{\n  /**\n   * Transform import data to command DTO (\u30a4\u30f3\u30dd\u30fc\u30c8\u30c7\u30fc\u30bf\u3092\u30b3\u30de\u30f3\u30c9DTO\u306b\u5909\u63db)\n   */\n  async transform(input: ProductImportInput): Promise<ProductCommandDto> {\n    const { tenantCode } = input;\n\n    const pk = `${PRODUCT_PK_PREFIX}${KEY_SEPARATOR}${tenantCode}`;\n    const sk = ulid();\n    const id = generateId(pk, sk);\n\n    return new ProductCommandDto({\n      pk,\n      sk,\n      id,\n      tenantCode,\n      code: input.code?.trim(),\n      name: input.name?.trim(),\n      type: 'PRODUCT',\n      attributes: {\n        category: input.category?.trim(),\n        price: input.price ? parseFloat(input.price.replace(/,/g, '')) : undefined,\n        description: input.description?.trim(),\n      },\n    });\n  }\n\n  /**\n   * Validate import input (\u30a4\u30f3\u30dd\u30fc\u30c8\u5165\u529b\u3092\u30d0\u30ea\u30c7\u30fc\u30c8)\n   */\n  async validate(input: ProductImportInput): Promise<void> {\n    if (!input.code) {\n      throw new Error('Product code is required');\n    }\n    if (!input.name) {\n      throw new Error('Product name is required');\n    }\n    if (input.price && isNaN(parseFloat(input.price.replace(/,/g, '')))) {\n      throw new Error('Invalid price format');\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3",children:"\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3"}),"\n",(0,s.jsx)(n.admonition,{title:"\u6ce8\u610f",type:"info",children:(0,s.jsxs)(n.p,{children:["\u4ee5\u4e0b\u306b\u793a\u3059\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u5b9f\u88c5\u4f8b\u3067\u3059\u3002\u30a4\u30f3\u30dd\u30fc\u30c8\u30e2\u30b8\u30e5\u30fc\u30eb\uff08",(0,s.jsx)(n.code,{children:"@mbc-cqrs-serverless/import"}),"\uff09\u3068\u306f\u7570\u306a\u308a\u3001\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u306f\u5c02\u7528\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u308c\u3089\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30fc\u30c9\u306b\u76f4\u63a5\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002"]})}),"\n",(0,s.jsx)(n.h3,{id:"\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30b5\u30fc\u30d3\u30b9",children:"\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30b5\u30fc\u30d3\u30b9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// export/export.service.ts\nimport { Injectable, Logger } from '@nestjs/common';\nimport { S3Service } from '@mbc-cqrs-serverless/core';\nimport { PutObjectCommand } from '@aws-sdk/client-s3';\nimport { Workbook } from 'exceljs';\n\n@Injectable()\nexport class ExportService {\n  private readonly logger = new Logger(ExportService.name);\n\n  constructor(private readonly s3Service: S3Service) {}\n\n  /**\n   * Export data to CSV and upload to S3 (\u30c7\u30fc\u30bf\u3092CSV\u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u3066S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9)\n   */\n  async exportToCsv(\n    data: Record<string, any>[],\n    headers: { key: string; label: string }[],\n    filename: string,\n  ): Promise<{ bucket: string; key: string }> {\n    // Build CSV content (CSV\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u69cb\u7bc9)\n    const headerRow = headers.map(h => h.label).join(',');\n    const dataRows = data.map(row =>\n      headers.map(h => this.escapeCsvValue(row[h.key])).join(','),\n    );\n    const csvContent = [headerRow, ...dataRows].join('\\n');\n\n    // Upload to S3 (S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9)\n    const bucket = this.s3Service.privateBucket;\n    const key = `exports/${Date.now()}/${filename}`;\n\n    await this.s3Service.client.send(new PutObjectCommand({\n      Bucket: bucket,\n      Key: key,\n      Body: csvContent,\n      ContentType: 'text/csv; charset=utf-8',\n    }));\n\n    this.logger.log(`Exported ${data.length} rows to ${key}`);\n    return { bucket, key };\n  }\n\n  /**\n   * Export data to Excel and upload to S3 (\u30c7\u30fc\u30bf\u3092Excel\u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u3066S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9)\n   */\n  async exportToExcel(\n    data: Record<string, any>[],\n    headers: { key: string; label: string; width?: number }[],\n    filename: string,\n    sheetName = 'Data',\n  ): Promise<{ bucket: string; key: string }> {\n    const workbook = new Workbook();\n    const worksheet = workbook.addWorksheet(sheetName);\n\n    // Set columns (\u5217\u3092\u8a2d\u5b9a)\n    worksheet.columns = headers.map(h => ({\n      header: h.label,\n      key: h.key,\n      width: h.width || 15,\n    }));\n\n    // Style header row (\u30d8\u30c3\u30c0\u30fc\u884c\u306b\u30b9\u30bf\u30a4\u30eb\u3092\u9069\u7528)\n    worksheet.getRow(1).font = { bold: true };\n    worksheet.getRow(1).fill = {\n      type: 'pattern',\n      pattern: 'solid',\n      fgColor: { argb: 'FFE0E0E0' },\n    };\n\n    // Add data rows (\u30c7\u30fc\u30bf\u884c\u3092\u8ffd\u52a0)\n    data.forEach(row => {\n      const rowData: Record<string, any> = {};\n      headers.forEach(h => {\n        rowData[h.key] = row[h.key];\n      });\n      worksheet.addRow(rowData);\n    });\n\n    // Generate buffer (\u30d0\u30c3\u30d5\u30a1\u3092\u751f\u6210)\n    const buffer = await workbook.xlsx.writeBuffer();\n\n    // Upload to S3 (S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9)\n    const bucket = this.s3Service.privateBucket;\n    const key = `exports/${Date.now()}/${filename}`;\n\n    await this.s3Service.client.send(new PutObjectCommand({\n      Bucket: bucket,\n      Key: key,\n      Body: buffer as Buffer,\n      ContentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n    }));\n\n    this.logger.log(`Exported ${data.length} rows to ${key}`);\n    return { bucket, key };\n  }\n\n  private escapeCsvValue(value: any): string {\n    if (value === null || value === undefined) return '';\n\n    const str = String(value);\n    if (str.includes(',') || str.includes('\"') || str.includes('\\n')) {\n      return `\"${str.replace(/\"/g, '\"\"')}\"`;\n    }\n    return str;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-functions\u7d71\u5408",children:"Step Functions\u7d71\u5408"}),"\n",(0,s.jsx)(n.h3,{id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3",children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Import workflow with Step Functions (Step Functions\u306b\u3088\u308b\u30a4\u30f3\u30dd\u30fc\u30c8\u30ef\u30fc\u30af\u30d5\u30ed\u30fc)\n\n// serverless.yml\n/*\nstepFunctions:\n  stateMachines:\n    csvImport:\n      name: ${self:custom.prefix}-csv-import\n      definition:\n        StartAt: ParseFile\n        States:\n          ParseFile:\n            Type: Task\n            Resource: !GetAtt ParseFileLambda.Arn\n            Next: ProcessBatches\n            Catch:\n              - ErrorEquals: ["States.ALL"]\n                Next: HandleError\n\n          ProcessBatches:\n            Type: Map\n            ItemsPath: $.batches\n            MaxConcurrency: 5\n            Iterator:\n              StartAt: ProcessBatch\n              States:\n                ProcessBatch:\n                  Type: Task\n                  Resource: !GetAtt ProcessBatchLambda.Arn\n                  End: true\n            Next: Finalize\n\n          Finalize:\n            Type: Task\n            Resource: !GetAtt FinalizeLambda.Arn\n            End: true\n\n          HandleError:\n            Type: Task\n            Resource: !GetAtt HandleErrorLambda.Arn\n            End: true\n*/\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9",children:"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u30d0\u30c3\u30c1\u51e6\u7406",children:"1. \u30d0\u30c3\u30c1\u51e6\u7406"}),"\n",(0,s.jsx)(n.p,{children:"\u5927\u304d\u306a\u30d5\u30a1\u30a4\u30eb\u306f\u5e38\u306b\u30d0\u30c3\u30c1\u3067\u51e6\u7406\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const BATCH_SIZE = 30;\n\nasync processBatches<T>(\n  items: T[],\n  processor: (item: T) => Promise<void>,\n): Promise<void> {\n  for (let i = 0; i < items.length; i += BATCH_SIZE) {\n    const batch = items.slice(i, i + BATCH_SIZE);\n    await Promise.all(batch.map(processor));\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0",children:"2. \u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0"}),"\n",(0,s.jsx)(n.p,{children:"\u51e6\u7406\u3092\u505c\u6b62\u305b\u305a\u306b\u30a8\u30e9\u30fc\u3092\u53ce\u96c6\u3057\u5831\u544a\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const errors: Array<{ row: number; error: string }> = [];\n\nfor (const [index, row] of rows.entries()) {\n  try {\n    await processRow(row);\n  } catch (error) {\n    errors.push({ row: index + 1, error: error.message });\n    // Continue processing (\u51e6\u7406\u3092\u7d99\u7d9a)\n  }\n}\n\nif (errors.length > 0) {\n  await this.reportErrors(errors);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u51e6\u7406\u524d\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3",children:"3. \u51e6\u7406\u524d\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3"}),"\n",(0,s.jsx)(n.p,{children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u3092\u958b\u59cb\u3059\u308b\u524d\u306b\u3059\u3079\u3066\u306e\u30c7\u30fc\u30bf\u3092\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// First pass: validate (\u6700\u521d\u306e\u30d1\u30b9\uff1a\u30d0\u30ea\u30c7\u30fc\u30c8)\nconst validationErrors = await this.validateAll(rows);\nif (validationErrors.length > 0) {\n  return { success: false, errors: validationErrors };\n}\n\n// Second pass: process (2\u756a\u76ee\u306e\u30d1\u30b9\uff1a\u51e6\u7406)\nawait this.processAll(rows);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-\u9032\u6357\u5831\u544a",children:"4. \u9032\u6357\u5831\u544a"}),"\n",(0,s.jsx)(n.p,{children:"\u9577\u6642\u9593\u5b9f\u884c\u3055\u308c\u308b\u30a4\u30f3\u30dd\u30fc\u30c8\u306e\u9032\u6357\u3092\u5831\u544a\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const total = rows.length;\nlet processed = 0;\n\nfor (const batch of batches) {\n  await processBatch(batch);\n  processed += batch.length;\n\n  // Report progress every 100 rows (100\u884c\u3054\u3068\u306b\u9032\u6357\u3092\u5831\u544a)\n  if (processed % 100 === 0) {\n    this.logger.log(`Progress: ${processed}/${total} (${Math.round(processed/total*100)}%)`);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"importmodule-api\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9",children:"ImportModule API\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"@mbc-cqrs-serverless/import"}),"\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3001\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u30bf\u30b9\u30af\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u5305\u62ec\u7684\u306a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb",children:"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install @mbc-cqrs-serverless/import\n"})}),"\n",(0,s.jsx)(n.h3,{id:"processingmode-enum",children:"ProcessingMode\u5217\u6319\u578b"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ProcessingMode"}),"\u5217\u6319\u578b\u306f\u3001\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u306e\u5b9f\u884c\u65b9\u6cd5\u3092\u5b9a\u7fa9\u3057\u307e\u3059\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export enum ProcessingMode {\n  DIRECT = 'DIRECT',           // Direct processing without Step Functions (Step Functions\u3092\u4f7f\u7528\u3057\u306a\u3044\u76f4\u63a5\u51e6\u7406)\n  STEP_FUNCTION = 'STEP_FUNCTION', // Processing orchestrated by Step Functions (Step Functions\u306b\u3088\u308b\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u51e6\u7406)\n}\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30e2\u30fc\u30c9"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"}),(0,s.jsx)(n.th,{children:"\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DIRECT"})}),(0,s.jsx)(n.td,{children:"Step Functions\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u305b\u305a\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3092\u76f4\u63a5\u51e6\u7406"}),(0,s.jsx)(n.td,{children:"\u5c0f\u898f\u6a21\u30a4\u30f3\u30dd\u30fc\u30c8\u3001\u30b7\u30f3\u30d7\u30eb\u306a\u30c7\u30fc\u30bf"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"STEP_FUNCTION"})}),(0,s.jsx)(n.td,{children:"\u4fe1\u983c\u6027\u306e\u305f\u3081\u306bStep Functions\u3067\u30a4\u30f3\u30dd\u30fc\u30c8\u3092\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3"}),(0,s.jsx)(n.td,{children:"\u5927\u898f\u6a21\u30a4\u30f3\u30dd\u30fc\u30c8\u3001\u8907\u96d1\u306a\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3001ZIP\u30a4\u30f3\u30dd\u30fc\u30c8"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"createcsvimportdto",children:"CreateCsvImportDto"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"CreateCsvImportDto"}),"\u306fCSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u3092\u958b\u59cb\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { IsEnum, IsNotEmpty, IsOptional, IsString } from 'class-validator'\nimport { ProcessingMode } from '@mbc-cqrs-serverless/import'\n\nexport class CreateCsvImportDto {\n  @IsString()\n  @IsOptional()\n  sourceId?: string           // Optional source identifier (\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u30bd\u30fc\u30b9\u8b58\u5225\u5b50)\n\n  @IsNotEmpty()\n  @IsEnum(ProcessingMode)\n  processingMode: ProcessingMode // How the import should be processed (\u30a4\u30f3\u30dd\u30fc\u30c8\u306e\u51e6\u7406\u65b9\u6cd5)\n\n  @IsString()\n  @IsNotEmpty()\n  bucket: string              // S3 bucket containing the CSV file (CSV\u30d5\u30a1\u30a4\u30eb\u3092\u542b\u3080S3\u30d0\u30b1\u30c3\u30c8)\n\n  @IsString()\n  @IsNotEmpty()\n  key: string                 // S3 key (path) to the CSV file (CSV\u30d5\u30a1\u30a4\u30eb\u3078\u306eS3\u30ad\u30fc\uff08\u30d1\u30b9\uff09)\n\n  @IsString()\n  @IsNotEmpty()\n  tableName: string           // Target table name for import profile matching (\u30a4\u30f3\u30dd\u30fc\u30c8\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u30de\u30c3\u30c1\u30f3\u30b0\u7528\u306e\u30bf\u30fc\u30b2\u30c3\u30c8\u30c6\u30fc\u30d6\u30eb\u540d)\n\n  @IsString()\n  @IsNotEmpty()\n  tenantCode: string          // Tenant code for multi-tenancy (\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30b7\u30fc\u7528\u306e\u30c6\u30ca\u30f3\u30c8\u30b3\u30fc\u30c9)\n}\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30d7\u30ed\u30d1\u30c6\u30a3"}),(0,s.jsx)(n.th,{children:"\u578b"}),(0,s.jsx)(n.th,{children:"\u5fc5\u9808"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sourceId"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"\u3044\u3044\u3048"}),(0,s.jsx)(n.td,{children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30bd\u30fc\u30b9\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u8b58\u5225\u5b50"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"processingMode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ProcessingMode"})}),(0,s.jsx)(n.td,{children:"\u306f\u3044"}),(0,s.jsx)(n.td,{children:"DIRECT\u307e\u305f\u306fSTEP_FUNCTION\u30e2\u30fc\u30c9"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bucket"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"\u306f\u3044"}),(0,s.jsx)(n.td,{children:"S3 bucket containing the CSV file (CSV\u30d5\u30a1\u30a4\u30eb\u3092\u542b\u3080S3\u30d0\u30b1\u30c3\u30c8)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"key"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"\u306f\u3044"}),(0,s.jsx)(n.td,{children:"S3 key (path) to the CSV file (CSV\u30d5\u30a1\u30a4\u30eb\u3078\u306eS3\u30ad\u30fc\uff08\u30d1\u30b9\uff09)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tableName"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"\u306f\u3044"}),(0,s.jsx)(n.td,{children:"\u30bf\u30fc\u30b2\u30c3\u30c8\u30c6\u30fc\u30d6\u30eb\u540d\u3001\u30a4\u30f3\u30dd\u30fc\u30c8\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u4f7f\u7528"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tenantCode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"\u306f\u3044"}),(0,s.jsx)(n.td,{children:"Tenant code for multi-tenancy (\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30b7\u30fc\u7528\u306e\u30c6\u30ca\u30f3\u30c8\u30b3\u30fc\u30c9)"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"createzipimportdto",children:"CreateZipImportDto"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"CreateZipImportDto"}),"\u306f\u8907\u6570\u306eCSV\u30d5\u30a1\u30a4\u30eb\u3092\u542b\u3080ZIP\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u3092\u958b\u59cb\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { IsArray, IsNotEmpty, IsOptional, IsString } from 'class-validator'\n\nexport class CreateZipImportDto {\n  @IsString()\n  @IsNotEmpty()\n  bucket: string              // S3 bucket containing the ZIP file (ZIP\u30d5\u30a1\u30a4\u30eb\u3092\u542b\u3080S3\u30d0\u30b1\u30c3\u30c8)\n\n  @IsString()\n  @IsNotEmpty()\n  key: string                 // S3 key (path) to the ZIP file (ZIP\u30d5\u30a1\u30a4\u30eb\u3078\u306eS3\u30ad\u30fc\uff08\u30d1\u30b9\uff09)\n\n  @IsString()\n  @IsNotEmpty()\n  tenantCode: string          // Tenant code for multi-tenancy (\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30b7\u30fc\u7528\u306e\u30c6\u30ca\u30f3\u30c8\u30b3\u30fc\u30c9)\n\n  // High priority: sortedFileKeys (\u9ad8\u512a\u5148\u5ea6: sortedFileKeys)\n  // If not provided, it will use the default sorting logic (\u6307\u5b9a\u3055\u308c\u306a\u3044\u5834\u5408\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30bd\u30fc\u30c8\u30ed\u30b8\u30c3\u30af\u3092\u4f7f\u7528)\n  @IsArray()\n  @IsOptional()\n  sortedFileKeys?: string[]   // Optional ordered list of file keys to process (\u51e6\u7406\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30ad\u30fc\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u9806\u5e8f\u4ed8\u304d\u30ea\u30b9\u30c8)\n\n  // High priority: tableName (\u9ad8\u512a\u5148\u5ea6: tableName)\n  // If not provided, it will be extracted from the filename (\u6307\u5b9a\u3055\u308c\u306a\u3044\u5834\u5408\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u304b\u3089\u62bd\u51fa)\n  @IsString()\n  @IsOptional()\n  tableName?: string = null   // Optional table name override (\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u30c6\u30fc\u30d6\u30eb\u540d\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9)\n}\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30d7\u30ed\u30d1\u30c6\u30a3"}),(0,s.jsx)(n.th,{children:"\u578b"}),(0,s.jsx)(n.th,{children:"\u5fc5\u9808"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bucket"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"\u306f\u3044"}),(0,s.jsx)(n.td,{children:"S3 bucket containing the ZIP file (ZIP\u30d5\u30a1\u30a4\u30eb\u3092\u542b\u3080S3\u30d0\u30b1\u30c3\u30c8)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"key"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"\u306f\u3044"}),(0,s.jsx)(n.td,{children:"S3 key (path) to the ZIP file (ZIP\u30d5\u30a1\u30a4\u30eb\u3078\u306eS3\u30ad\u30fc\uff08\u30d1\u30b9\uff09)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tenantCode"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"\u306f\u3044"}),(0,s.jsx)(n.td,{children:"Tenant code for multi-tenancy (\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30b7\u30fc\u7528\u306e\u30c6\u30ca\u30f3\u30c8\u30b3\u30fc\u30c9)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sortedFileKeys"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string[]"})}),(0,s.jsx)(n.td,{children:"\u3044\u3044\u3048"}),(0,s.jsx)(n.td,{children:"\u51e6\u7406\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30ad\u30fc\u306e\u9806\u5e8f\u4ed8\u304d\u30ea\u30b9\u30c8\u3002\u6307\u5b9a\u3055\u308c\u306a\u3044\u5834\u5408\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30bd\u30fc\u30c8\u304c\u4f7f\u7528\u3055\u308c\u308b"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tableName"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"\u3044\u3044\u3048"}),(0,s.jsx)(n.td,{children:"\u30c6\u30fc\u30d6\u30eb\u540d\u306e\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3002\u6307\u5b9a\u3055\u308c\u306a\u3044\u5834\u5408\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u304b\u3089\u62bd\u51fa\uff08\u5f62\u5f0f: yyyymmddhhMMss-{tableName}.csv\uff09"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"\u30b3\u30a2\u30b3\u30f3\u30bb\u30d7\u30c8",children:"\u30b3\u30a2\u30b3\u30f3\u30bb\u30d7\u30c8"}),"\n",(0,s.jsx)(n.p,{children:"\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306f2\u30d5\u30a7\u30fc\u30ba\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u52d5\u4f5c\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30d5\u30a7\u30fc\u30ba"}),"\uff08",(0,s.jsx)(n.code,{children:"IImportStrategy"}),"\uff09\uff1a\u751f\u30c7\u30fc\u30bf\uff08JSON\u307e\u305f\u306fCSV\uff09\u3092\u6a19\u6e96\u5316\u3055\u308c\u305fDTO\u306b\u5909\u63db\u3057\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3044\u307e\u3059\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u51e6\u7406\u30d5\u30a7\u30fc\u30ba"}),"\uff08",(0,s.jsx)(n.code,{children:"IProcessStrategy"}),"\uff09\uff1a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u6e08\u307fDTO\u3092\u65e2\u5b58\u30c7\u30fc\u30bf\u3068\u6bd4\u8f03\u3057\u3001\u4f5c\u6210\u307e\u305f\u306f\u66f4\u65b0\u7528\u306e\u30b3\u30de\u30f3\u30c9\u30da\u30a4\u30ed\u30fc\u30c9\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u307e\u3059\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u5b9f\u88c5",children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u5b9f\u88c5"}),"\n",(0,s.jsx)(n.p,{children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306f\u521d\u671f\u5909\u63db\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u51e6\u7406\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { BadRequestException, Injectable } from '@nestjs/common';\nimport { plainToInstance } from 'class-transformer';\nimport { BaseImportStrategy, IImportStrategy } from '@mbc-cqrs-serverless/import';\nimport { PolicyCommandDto } from '../dto/policy-command.dto';\n\n@Injectable()\nexport class PolicyImportStrategy\n  extends BaseImportStrategy<Record<string, any>, PolicyCommandDto>\n  implements IImportStrategy<Record<string, any>, PolicyCommandDto>\n{\n  async transform(input: Record<string, any>): Promise<PolicyCommandDto> {\n    const attrSource = input.attributes && typeof input.attributes === 'object'\n      ? input.attributes\n      : input;\n\n    const mappedObject = {\n      pk: input.pk,\n      sk: input.sk,\n      attributes: {\n        policyType: attrSource.policyType,\n        applyDate: new Date(attrSource.applyDate).toISOString(),\n      },\n    };\n\n    return plainToInstance(PolicyCommandDto, mappedObject);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"comparisonstatus-enum",children:"ComparisonStatus\u5217\u6319\u578b"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ComparisonStatus"}),"\u5217\u6319\u578b\u306f\u3001\u30a4\u30f3\u30dd\u30fc\u30c8\u30c7\u30fc\u30bf\u3068\u65e2\u5b58\u30c7\u30fc\u30bf\u306e\u6bd4\u8f03\u7d50\u679c\u3092\u5b9a\u7fa9\u3057\u307e\u3059\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export enum ComparisonStatus {\n  EQUAL = 'EQUAL',         // Data exists and is identical - no action needed (\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3057\u540c\u4e00 - \u30a2\u30af\u30b7\u30e7\u30f3\u4e0d\u8981)\n  NOT_EXIST = 'NOT_EXIST', // Data does not exist - create new record (\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3057\u306a\u3044 - \u65b0\u898f\u30ec\u30b3\u30fc\u30c9\u4f5c\u6210)\n  CHANGED = 'CHANGED',     // Data exists but differs - update existing record (\u30c7\u30fc\u30bf\u306f\u5b58\u5728\u3059\u308b\u304c\u7570\u306a\u308b - \u65e2\u5b58\u30ec\u30b3\u30fc\u30c9\u66f4\u65b0)\n}\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u5024"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"}),(0,s.jsx)(n.th,{children:"\u30a2\u30af\u30b7\u30e7\u30f3"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EQUAL"})}),(0,s.jsx)(n.td,{children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30c7\u30fc\u30bf\u304c\u65e2\u5b58\u30c7\u30fc\u30bf\u3068\u4e00\u81f4"}),(0,s.jsx)(n.td,{children:"\u30b9\u30ad\u30c3\u30d7\uff08\u64cd\u4f5c\u306a\u3057\uff09"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"NOT_EXIST"})}),(0,s.jsx)(n.td,{children:"\u65e2\u5b58\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u3089\u306a\u3044"}),(0,s.jsx)(n.td,{children:"\u65b0\u898f\u30ec\u30b3\u30fc\u30c9\u4f5c\u6210"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"CHANGED"})}),(0,s.jsx)(n.td,{children:"\u65e2\u5b58\u30c7\u30fc\u30bf\u304c\u30a4\u30f3\u30dd\u30fc\u30c8\u30c7\u30fc\u30bf\u3068\u7570\u306a\u308b"}),(0,s.jsx)(n.td,{children:"\u65e2\u5b58\u30ec\u30b3\u30fc\u30c9\u66f4\u65b0"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"comparisonresult-interface",children:"ComparisonResult\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ComparisonResult<TEntity>"}),"\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306f\u3001\u6bd4\u8f03\u30b9\u30c6\u30fc\u30bf\u30b9\u3068\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u65e2\u5b58\u30c7\u30fc\u30bf\u3092\u30e9\u30c3\u30d7\u3057\u307e\u3059\u3002\u30b8\u30a7\u30cd\u30ea\u30c3\u30af\u578b",(0,s.jsx)(n.code,{children:"TEntity"}),"\u306f",(0,s.jsx)(n.code,{children:"DataModel"}),"\u3092\u62e1\u5f35\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { DataModel } from '@mbc-cqrs-serverless/core'\n\nexport interface ComparisonResult<TEntity extends DataModel> {\n  status: ComparisonStatus;  // The result of the comparison (\u6bd4\u8f03\u7d50\u679c)\n  /**\n   * If the status is 'CHANGED', this property holds the existing entity data (\u30b9\u30c6\u30fc\u30bf\u30b9\u304c'CHANGED'\u306e\u5834\u5408\u3001\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u65e2\u5b58\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30c7\u30fc\u30bf\u3092\u4fdd\u6301)\n   * retrieved from the database. It is undefined otherwise. (\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u53d6\u5f97\u3002\u305d\u308c\u4ee5\u5916\u306e\u5834\u5408\u306fundefined)\n   */\n  existingData?: TEntity;\n}\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30d7\u30ed\u30d1\u30c6\u30a3"}),(0,s.jsx)(n.th,{children:"\u578b"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"status"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ComparisonStatus"})}),(0,s.jsx)(n.td,{children:"\u6bd4\u8f03\u7d50\u679c\u30b9\u30c6\u30fc\u30bf\u30b9"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"existingData"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TEntity | undefined"})}),(0,s.jsx)(n.td,{children:"\u65e2\u5b58\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30c7\u30fc\u30bf\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u304cCHANGED\u306e\u5834\u5408\u306b\u5b58\u5728"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"iprocessstrategy-interface",children:"IProcessStrategy\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"IProcessStrategy"}),"\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306f\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u6e08\u307f\u30a4\u30f3\u30dd\u30fc\u30c8\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u5951\u7d04\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\u30b8\u30a7\u30cd\u30ea\u30c3\u30af\u578b",(0,s.jsx)(n.code,{children:"TEntity"}),"\u306f",(0,s.jsx)(n.code,{children:"DataModel"}),"\u3092\u62e1\u5f35\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {\n  CommandInputModel,\n  CommandPartialInputModel,\n  CommandService,\n  DataModel,\n} from '@mbc-cqrs-serverless/core';\n\nexport interface IProcessStrategy<TEntity extends DataModel, TAttributesDto extends object> {\n  /**\n   * Compare the validated DTO with existing data (\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u6e08\u307fDTO\u3092\u65e2\u5b58\u30c7\u30fc\u30bf\u3068\u6bd4\u8f03)\n   */\n  compare(\n    importAttributes: TAttributesDto,\n    tenantCode: string,\n  ): Promise<ComparisonResult<TEntity>>;\n\n  /**\n   * Map the DTO to a command payload based on comparison status (\u6bd4\u8f03\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u57fa\u3065\u3044\u3066DTO\u3092\u30b3\u30de\u30f3\u30c9\u30da\u30a4\u30ed\u30fc\u30c9\u306b\u30de\u30c3\u30d4\u30f3\u30b0)\n   * Note: status excludes EQUAL since no mapping is needed for identical data (\u6ce8\u610f: \u540c\u4e00\u30c7\u30fc\u30bf\u3067\u306f\u30de\u30c3\u30d4\u30f3\u30b0\u4e0d\u8981\u306e\u305f\u3081status\u306fEQUAL\u3092\u9664\u5916)\n   * @returns CommandInputModel for create, CommandPartialInputModel for update (\u4f5c\u6210\u7528CommandInputModel\u3001\u66f4\u65b0\u7528CommandPartialInputModel)\n   */\n  map(\n    status: Exclude<ComparisonStatus, ComparisonStatus.EQUAL>,\n    importAttributes: TAttributesDto,\n    tenantCode: string,\n    existingData?: TEntity,\n  ): Promise<CommandInputModel | CommandPartialInputModel>;\n\n  /**\n   * Get the command service for publishing commands (\u30b3\u30de\u30f3\u30c9\u767a\u884c\u7528\u306e\u30b3\u30de\u30f3\u30c9\u30b5\u30fc\u30d3\u30b9\u3092\u53d6\u5f97)\n   */\n  getCommandService(): CommandService;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"baseprocessstrategy-class",children:"BaseProcessStrategy\u62bd\u8c61\u30af\u30e9\u30b9"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"BaseProcessStrategy"}),"\u62bd\u8c61\u30af\u30e9\u30b9\u306f\u3001\u30b5\u30d6\u30af\u30e9\u30b9\u304c\u62e1\u5f35\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u57fa\u672c\u5b9f\u88c5\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u30b8\u30a7\u30cd\u30ea\u30c3\u30af\u578b",(0,s.jsx)(n.code,{children:"TEntity"}),"\u306f",(0,s.jsx)(n.code,{children:"DataModel"}),"\u3092\u62e1\u5f35\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { DataModel } from '@mbc-cqrs-serverless/core';\n\nexport abstract class BaseProcessStrategy<TEntity extends DataModel, TTransformedDto extends object>\n  implements IProcessStrategy<TEntity, TTransformedDto>\n{\n  /**\n   * Abstract method - must be implemented to compare data (\u62bd\u8c61\u30e1\u30bd\u30c3\u30c9 - \u30c7\u30fc\u30bf\u6bd4\u8f03\u306e\u305f\u3081\u306b\u5b9f\u88c5\u304c\u5fc5\u8981)\n   */\n  abstract compare(\n    transformedData: TTransformedDto,\n    tenantCode: string,\n  ): Promise<ComparisonResult<TEntity>>;\n\n  /**\n   * Abstract method - must be implemented to map data to command payload (\u62bd\u8c61\u30e1\u30bd\u30c3\u30c9 - \u30c7\u30fc\u30bf\u3092\u30b3\u30de\u30f3\u30c9\u30da\u30a4\u30ed\u30fc\u30c9\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u305f\u3081\u306b\u5b9f\u88c5\u304c\u5fc5\u8981)\n   * Note: status excludes EQUAL since no mapping is needed for identical data (\u6ce8\u610f: \u540c\u4e00\u30c7\u30fc\u30bf\u3067\u306f\u30de\u30c3\u30d4\u30f3\u30b0\u4e0d\u8981\u306e\u305f\u3081status\u306fEQUAL\u3092\u9664\u5916)\n   */\n  abstract map(\n    status: Exclude<ComparisonStatus, ComparisonStatus.EQUAL>,\n    transformedData: TTransformedDto,\n    tenantCode: string,\n    existingData?: TEntity,\n  ): Promise<CommandInputModel | CommandPartialInputModel>;\n\n  /**\n   * Abstract method - must be implemented to return the command service (\u62bd\u8c61\u30e1\u30bd\u30c3\u30c9 - \u30b3\u30de\u30f3\u30c9\u30b5\u30fc\u30d3\u30b9\u3092\u8fd4\u3059\u305f\u3081\u306b\u5b9f\u88c5\u304c\u5fc5\u8981)\n   */\n  abstract getCommandService(): CommandService;\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"\u6ce8\u610f",type:"info",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"BaseProcessStrategy"}),"\u306e3\u3064\u306e\u30e1\u30bd\u30c3\u30c9\uff08",(0,s.jsx)(n.code,{children:"compare()"}),"\u3001",(0,s.jsx)(n.code,{children:"map()"}),"\u3001",(0,s.jsx)(n.code,{children:"getCommandService()"}),"\uff09\u306f\u3059\u3079\u3066\u62bd\u8c61\u30e1\u30bd\u30c3\u30c9\u3067\u3042\u308a\u3001\u30b5\u30d6\u30af\u30e9\u30b9\u3067\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"]})}),"\n",(0,s.jsx)(n.h3,{id:"\u30d7\u30ed\u30bb\u30b9\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u5b9f\u88c5",children:"\u30d7\u30ed\u30bb\u30b9\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u5b9f\u88c5"}),"\n",(0,s.jsx)(n.p,{children:"\u30d7\u30ed\u30bb\u30b9\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306f\u30c7\u30fc\u30bf\u306e\u6bd4\u8f03\u3068\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u30b3\u30a2\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u542b\u307f\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@nestjs/common';\nimport {\n  CommandInputModel,\n  CommandPartialInputModel,\n  CommandService,\n  DataService,\n} from '@mbc-cqrs-serverless/core';\nimport {\n  BaseProcessStrategy,\n  ComparisonResult,\n  ComparisonStatus,\n  IProcessStrategy,\n} from '@mbc-cqrs-serverless/import';\nimport { PolicyCommandDto } from '../dto/policy-command.dto';\nimport { PolicyDataEntity } from '../entity/policy-data.entity';\n\n@Injectable()\nexport class PolicyProcessStrategy\n  extends BaseProcessStrategy<PolicyDataEntity, PolicyCommandDto>\n  implements IProcessStrategy<PolicyDataEntity, PolicyCommandDto>\n{\n  constructor(\n    private readonly commandService: CommandService,\n    private readonly dataService: DataService,\n  ) {\n    super();\n  }\n\n  getCommandService(): CommandService {\n    return this.commandService;\n  }\n\n  async compare(\n    dto: PolicyCommandDto,\n    tenantCode: string,\n  ): Promise<ComparisonResult<PolicyDataEntity>> {\n    const existing = await this.dataService.getItem({ pk: dto.pk, sk: dto.sk });\n    if (!existing) return { status: ComparisonStatus.NOT_EXIST };\n    return { status: ComparisonStatus.EQUAL, existingData: existing as PolicyDataEntity };\n  }\n\n  async map(\n    status: Exclude<ComparisonStatus, ComparisonStatus.EQUAL>,\n    dto: PolicyCommandDto,\n    tenantCode: string,\n    existingData?: PolicyDataEntity,\n  ): Promise<CommandInputModel | CommandPartialInputModel> {\n    if (status === ComparisonStatus.NOT_EXIST) {\n      // Return CommandInputModel for creating new records (\u65b0\u898f\u30ec\u30b3\u30fc\u30c9\u4f5c\u6210\u7528\u306bCommandInputModel\u3092\u8fd4\u3059)\n      return { ...dto, version: 0 } as CommandInputModel;\n    }\n    // status === ComparisonStatus.CHANGED (\u30b9\u30c6\u30fc\u30bf\u30b9\u304cCHANGED\u306e\u5834\u5408)\n    // Return CommandPartialInputModel for updating existing records (\u65e2\u5b58\u30ec\u30b3\u30fc\u30c9\u66f4\u65b0\u7528\u306bCommandPartialInputModel\u3092\u8fd4\u3059)\n    return {\n      pk: dto.pk,\n      sk: dto.sk,\n      attributes: dto.attributes,\n      version: existingData.version,\n    } as CommandPartialInputModel;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a",children:"\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a"}),"\n",(0,s.jsx)(n.p,{children:"\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u7528\u3057\u3066ImportModule\u3092\u767b\u9332\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { ImportModule } from '@mbc-cqrs-serverless/import';\nimport { PolicyModule } from './policy/policy.module';\nimport { PolicyImportStrategy } from './policy/strategies/policy.import-strategy';\nimport { PolicyProcessStrategy } from './policy/strategies/policy.process-strategy';\n\n@Module({\n  imports: [\n    PolicyModule,\n    ImportModule.register({\n      enableController: true,\n      imports: [PolicyModule],\n      profiles: [\n        {\n          tableName: 'policy',\n          importStrategy: PolicyImportStrategy,\n          processStrategy: PolicyProcessStrategy,\n        },\n      ],\n    }),\n  ],\n})\nexport class AppModule {}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u30a4\u30f3\u30dd\u30fc\u30c8\u7528\u30ab\u30b9\u30bf\u30e0\u30a4\u30d9\u30f3\u30c8\u30d5\u30a1\u30af\u30c8\u30ea\u30fc",children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u7528\u30ab\u30b9\u30bf\u30e0\u30a4\u30d9\u30f3\u30c8\u30d5\u30a1\u30af\u30c8\u30ea\u30fc"}),"\n",(0,s.jsx)(n.p,{children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30a4\u30d9\u30f3\u30c8\u3092\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u30a4\u30d9\u30f3\u30c8\u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u3092\u8a2d\u5b9a\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {\n  EventFactory,\n  IEvent,\n  StepFunctionsEvent,\n} from '@mbc-cqrs-serverless/core';\nimport {\n  CsvImportSfnEvent,\n  DEFAULT_IMPORT_ACTION_QUEUE,\n  ImportEvent,\n  ImportQueueEvent,\n} from '@mbc-cqrs-serverless/import';\nimport { DynamoDBStreamEvent, SQSEvent } from 'aws-lambda';\n\n@EventFactory()\nexport class CustomEventFactory extends EventFactoryAddedTask {\n  async transformDynamodbStream(event: DynamoDBStreamEvent): Promise<IEvent[]> {\n    const curEvents = await super.transformDynamodbStream(event);\n\n    const importEvents = event.Records.map((record) => {\n      if (\n        record.eventSourceARN.endsWith('import_tmp') ||\n        record.eventSourceARN.includes('import_tmp/stream/')\n      ) {\n        if (record.eventName === 'INSERT') {\n          return new ImportEvent().fromDynamoDBRecord(record);\n        }\n      }\n      return undefined;\n    }).filter((event) => !!event);\n\n    return [...curEvents, ...importEvents];\n  }\n\n  async transformSqs(event: SQSEvent): Promise<IEvent[]> {\n    const curEvents = await super.transformSqs(event);\n\n    const importEvents = event.Records.map((record) => {\n      if (record.eventSourceARN.endsWith(DEFAULT_IMPORT_ACTION_QUEUE)) {\n        return new ImportQueueEvent().fromSqsRecord(record);\n      }\n      return undefined;\n    }).filter((event) => !!event);\n\n    return [...importEvents, ...curEvents];\n  }\n\n  async transformStepFunction(event: StepFunctionsEvent<any>): Promise<IEvent[]> {\n    if (event.context.StateMachine.Name.includes('import-csv')) {\n      return [new CsvImportSfnEvent(event)];\n    }\n    return super.transformStepFunction(event);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"importstatushandler-api",children:"ImportStatusHandler API"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ImportStatusHandler"}),"\u306f\u3001\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u306eStep Functions\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u7ba1\u7406\u3059\u308b\u5185\u90e8\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc\u3067\u3059\u3002Step Functions\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\uff08ZIP\u30a4\u30f3\u30dd\u30fc\u30c8\u307e\u305f\u306fSTEP_FUNCTION\u30e2\u30fc\u30c9\u306eCSV\u30a4\u30f3\u30dd\u30fc\u30c8\uff09\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001\u3053\u306e\u30cf\u30f3\u30c9\u30e9\u30fc\u306f\u30b9\u30c6\u30fc\u30c8\u30de\u30b7\u30f3\u3068\u306e\u9069\u5207\u306a\u901a\u4fe1\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002"]}),"\n",(0,s.jsx)(n.h4,{id:"\u52d5\u4f5c",children:"\u52d5\u4f5c"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,s.jsx)(n.th,{children:"\u30a2\u30af\u30b7\u30e7\u30f3"}),(0,s.jsx)(n.th,{children:"Step Functions\u30b3\u30de\u30f3\u30c9"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"COMPLETED"})}),(0,s.jsx)(n.td,{children:"\u6210\u529f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u9001\u4fe1"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SendTaskSuccessCommand"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FAILED"})}),(0,s.jsx)(n.td,{children:"\u5931\u6557\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u9001\u4fe1"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SendTaskFailureCommand"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u305d\u306e\u4ed6\u306e\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,s.jsx)(n.td,{children:"\u7121\u8996"}),(0,s.jsx)(n.td,{children:"\u306a\u3057"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u30e1\u30bd\u30c3\u30c9",children:"\u30e1\u30bd\u30c3\u30c9"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30e1\u30bd\u30c3\u30c9"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sendTaskSuccess(taskToken, output)"})}),(0,s.jsx)(n.td,{children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u7d50\u679c\u3068\u3068\u3082\u306bStep Functions\u306b\u6210\u529f\u30b7\u30b0\u30ca\u30eb\u3092\u9001\u4fe1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sendTaskFailure(taskToken, error, cause)"})}),(0,s.jsx)(n.td,{children:"\u30a8\u30e9\u30fc\u8a73\u7d30\u3068\u3068\u3082\u306bStep Functions\u306b\u5931\u6557\u30b7\u30b0\u30ca\u30eb\u3092\u9001\u4fe1"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"step-functions\u7d71\u5408-1",children:"Step Functions\u7d71\u5408"}),"\n",(0,s.jsxs)(n.p,{children:["Step Functions\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\uff08\u4f8b\uff1aZIP\u30a4\u30f3\u30dd\u30fc\u30c8\uff09\u306e\u4e00\u90e8\u3068\u3057\u3066\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u304c\u4f5c\u6210\u3055\u308c\u308b\u3068\u3001",(0,s.jsx)(n.code,{children:"taskToken"}),"\u304c\u30b8\u30e7\u30d6\u306e\u5c5e\u6027\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002",(0,s.jsx)(n.code,{children:"ImportStatusHandler"}),"\u306f\u30b9\u30c6\u30fc\u30bf\u30b9\u5909\u66f4\u901a\u77e5\u3092\u30ea\u30c3\u30b9\u30f3\u3057\u3001\u4ee5\u4e0b\u3092\u884c\u3044\u307e\u3059\uff1a"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"DynamoDB\u304b\u3089\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u3092\u53d6\u5f97"}),"\n",(0,s.jsxs)(n.li,{children:["\u30b8\u30e7\u30d6\u306e\u5c5e\u6027\u306b",(0,s.jsx)(n.code,{children:"taskToken"}),"\u304c\u5b58\u5728\u3059\u308b\u304b\u78ba\u8a8d"]}),"\n",(0,s.jsxs)(n.li,{children:["\u6700\u7d42\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u57fa\u3065\u3044\u3066\u9069\u5207\u306a\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u9001\u4fe1\uff1a","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"COMPLETED"})," \u2192 ",(0,s.jsx)(n.code,{children:"SendTaskSuccessCommand"})," \u7d50\u679c\u30c7\u30fc\u30bf\u3068\u3068\u3082\u306b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"FAILED"})," \u2192 ",(0,s.jsx)(n.code,{children:"SendTaskFailureCommand"})," \u30a8\u30e9\u30fc\u8a73\u7d30\u3068\u3068\u3082\u306b"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u3053\u308c\u306b\u3088\u308a\u3001Step Functions\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u304c\u7121\u9650\u306b\u5f85\u6a5f\u3059\u308b\u3053\u3068\u306a\u304f\u3001\u6210\u529f\u3068\u5931\u6557\u306e\u4e21\u65b9\u306e\u30b1\u30fc\u30b9\u3092\u9069\u5207\u306b\u51e6\u7406\u3067\u304d\u307e\u3059\u3002"}),"\n",(0,s.jsx)(n.admonition,{title:"Version Note",type:"info",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"sendTaskFailure()"}),"\u30e1\u30bd\u30c3\u30c9\u306f",(0,s.jsx)(n.a,{href:"./changelog#v1018",children:"\u30d0\u30fc\u30b8\u30e7\u30f31.0.18"}),"\u3067\u8ffd\u52a0\u3055\u308c\u3001\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u304c\u5931\u6557\u3057\u305f\u969b\u306bStep Functions\u304c\u7121\u9650\u306b\u5f85\u6a5f\u3059\u308b\u554f\u984c\u3092\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u3064\u3044\u3066\u306f",(0,s.jsx)(n.a,{href:"./error-catalog#import-module-errors",children:"\u30a4\u30f3\u30dd\u30fc\u30c8\u30e2\u30b8\u30e5\u30fc\u30eb\u30a8\u30e9\u30fc"}),"\u3082\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]})}),"\n",(0,s.jsx)(n.h3,{id:"import-error-handling",children:"ImportQueueEventHandler\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ImportQueueEventHandler"}),"\u306fSQS\u30ad\u30e5\u30fc\u304b\u3089\u500b\u3005\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u30ec\u30b3\u30fc\u30c9\u3092\u51e6\u7406\u3057\u307e\u3059\u3002\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\uff08\u4f8b\uff1a",(0,s.jsx)(n.code,{children:"ConditionalCheckFailedException"}),"\uff09\u3001\u30cf\u30f3\u30c9\u30e9\u30fc\u306f\u89aa\u30b8\u30e7\u30d6\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u9069\u5207\u306b\u66f4\u65b0\u3057\u307e\u3059\u3002"]}),"\n",(0,s.jsx)(n.h4,{id:"\u30a8\u30e9\u30fc\u30d5\u30ed\u30fcv1019\u4ee5\u964d",children:"\u30a8\u30e9\u30fc\u30d5\u30ed\u30fc\uff08v1.0.19\u4ee5\u964d\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u5b50\u30b8\u30e7\u30d6\u30a8\u30e9\u30fc\u767a\u751f\n         \u2502\n         \u25bc\n\u5b50\u30b8\u30e7\u30d6\u3092FAILED\u3068\u3057\u3066\u30de\u30fc\u30af\n         \u2502\n         \u25bc\n\u89aa\u30b8\u30e7\u30d6\u30ab\u30a6\u30f3\u30bf\u30fc\u3092\u66f4\u65b0\n  (incrementParentJobCounters)\n         \u2502\n         \u25bc\n\u3059\u3079\u3066\u306e\u5b50\u30b8\u30e7\u30d6\u304c\u5b8c\u4e86\u3057\u305f\u304b\u78ba\u8a8d\n         \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n    \u2502 Yes     \u2502 No\n    \u25bc         \u25bc\n\u30de\u30b9\u30bf\u30fc\u3092\u66f4\u65b0  {{Wait for\n  Job Status}}     more children\n         \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n    \u2502 Has     \u2502 All\n    \u2502 Failures\u2502 Succeeded\n    \u25bc         \u25bc\nFAILED    COMPLETED\n         \u2502\n         \u25bc\nImportStatusHandler\u304c\u30c8\u30ea\u30ac\u30fc\n         \u2502\n         \u25bc\nSendTaskFailure/SendTaskSuccess\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9",children:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30e1\u30bd\u30c3\u30c9"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"handleImport(event)"})}),(0,s.jsx)(n.td,{children:"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3092\u542b\u3080\u5358\u4e00\u30a4\u30f3\u30dd\u30fc\u30c8\u30ec\u30b3\u30fc\u30c9\u51e6\u7406\u3092\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30c8"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"executeStrategy(...)"})}),(0,s.jsx)(n.td,{children:"\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u6bd4\u8f03\u3001\u30de\u30c3\u30d4\u30f3\u30b0\u3001\u4fdd\u5b58\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u3092\u5b9f\u884c"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306e\u52d5\u4f5c",children:"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306e\u52d5\u4f5c"}),"\n",(0,s.jsx)(n.p,{children:"\u5b50\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u304c\u5931\u6557\u3057\u305f\u5834\u5408\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5b50\u30b8\u30e7\u30d6\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u30a8\u30e9\u30fc\u8a73\u7d30\u3068\u3068\u3082\u306b",(0,s.jsx)(n.code,{children:"FAILED"}),"\u306b\u8a2d\u5b9a\u3055\u308c\u308b"]}),"\n",(0,s.jsxs)(n.li,{children:["\u89aa\u30b8\u30e7\u30d6\u306e\u30ab\u30a6\u30f3\u30bf\u30fc\u304c\u30a2\u30c8\u30df\u30c3\u30af\u306b\u66f4\u65b0\u3055\u308c\u308b\uff08",(0,s.jsx)(n.code,{children:"failedRows"}),"\u304c\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\uff09"]}),"\n",(0,s.jsxs)(n.li,{children:["\u3059\u3079\u3066\u306e\u5b50\u30b8\u30e7\u30d6\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u7d50\u679c\u306b\u57fa\u3065\u3044\u3066\u30de\u30b9\u30bf\u30fc\u30b8\u30e7\u30d6\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u308b\uff1a","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"failedRows > 0"}),"\u306e\u5834\u5408 \u2192 \u30de\u30b9\u30bf\u30fc\u30b9\u30c6\u30fc\u30bf\u30b9 = ",(0,s.jsx)(n.code,{children:"FAILED"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u3059\u3079\u3066\u6210\u529f\u3057\u305f\u5834\u5408 \u2192 \u30de\u30b9\u30bf\u30fc\u30b9\u30c6\u30fc\u30bf\u30b9 = ",(0,s.jsx)(n.code,{children:"COMPLETED"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Lambda\u306f\u30af\u30e9\u30c3\u30b7\u30e5\u3057\u306a\u3044 - \u30a8\u30e9\u30fc\u306f\u9069\u5207\u306b\u51e6\u7406\u3055\u308c\u308b"}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Common Errors",type:"warning",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ConditionalCheckFailedException"}),"\uff1a\u7af6\u5408\u3059\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u65e2\u306b\u5b58\u5728\u3059\u308b\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u3088\u3046\u3068\u3057\u305f\u5834\u5408\u306b\u767a\u751f\u3057\u307e\u3059\u3002\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u306fFAILED\u3068\u3057\u3066\u30de\u30fc\u30af\u3055\u308c\u3001\u89aa\u30b8\u30e7\u30d6\u306f\u3053\u306e\u5931\u6557\u3092\u9069\u5207\u306b\u96c6\u8a08\u3057\u307e\u3059\u3002"]})}),"\n",(0,s.jsx)(n.admonition,{title:"Version Note",type:"info",children:(0,s.jsxs)(n.p,{children:["v1.0.19\u3088\u308a\u524d\u306f\u3001\u5b50\u30b8\u30e7\u30d6\u306e\u30a8\u30e9\u30fc\u306b\u3088\u308aLambda\u304c\u30af\u30e9\u30c3\u30b7\u30e5\u3057\u3001\u30de\u30b9\u30bf\u30fc\u30b8\u30e7\u30d6\u304c",(0,s.jsx)(n.code,{children:"PROCESSING"}),"\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u307e\u307e\u7121\u9650\u306b\u6b8b\u3063\u3066\u3044\u307e\u3057\u305f\u3002",(0,s.jsx)(n.a,{href:"./changelog#v1019",children:"\u30d0\u30fc\u30b8\u30e7\u30f31.0.19"}),"\u306e\u4fee\u6b63\u306b\u3088\u308a\u3001\u9069\u5207\u306a\u30a8\u30e9\u30fc\u4f1d\u64ad\u3068\u30b9\u30c6\u30fc\u30bf\u30b9\u66f4\u65b0\u304c\u4fdd\u8a3c\u3055\u308c\u307e\u3059\u3002"]})}),"\n",(0,s.jsx)(n.h3,{id:"csvimportsfneventhandler",children:"CsvImportSfnEventHandler"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"CsvImportSfnEventHandler"}),"\u306fStep Functions\u306eCSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u30b9\u30c6\u30fc\u30c8\u3092\u51e6\u7406\u3057\u307e\u3059\u3002\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30c6\u30fc\u30c8\u30de\u30b7\u30f3\u5185\u306e",(0,s.jsx)(n.code,{children:"csv_loader"}),"\u3068",(0,s.jsx)(n.code,{children:"finalize_parent_job"}),"\u30b9\u30c6\u30fc\u30c8\u3092\u7ba1\u7406\u3057\u307e\u3059\u3002"]}),"\n",(0,s.jsx)(n.h4,{id:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9-1",children:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30e1\u30bd\u30c3\u30c9"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"handleStepState(event)"})}),(0,s.jsxs)(n.td,{children:["\u30b9\u30c6\u30fc\u30c8\u540d\uff08",(0,s.jsx)(n.code,{children:"csv_loader"}),"\u307e\u305f\u306f",(0,s.jsx)(n.code,{children:"finalize_parent_job"}),"\uff09\u306b\u57fa\u3065\u3044\u3066\u30a4\u30d9\u30f3\u30c8\u3092\u9069\u5207\u306a\u30cf\u30f3\u30c9\u30e9\u30fc\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"loadCsv(input)"})}),(0,s.jsx)(n.td,{children:"csv_loader\u30b9\u30c6\u30fc\u30c8\u3092\u51e6\u7406\u3057\u3001CSV\u884c\u306e\u5b50\u30b8\u30e7\u30d6\u3092\u4f5c\u6210\u3057\u307e\u3059"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"finalizeParentJob(event)"})}),(0,s.jsx)(n.td,{children:"\u3059\u3079\u3066\u306e\u5b50\u30b8\u30e7\u30d6\u5b8c\u4e86\u5f8c\u306b\u89aa\u30b8\u30e7\u30d6\u3092\u7d42\u4e86\u3057\u3001\u6700\u7d42\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u30b9\u30c6\u30fc\u30bf\u30b9\u5224\u5b9av1020\u4ee5\u964d",children:"\u30b9\u30c6\u30fc\u30bf\u30b9\u5224\u5b9a\uff08v1.0.20\u4ee5\u964d\uff09"}),"\n",(0,s.jsx)(n.p,{children:"\u89aa\u30b8\u30e7\u30d6\u3092\u7d42\u4e86\u3059\u308b\u969b\u3001\u30cf\u30f3\u30c9\u30e9\u30fc\u306f\u6700\u7d42\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u6b63\u3057\u304f\u5224\u5b9a\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// \u6b63\u3057\u3044\u52d5\u4f5c\uff08v1.0.20\u4ee5\u964d\uff09\nconst status = failedRows > 0\n  ? ImportJobStatus.FAILED    // \u5b50\u30b8\u30e7\u30d6\u304c\u5931\u6557\u3057\u305f\u5834\u5408 \u2192 FAILED\n  : ImportJobStatus.COMPLETED // \u3059\u3079\u3066\u306e\u5b50\u30b8\u30e7\u30d6\u304c\u6210\u529f\u3057\u305f\u5834\u5408 \u2192 COMPLETED\n"})}),"\n",(0,s.jsxs)(n.admonition,{title:"\u65e2\u77e5\u306e\u554f\u984c\uff08v1.0.20\u3067\u4fee\u6b63\uff09",type:"warning",children:[(0,s.jsxs)(n.p,{children:["v1.0.20\u3088\u308a\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3001\u4e09\u9805\u6f14\u7b97\u5b50\u306e\u30d0\u30b0\u306b\u3088\u308a\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u5e38\u306b",(0,s.jsx)(n.code,{children:"COMPLETED"}),"\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\uff1a"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// \u30d0\u30b0\uff08v1.0.20\u3088\u308a\u524d\uff09\uff1a\u5e38\u306bCOMPLETED\u3092\u8fd4\u3057\u3066\u3044\u305f\nconst status = failedRows > 0\n  ? ImportJobStatus.COMPLETED  // \u9593\u9055\u3044\uff01\n  : ImportJobStatus.COMPLETED\n"})}),(0,s.jsxs)(n.p,{children:["\u3053\u306e\u30d0\u30b0\u306b\u3088\u308a\u3001\u5b50\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u304c\u5931\u6557\u3057\u3066\u3082\u3001Step Functions\u304cSUCCESS\u3092\u5831\u544a\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u8a73\u7d30\u306f",(0,s.jsx)(n.a,{href:"./changelog#v1020",children:"\u30d0\u30fc\u30b8\u30e7\u30f31.0.20"}),"\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]})]}),"\n",(0,s.jsx)(n.h3,{id:"zipimportsfneventhandler",children:"ZipImportSfnEventHandler"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ZipImportSfnEventHandler"}),"\u306fStep Functions\u306eZIP\u30a4\u30f3\u30dd\u30fc\u30c8\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u30b9\u30c6\u30fc\u30c8\u3092\u51e6\u7406\u3057\u307e\u3059\u3002ZIP\u30a2\u30fc\u30ab\u30a4\u30d6\u304b\u3089\u62bd\u51fa\u3055\u308c\u305f\u8907\u6570\u306eCSV\u30d5\u30a1\u30a4\u30eb\u306e\u51e6\u7406\u3092\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u307e\u3059\u3002"]}),"\n",(0,s.jsx)(n.h4,{id:"\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u30b9\u30c6\u30fc\u30c8",children:"\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u30b9\u30c6\u30fc\u30c8"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30b9\u30c6\u30fc\u30c8"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"trigger_single_csv_and_wait"})}),(0,s.jsx)(n.td,{children:"ZIP\u5185\u306e\u5404\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u3057\u3066\u5358\u4e00\u306eCSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u3092\u30c8\u30ea\u30ac\u30fc"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"finalize_zip_job"})}),(0,s.jsx)(n.td,{children:"\u3059\u3079\u3066\u306eCSV\u30a4\u30f3\u30dd\u30fc\u30c8\u306e\u7d50\u679c\u3092\u96c6\u8a08\u3057\u3001\u30de\u30b9\u30bf\u30fc\u30b8\u30e7\u30d6\u3092\u7d42\u4e86"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9-2",children:"\u4e3b\u8981\u30e1\u30bd\u30c3\u30c9"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u30e1\u30bd\u30c3\u30c9"}),(0,s.jsx)(n.th,{children:"\u8aac\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"triggerSingleCsvJob(event)"})}),(0,s.jsx)(n.td,{children:"STEP_FUNCTION\u30e2\u30fc\u30c9\u3067CSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u3092\u4f5c\u6210\u3057\u3001\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u7528\u306etaskToken\u3092\u6e21\u3059"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"finalizeZipMasterJob(event)"})}),(0,s.jsx)(n.td,{children:"\u51e6\u7406\u3055\u308c\u305f\u3059\u3079\u3066\u306eCSV\u30d5\u30a1\u30a4\u30eb\u306e\u7d50\u679c\u3092\u96c6\u8a08\u3057\u3001ZIP\u30de\u30b9\u30bf\u30fc\u30b8\u30e7\u30d6\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u66f4\u65b0"})]})]})]}),"\n",(0,s.jsxs)(n.admonition,{title:"\u65e2\u77e5\u306e\u554f\u984c",type:"warning",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"finalizeZipMasterJob"}),"\u30e1\u30bd\u30c3\u30c9\u306f\u73fe\u5728\u3001\u5b50CSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u306e\u5931\u6557\u306b\u95a2\u4fc2\u306a\u304f\u3001\u5e38\u306b\u30de\u30b9\u30bf\u30fc\u30b8\u30e7\u30d6\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092",(0,s.jsx)(n.code,{children:"COMPLETED"}),"\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u500b\u3005\u306eCSV\u30d5\u30a1\u30a4\u30eb\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u304c\u5931\u6557\u3057\u3066\u3082\u3001ZIP\u30a4\u30f3\u30dd\u30fc\u30c8\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u304c\u6210\u529f\u3092\u5831\u544a\u3059\u308b\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002"]}),(0,s.jsxs)(n.p,{children:["\u3053\u308c\u3092\u56de\u907f\u3059\u308b\u306b\u306f\u3001result\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e",(0,s.jsx)(n.code,{children:"failedRows"}),"\u30ab\u30a6\u30f3\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u3001\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u304b\u3069\u3046\u304b\u3092\u5224\u65ad\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u30d5\u30a1\u30a4\u30eb\u547d\u540d\u898f\u5247",children:"\u30d5\u30a1\u30a4\u30eb\u547d\u540d\u898f\u5247"}),"\n",(0,s.jsx)(n.p,{children:"ZIP\u30a2\u30fc\u30ab\u30a4\u30d6\u304b\u3089CSV\u30d5\u30a1\u30a4\u30eb\u3092\u51e6\u7406\u3059\u308b\u969b\u3001\u30cf\u30f3\u30c9\u30e9\u30fc\u306f\u30d5\u30a1\u30a4\u30eb\u540d\u304b\u3089\u30c6\u30fc\u30d6\u30eb\u540d\u3092\u62bd\u51fa\u3057\u307e\u3059\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'\u5f62\u5f0f: yyyymmddhhMMss-\\{tableName\\}.csv\n\u4f8b: 20240115120000-products.csv \u2192 tableName = "products" \u3092\u62bd\u51fa\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"CreateZipImportDto"}),"\u3067",(0,s.jsx)(n.code,{children:"tableName"}),"\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u62bd\u51fa\u3055\u308c\u305f\u540d\u524d\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u307e\u3059\u3002"]}),"\n",(0,s.jsx)(n.h4,{id:"\u51e6\u7406\u30d5\u30ed\u30fc",children:"\u51e6\u7406\u30d5\u30ed\u30fc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"ZIP\u30d5\u30a1\u30a4\u30eb\u304cS3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n         \u2502\n         \u25bc\nStep Functions\u304c\u30c8\u30ea\u30ac\u30fc\n         \u2502\n         \u25bc\n\u89e3\u51cd\u3057\u3066CSV\u30d5\u30a1\u30a4\u30eb\u3092\u30ea\u30b9\u30c8\n         \u2502\n         \u25bc\nMap\u30b9\u30c6\u30fc\u30c8: \u5404CSV\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u3057\u3066\n    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n    \u2502         \u2502\n    \u25bc         \u25bc\ntrigger_single_csv_and_wait\n    \u2502         \u2502\n    \u25bc         \u25bc\nCSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u4f5c\u6210    CSV\u30a4\u30f3\u30dd\u30fc\u30c8\u30b8\u30e7\u30d6\u4f5c\u6210\n(taskToken\u4ed8\u304d)          (taskToken\u4ed8\u304d)\n    \u2502         \u2502\n    \u25bc         \u25bc\n\u5b8c\u4e86\u3092\u5f85\u6a5f       \u5b8c\u4e86\u3092\u5f85\u6a5f\n    \u2502         \u2502\n    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\nfinalize_zip_job\n         \u2502\n         \u25bc\n\u7d50\u679c\u3092\u96c6\u8a08\u3057\u3066\u30de\u30b9\u30bf\u30fc\u30b8\u30e7\u30d6\u3092\u66f4\u65b0\n"})}),"\n",(0,s.jsx)(n.h4,{id:"zipimportsfnevent\u69cb\u9020",children:"ZipImportSfnEvent\u69cb\u9020"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export class ZipImportSfnEvent implements IEvent {\n  source: string           // Execution ID from Step Functions (Step Functions\u304b\u3089\u306e\u5b9f\u884cID)\n  context: StepFunctionsContext // Step Functions context with state info (\u30b9\u30c6\u30fc\u30c8\u60c5\u5831\u3092\u542b\u3080Step Functions\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8)\n  input: string | any[]    // S3 key or array of results (S3\u30ad\u30fc\u307e\u305f\u306f\u7d50\u679c\u306e\u914d\u5217)\n  taskToken: string        // Token for callback to Step Functions (Step Functions\u3078\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u7528\u30c8\u30fc\u30af\u30f3)\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"context.Execution.Input"}),"\u306b\u306f\u4ee5\u4e0b\u304c\u542b\u307e\u308c\u307e\u3059\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"masterJobKey"}),": DynamoDB\u306eZIP\u30de\u30b9\u30bf\u30fc\u30b8\u30e7\u30d6\u306e\u30d7\u30e9\u30a4\u30de\u30ea\u30ad\u30fc"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"parameters"}),": \u5143\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\uff08bucket\u3001tenantCode\u3001tableName\uff09"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8",children:"\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./backend-development",children:"\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u958b\u767a\u30ac\u30a4\u30c9"})," - \u30b3\u30a2\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30d1\u30bf\u30fc\u30f3"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./service-patterns",children:"\u30b5\u30fc\u30d3\u30b9\u30d1\u30bf\u30fc\u30f3"})," - \u30b5\u30fc\u30d3\u30b9\u5b9f\u88c5"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./architecture/step-functions",children:"Step Functions"})," - \u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./data-sync-handler-examples",children:"\u30c7\u30fc\u30bf\u540c\u671f\u30cf\u30f3\u30c9\u30e9\u30fc\u4f8b"})," - \u540c\u671f\u30cf\u30f3\u30c9\u30e9\u30fc\u30d1\u30bf\u30fc\u30f3"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var r=t(6540);const s={},o=r.createContext(s);function i(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);